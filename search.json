[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Fisheries Integrated Modeling System case studies",
    "section": "",
    "text": "These case studies demonstrate use of the Fisheries Integrated Modeling System to run a few different cases of stock assessment models.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "content/setup.html",
    "href": "content/setup.html",
    "title": "NOAA FIMS case studies",
    "section": "",
    "text": "# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))"
  },
  {
    "objectID": "content/PIFSC-opakapaka.html",
    "href": "content/PIFSC-opakapaka.html",
    "title": "Opakapaka Case Study",
    "section": "",
    "text": "# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n#remotes::install_github(\"NOAA-FIMS/FIMS\", ref = \"main\")\nlibrary(r4ss)\n# clear memory\nclear()",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/PIFSC-opakapaka.html#the-setup",
    "href": "content/PIFSC-opakapaka.html#the-setup",
    "title": "Opakapaka Case Study",
    "section": "The setup",
    "text": "The setup\n\nR version = R_version\nTMB version = TMB_version\nFIMS commit = FIMS_commit\nr4ss version = r4ss_version\n\nStock name: Main Hawaiian Islands Opakapaka\nRegion: Pacific Islands\nAnalyst: Meg Oshima",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/PIFSC-opakapaka.html#setting-up-data",
    "href": "content/PIFSC-opakapaka.html#setting-up-data",
    "title": "Opakapaka Case Study",
    "section": "Setting up Data",
    "text": "Setting up Data\n\nload(file.path(\"data_files\", \"opaka_model.RDS\"))\ninclude_age_comps &lt;- FALSE\ninclude_length_comps &lt;- TRUE\nyears &lt;- seq(opaka_dat$styr, opaka_dat$endyr)\nnyears &lt;- length(years) # the number of years which we have data for.\nnseasons &lt;- 1 # the number of seasons in each year. FIMS currently defaults to 1\nages &lt;- seq(1, 21) # age vector.\nnages &lt;- length(ages) # the number of age groups.\nif(include_length_comps){\n  comp_lengths &lt;- opaka_dat$lbin_vector # length vector.\n  nlengths &lt;- length(comp_lengths) # the number of length bins.\n}\n\n\nPreparing Data using FIMSFrame\nWe will be reading data into the model using the FIMSFrame S4 R class set up in R/fimsframe.R\n\n# use FIMS data frame\n\nsource(here::here(\"content\", \"R\", \"get_ss3_data.R\"))\nopaka_dat_fims &lt;- get_ss3_data(opaka_dat, fleets = c(1,2,3), ages = ages, lengths = comp_lengths)\n\nif (!include_age_comps){\n  opaka_dat_fims &lt;- opaka_dat_fims |&gt;\n    dplyr::filter(type != \"age\")\n}\n## age to length conversion matrix \n# Growth function values to create age to length conversion matrix from model\n#comparison project\nmg_pars &lt;- rep$parameters  |&gt; \ndplyr::filter(stringr::str_detect(Label, \"_GP_\"))\nLinf &lt;- mg_pars$Value[3]\nK &lt;- mg_pars$Value[4]\na0 &lt;- -0.29\namax &lt;- 21\ncv &lt;- mg_pars$Value[5]\n\nL2Wa &lt;- mg_pars$Value[7]\nL2Wb &lt;- mg_pars$Value[8]\n\nAtoL &lt;- function(a,Linf,K,a_0){\n  L &lt;- Linf*(1-exp(-K*(a-a_0)))\n}\n\nages &lt;- 1:amax\nlen_bins &lt;- comp_lengths\n\n#Create length at age conversion matrix and fill proportions using above \n#growth parameters\nlength_age_conversion &lt;- matrix(NA,nrow=length(ages),ncol=length(len_bins))\nfor(i in seq_along(ages)){\n  #Calculate mean length at age to spread lengths around\n  mean_length &lt;- AtoL(ages[i],Linf,K,a0)\n  #mean_length &lt;- AtoLSchnute(ages[i],L1,L2,a1,a2,Ks)\n  #Calculate the cumulative proportion shorter than each composition length\n  temp_len_probs&lt;-pnorm(q=len_bins,mean=mean_length,sd=mean_length*cv)\n  #Reset the first length proportion to zero so the first bin includes all\n  #density smaller than that bin\n  temp_len_probs[1]&lt;-0\n  #subtract the offset length probabilities to calculate the proportion in each\n  #bin. For each length bin the proportion is how many fish are larger than this\n  #length but shorter than the next bin length.\n  temp_len_probs &lt;- c(temp_len_probs[-1],1)-temp_len_probs\n  length_age_conversion[i,] &lt;- temp_len_probs\n}\ncolnames(length_age_conversion) &lt;- len_bins\nrownames(length_age_conversion) &lt;- ages\n\n#Extract years and fleets from milestone 1 data\nstart_date &lt;- unique(opaka_dat_fims$datestart[opaka_dat_fims$type==\"landings\"])\nend_date &lt;- unique(opaka_dat_fims$dateend[opaka_dat_fims$type==\"landings\"])\nobservers &lt;- unique(opaka_dat_fims$name[opaka_dat_fims$type==\"length\"])\n\n#Create data frame for new fleet and year specific length at age conversion proportions\nlength_age_data &lt;- data.frame(\n  type = rep(\"age-to-length-conversion\",length(len_bins)*length(ages)*length(observers)*length(start_date)),\n  name = rep(sort(rep(observers,length(len_bins)*length(ages))),length(start_date)),\n  age = rep(sort(rep(ages,length(len_bins))),length(observers)*length(start_date)),\n  length = rep(len_bins,length(ages)*length(observers)*length(start_date)),\n  datestart = rep(start_date,each=length(len_bins)*length(ages)*length(observers)),\n  dateend = rep(end_date,each=length(len_bins)*length(ages)*length(observers)),\n  value = rep(c(t(length_age_conversion)),length(observers)*length(start_date)),\n  unit = rep(\"proportion\",length(len_bins)*length(ages)*length(observers)*length(start_date)),\n  uncertainty = rep(30,length(len_bins)*length(ages)*length(observers)*length(start_date)))\n\n# Changing the CPUE indices for fleet1 to be a new fleet, fleet4. This helps with model convergence and fitting as it is the longest time series of data available along with the landings. \nopaka_dat_fims &lt;- opaka_dat_fims |&gt;\n  dplyr::mutate(name = ifelse(name == \"fleet1\" & type == \"index\", \"fleet4\", name))\n\nopaka_dat_fims &lt;- type.convert(\n  rbind(opaka_dat_fims, length_age_data),\n  as.is = TRUE\n)\n\n# Get weight-at-age from SS3 report output and convert from kg to mt\nweight_at_age_data &lt;- rep[[\"wtatage\"]] |&gt; \n  dplyr::filter(sex == 1 & fleet == 1 & year == 1949) |&gt; \n  dplyr::select(dplyr::matches(\"[0-9]+\")) |&gt;\n  round(4) |&gt;\n  tidyr::pivot_longer(names_to = \"age\", cols = dplyr::everything()) |&gt;\n  dplyr::filter(age %in% ages) |&gt;\n  tidyr::expand_grid(\n    opaka_dat_fims |&gt; dplyr::select(datestart) |&gt; dplyr::distinct()\n  ) |&gt;\n  dplyr::left_join(\n    opaka_dat_fims |&gt; dplyr::select(datestart, dateend) |&gt; dplyr::distinct(),\n    by = \"datestart\"\n  ) |&gt;\n  dplyr::mutate(\n    type = \"weight-at-age\",\n    name = \"fleet1\",\n    unit = \"mt\",\n    age = as.integer(age),\n    value = value/1000\n  )\nopaka_dat_fims &lt;- opaka_dat_fims |&gt; \n  dplyr::bind_rows(weight_at_age_data)\n\n\nopaka_dat_fims &lt;- opaka_dat_fims |&gt; \ndplyr::mutate(uncertainty = ifelse(type == \"length\" & name == \"fleet2\" & value != -999, 1, uncertainty)) |&gt; filter(!(type == \"index\" & name == \"fleet3\"))\n\nfims_frame &lt;- FIMSFrame(opaka_dat_fims)\n\nThe fims_frame object contains a @data slot that holds a long data frame with: * 2 fleets: commercial fishery (fleet1) and survey (fleet2) * landings for fleet 1 * cpue for fleet 2 * length composition data for fleet 2\n\n\nPrepare Parameters using create_default_parameters()\n\n# Define fleet specifications for fleet1 and survey1\nfleet1 &lt;- fleet3 &lt;- fleet4 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\"\n  )\n)\n\nfleet2 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\", \n    LengthComp = \"DmultinomDistribution\"  \n  )\n)\n\n# Create default parameters\ndefault_parameters &lt;- fims_frame |&gt;\n  create_default_parameters(\n    fleets = list(fleet1 = fleet1, fleet2 = fleet2, fleet3 = fleet3, fleet4=fleet4)\n  )\n\n\n\nModifying parameters\n\nrecdevs &lt;- rep$parameters |&gt; \n           dplyr::filter(stringr::str_detect(Label, \"RecrDev\")) |&gt; \n           dplyr::select(Label, Value)\n\ninit_naa &lt;- (exp(opaka_ctl$SR_parms[\"SR_LN(R0)\", \"INIT\"]) * 1000) * exp(-(ages - 1) * 0.135)\ninit_naa[nages] &lt;- init_naa[nages] / 0.135\n\nparameters &lt;- default_parameters |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet1 = list(\n        Fleet.log_Fmort.value = log(rep$exploitation$FRS),\n        LogisticSelectivity.inflection_point.value = 1.81, #used age selex values\n        LogisticSelectivity.inflection_point.estimated = FALSE,\n        LogisticSelectivity.slope.value = 4.5, #used age selex values\n        LogisticSelectivity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n    update_parameters(\n      modified_parameters = list(\n        fleet4 = list(\n          LogisticSelectivity.inflection_point.value = 1.81, #used age selex values\n          LogisticSelectivity.inflection_point.estimated = FALSE,\n          LogisticSelectivity.slope.value = 4.5, #used age selex values\n          LogisticSelectivity.slope.estimated = FALSE,\n          Fleet.log_q.value = -3.90281 #value from SS\n        )\n      )\n    ) |&gt;\n    update_parameters(\n    modified_parameters = list(\n      fleet2 = list(\n        LogisticSelectivity.inflection_point.value = 1, #used age selex values\n        LogisticSelectivity.inflection_point.estimated = FALSE,\n        LogisticSelectivity.slope.value = 3, #used age selex values\n        LogisticSelectivity.slope.estimated = FALSE,\n        Fleet.log_q.value = -4.12772\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet3 = list(\n        Fleet.log_Fmort.value = log(rep$exploitation$Non_comm),\n        LogisticSelectivity.inflection_point.value = 1.97,\n        LogisticSelectivity.inflection_point.estimated = FALSE,\n        LogisticSelectivity.slope.value = 4.5,\n        LogisticSelectivity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      recruitment = list(\n        BevertonHoltRecruitment.log_rzero.value = opaka_ctl$SR_parms[\"SR_LN(R0)\", \"INIT\"], \n        BevertonHoltRecruitment.log_devs.value = recdevs$Value,\n        BevertonHoltRecruitment.logit_steep.value = -log(1.0- 0.76) + log(0.76 - 0.2)\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      maturity = list(\n        LogisticMaturity.inflection_point.value = 7, # currently in opaka model in terms of length so guesstimated what it would be for age based on growth\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 0.5, #make positive from SS value \n        LogisticMaturity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      population = list(\n        Population.log_init_naa.value = log(init_naa),\n        Population.log_init_naa.estimated = FALSE,\n        Population.log_M.value = rep(log(0.135), get_n_years(fims_frame)*get_n_ages(fims_frame))\n      )\n    )\n  )",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/PIFSC-opakapaka.html#initialize-modules-and-fit-the-model",
    "href": "content/PIFSC-opakapaka.html#initialize-modules-and-fit-the-model",
    "title": "Opakapaka Case Study",
    "section": "Initialize modules and fit the model",
    "text": "Initialize modules and fit the model\nWith data and parameters in place, we can now initialize modules using initialize_fims() and fit the model using fit_fims().\n\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- parameters |&gt;\n  initialize_fims(data = fims_frame) |&gt;\n  fit_fims(optimize = FALSE)\n\n# Run the  model with optimization\nfit &lt;- parameters |&gt;\n  initialize_fims(data = fims_frame) |&gt;\n  fit_fims(optimize = TRUE)\n\n✔ Starting optimization ...\nℹ Restarting optimizer 3 times to improve gradient.\nℹ Maximum gradient went from 0.00979 to 0.00035 after 3 steps.\n✔ Finished optimization\n✔ Finished sdreport\nℹ FIMS model version: 0.3.0.1\nℹ Total run time was 48.05394 seconds\nℹ Number of parameters: total=227, fixed_effects=227, and random_effects=0\nℹ Maximum gradient= 0.00035\nℹ Negative log likelihood (NLL):\n• Marginal NLL= 569.48717\n• Total NLL= 569.48717\nℹ Terminal SB=\n\nstr(fit)\n\nFormal class 'FIMSFit' [package \"FIMS\"] with 10 slots\n  ..@ input               :List of 1\n  .. ..$ parameters:List of 1\n  .. .. ..$ p: num [1:227] -4.51 -4.45 -4.33 -4.34 -4.49 ...\n  ..@ obj                 :List of 10\n  .. ..$ par     : Named num [1:227] -4.51 -4.45 -4.33 -4.34 -4.49 ...\n  .. .. ..- attr(*, \"names\")= chr [1:227] \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" ...\n  .. ..$ fn      :function (x = last.par[lfixed()], ...)  \n  .. ..$ gr      :function (x = last.par[lfixed()], ...)  \n  .. ..$ he      :function (x = last.par[lfixed()], atomic = usingAtomics())  \n  .. ..$ hessian : logi FALSE\n  .. ..$ method  : chr \"BFGS\"\n  .. ..$ retape  :function (set.defaults = TRUE)  \n  .. ..$ env     :&lt;environment: 0x14509e8a8&gt; \n  .. ..$ report  :function (par = last.par)  \n  .. ..$ simulate:function (par = last.par, complete = FALSE)  \n  ..@ opt                 :List of 6\n  .. ..$ par        : Named num [1:227] -4.75 -4.69 -4.57 -4.58 -4.73 ...\n  .. .. ..- attr(*, \"names\")= chr [1:227] \"p\" \"p\" \"p\" \"p\" ...\n  .. ..$ objective  : num 569\n  .. ..$ convergence: int 0\n  .. ..$ iterations : int 6\n  .. ..$ evaluations: Named int [1:2] 13 7\n  .. .. ..- attr(*, \"names\")= chr [1:2] \"function\" \"gradient\"\n  .. ..$ message    : chr \"relative convergence (4)\"\n  ..@ max_gradient        : num 0.00035\n  ..@ report              :List of 17\n  .. ..$ ssb            :List of 1\n  .. .. ..$ : num [1:76] 2169 2120 2069 2013 1959 ...\n  .. ..$ cnal           :List of 4\n  .. .. ..$ : num(0) \n  .. .. ..$ : num [1:1275] 1.05e-02 3.28e+03 1.30e+05 3.21e+04 1.61e+05 ...\n  .. .. ..$ : num(0) \n  .. .. ..$ : num(0) \n  .. ..$ log_recruit_dev:List of 1\n  .. .. ..$ : num [1:74] 0.0348 0.0536 0.0714 0.0905 0.1113 ...\n  .. ..$ cwaa           :List of 4\n  .. .. ..$ : num [1:1575] 0.0246 1.2499 2.2691 2.8303 3.2323 ...\n  .. .. ..$ : num [1:1575] 59.6 210.7 283.7 353 403.2 ...\n  .. .. ..$ : num [1:1575] 0.022 1.726 4.099 5.138 5.868 ...\n  .. .. ..$ : num [1:1575] 3.03 155.16 283.03 353.07 403.21 ...\n  .. ..$ exp_index      :List of 4\n  .. .. ..$ : num [1:75] 49.9 51.6 56.4 54.3 45.6 ...\n  .. .. ..$ : num [1:75] 51.7 50.5 49.2 47.9 46.7 ...\n  .. .. ..$ : num [1:75] 90 93.1 102 96.8 82.7 ...\n  .. .. ..$ : num [1:75] 97.1 95 92.6 90 87.7 ...\n  .. ..$ pcnaa          :List of 4\n  .. .. ..$ : num [1:1575] 0.00387 0.09265 0.11429 0.10031 0.08765 ...\n  .. .. ..$ : num [1:1575] 0.0681 0.1134 0.1037 0.0908 0.0794 ...\n  .. .. ..$ : num [1:1575] 0.00196 0.07226 0.1166 0.10285 0.08987 ...\n  .. .. ..$ : num [1:1575] 0.00383 0.09225 0.11433 0.10036 0.08769 ...\n  .. ..$ nll_components : num [1:6] -45.7 22.2 29.6 236.3 49.4 ...\n  .. ..$ biomass        :List of 1\n  .. .. ..$ : num [1:76] 6404 6256 6101 5937 5789 ...\n  .. ..$ F_mort         :List of 4\n  .. .. ..$ : num [1:75] 0.00867 0.00918 0.01031 0.01021 0.00879 ...\n  .. .. ..$ : num [1:75] 1 1 1 1 1 1 1 1 1 1 ...\n  .. .. ..$ : num [1:75] 0.0157 0.0167 0.0188 0.0183 0.016 ...\n  .. .. ..$ : num [1:75] 1 1 1 1 1 1 1 1 1 1 ...\n  .. ..$ M              :List of 1\n  .. .. ..$ : num [1:1575] 0.135 0.135 0.135 0.135 0.135 0.135 0.135 0.135 0.135 0.135 ...\n  .. ..$ pcnal          :List of 4\n  .. .. ..$ : num(0) \n  .. .. ..$ : num [1:1275] 4.78e-09 1.50e-03 5.93e-02 1.46e-02 7.35e-02 ...\n  .. .. ..$ : num(0) \n  .. .. ..$ : num(0) \n  .. ..$ recruitment    :List of 1\n  .. .. ..$ : num [1:76] 298867 269813 274495 278942 283747 ...\n  .. ..$ cnaa           :List of 4\n  .. .. ..$ : num [1:1575] 61.7 1475.8 1820.5 1597.9 1396.2 ...\n  .. .. ..$ : num [1:1575] 149434 248741 227585 199313 174163 ...\n  .. .. ..$ : num [1:1575] 55.2 2037.9 3288.5 2900.5 2534.5 ...\n  .. .. ..$ : num [1:1575] 7608 183209 227076 199327 174164 ...\n  .. ..$ exp_catch      :List of 4\n  .. .. ..$ : num [1:75] 49.9 51.6 56.4 54.3 45.6 ...\n  .. .. ..$ : num [1:75] 0 0 0 0 0 0 0 0 0 0 ...\n  .. .. ..$ : num [1:75] 90 93.1 102 96.8 82.7 ...\n  .. .. ..$ : num [1:75] 0 0 0 0 0 0 0 0 0 0 ...\n  .. ..$ q              :List of 4\n  .. .. ..$ : num 1\n  .. .. ..$ : num 0.00816\n  .. .. ..$ : num 1\n  .. .. ..$ : num 0.0156\n  .. ..$ naa            :List of 1\n  .. .. ..$ : num [1:1596] 298867 261125 228149 199338 174164 ...\n  .. ..$ jnll           : num 569\n  ..@ sdreport            :List of 8\n  .. ..$ value         : Named num [1:17576] 298867 261125 228149 199338 174164 ...\n  .. .. ..- attr(*, \"names\")= chr [1:17576] \"NAA\" \"NAA\" \"NAA\" \"NAA\" ...\n  .. ..$ sd            : num [1:17576] 0 0 0 0 0 0 0 0 0 0 ...\n  .. ..$ cov           : num [1:17576, 1:17576] 0 0 0 0 0 0 0 0 0 0 ...\n  .. ..$ par.fixed     : Named num [1:227] -4.75 -4.69 -4.57 -4.58 -4.73 ...\n  .. .. ..- attr(*, \"names\")= chr [1:227] \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" ...\n  .. ..$ cov.fixed     : num [1:227, 1:227] 1.01e-04 8.69e-07 8.56e-07 8.42e-07 8.22e-07 ...\n  .. .. ..- attr(*, \"dimnames\")=List of 2\n  .. .. .. ..$ : chr [1:227] \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" ...\n  .. .. .. ..$ : chr [1:227] \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" ...\n  .. ..$ pdHess        : logi TRUE\n  .. ..$ gradient.fixed: num [1, 1:227] 3.65e-07 6.77e-07 7.45e-07 1.78e-06 -3.78e-06 ...\n  .. ..$ env           :&lt;environment: 0x161db8f98&gt; \n  .. ..- attr(*, \"class\")= chr \"sdreport\"\n  ..@ estimates           : tibble [17,803 × 3] (S3: tbl_df/tbl/data.frame)\n  .. ..$ name : chr [1:17803] \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" \"log_Fmort\" ...\n  .. ..$ value: num [1:17803] -4.75 -4.69 -4.57 -4.58 -4.73 ...\n  .. ..$ se   : num [1:17803] 0.01 0.01 0.0104 0.0115 0.0133 ...\n  ..@ number_of_parameters: Named int [1:3] 227 227 0\n  .. ..- attr(*, \"names\")= chr [1:3] \"total\" \"fixed_effects\" \"random_effects\"\n  ..@ timing              : 'difftime' Named num [1:3] 1.19682097434998 46.8272590637207 48.0539360046387\n  .. ..- attr(*, \"names\")= chr [1:3] \"time_optimization\" \"time_sdreport\" \"time_total\"\n  .. ..- attr(*, \"units\")= Named chr \"secs\"\n  .. .. ..- attr(*, \"names\")= chr \"time_optimization\"\n  ..@ version             :Classes 'package_version', 'numeric_version'  hidden list of 1\n  .. ..$ : int [1:4] 0 3 0 1\n\nclear()\n\n\n\nCode\nfit@report$exp_index\nfit@report$exp_catch\nfit@report$F_mort[[1]]\nfit@report$log_recruit_dev\nfit@report$ssb\nfit@report$biomass\nunique(fit@estimates$name)\nfit@input$parameters #q and init_naa\nfit@estimates |&gt; filter(name == \"NAA\")\npull(value) \n# Clear memory post-run",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/PIFSC-opakapaka.html#problems-and-questions",
    "href": "content/PIFSC-opakapaka.html#problems-and-questions",
    "title": "Opakapaka Case Study",
    "section": "Problems and Questions:",
    "text": "Problems and Questions:\n\nIn our model maturity and selectivity are length-based processes so I converted (aka eye-balled logistic curves that look like they match for ages) to values that I think would be roughly equivalent in ages. Eventually, having length-based processes would be necessary for this model.\n\nThe scale of the fitted CPUE is lower than the observed values.\n\nIf I don’t fix the initial numbers-at-age, the model puts a really large number of individuals in age-0 bin and then 0 fish in the rest of the ages. Not sure what is happening here.",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/PIFSC-opakapaka.html#plotting-results",
    "href": "content/PIFSC-opakapaka.html#plotting-results",
    "title": "Opakapaka Case Study",
    "section": "Plotting Results",
    "text": "Plotting Results\n\nlibrary(ggplot2)\nindex_results &lt;- data.frame(\n  observed = m_index(fims_frame, \"fleet2\"),\n  expected = get_report(fit)[[\"exp_index\"]][[2]]\n) |&gt;\ndplyr::mutate(year = years) |&gt;\ndplyr::filter(year &gt; 2016)\n#print(index_results)\n\nggplot2::ggplot(index_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Index (mt)\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = expected), color = \"blue\") +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\ncpue_results &lt;- data.frame(\n  observed = m_index(fims_frame, \"fleet4\"),\n  expected = get_report(fit)[[\"exp_index\"]][[2]]\n) |&gt;\ndplyr::mutate(year = years) |&gt;\ndplyr::filter(observed &gt;0)\n#print(cpue_results)\nggplot2::ggplot(cpue_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"CPUE\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = expected), color = \"blue\") +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\ncatch_results &lt;- data.frame(\n  observed = c(m_landings(fims_frame, fleet = \"fleet1\"), m_landings(fims_frame, fleet = \"fleet3\")),\n  expected = c(get_report(fit)[[\"exp_index\"]][[1]], get_report(fit)[[\"exp_index\"]][[3]]),\n  fleet = rep(c(\"fleet1\", \"fleet3\"), each = 75)\n) |&gt;\ndplyr::mutate(year = rep(years, 2))\n#print(catch_results)\n\nggplot2::ggplot(catch_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point(ggplot2::aes(color = fleet)) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Catch (mt)\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = expected, color = fleet)) +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\n\n\nbiomass &lt;- rep$timeseries |&gt; \ndplyr::select(Yr, SpawnBio, Bio_all) |&gt; \ndplyr::filter(Yr &gt; 1947) |&gt; ##CHECK: including \"initial year\" to match length with FIMS but need to check on FIMS\ndplyr::rename(\"SS_SpawnBio\" = \"SpawnBio\",\n              \"SS_Bio\" = \"Bio_all\") |&gt;\ndplyr::mutate(FIMS_SpawnBio = get_report(fit)[[\"ssb\"]][[1]] , \n              FIMS_Bio = get_report(fit)[[\"biomass\"]][[1]]) |&gt; ##CHECK: Is FIMS ssb reporting nyears+1 or initial year-1?\ntidyr::pivot_longer(cols = -Yr) |&gt;\ntidyr::separate_wider_delim(cols = \"name\", delim = \"_\", names = c(\"Model\", \"Type\"))             \n\nggplot2::ggplot(biomass, ggplot2::aes(x = Yr, y = value)) +\n  ggplot2::geom_line(ggplot2::aes(color = Model)) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"\") +\n  ggplot2::facet_wrap(~Type, scales = \"free_y\") +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\nrecruits &lt;- rep$recruit |&gt; \n  select(Yr, exp_recr, raw_dev) |&gt;\n  dplyr::rename(\"SS_recruit\" = \"exp_recr\",\n                \"SS_recdev\" = \"raw_dev\",\n                \"Year\" = \"Yr\") |&gt; \n  dplyr::mutate(FIMS_recruit = get_report(fit)[[\"recruitment\"]][[1]][1:75],\n                FIMS_recdev = c(NA, get_report(fit)[[\"log_recruit_dev\"]][[1]]),\n                SS_recruit = SS_recruit * 1000) |&gt;\n  tidyr::pivot_longer(cols = -Year) |&gt;\n  tidyr::separate_wider_delim(cols = \"name\", delim = \"_\", names = c(\"Model\", \"Type\"))             \n\nggplot2::ggplot(recruits, ggplot2::aes(x = Year, y = value, color = Model)) +\n  ggplot2::geom_line() + \n  ggplot2::facet_wrap(~Type, scales = \"free_y\") +\n  ggplot2::theme_bw()\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n\nCode\n## Checking fit to proportion catch number at length\npcnal &lt;- matrix(data = fit@report$pcnal[[2]], nrow = nlengths)\n\nprop.dat &lt;- opaka_dat_fims |&gt; \nfilter(type == \"length\" & name == \"fleet2\") |&gt; \ngroup_by(datestart) |&gt;\nreframe(prop = value/sum(value)) \npcnal.obs &lt;- matrix(data = prop.dat$prop, nrow = nlengths)\nhead(pcnal.obs)\n\nplot(x = 1:nlengths, y = pcnal.obs[,73], pch = 16,  ylim = c(0,1))\nlines(x = 1:nlengths, y = pcnal[,73])\npcnal[,69]\n\n## checking estimated numbers at age\nhead(fit@report$naa[[1]])\nnaa_mat &lt;- matrix(data = fit@report$naa[[1]], nrow = nages)\nhead(naa_mat)",
    "crumbs": [
      "PIFSC Opakapaka case study"
    ]
  },
  {
    "objectID": "content/rmarkdown.html",
    "href": "content/rmarkdown.html",
    "title": "R Markdown",
    "section": "",
    "text": "You can include R Markdown files in your project.",
    "crumbs": [
      "R Markdown files"
    ]
  },
  {
    "objectID": "content/rmarkdown.html#r-markdown",
    "href": "content/rmarkdown.html#r-markdown",
    "title": "R Markdown",
    "section": "R Markdown",
    "text": "R Markdown\nThis is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see http://rmarkdown.rstudio.com.\nWhen you click the Knit button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:\n\nsummary(cars)\n\n     speed           dist       \n Min.   : 4.0   Min.   :  2.00  \n 1st Qu.:12.0   1st Qu.: 26.00  \n Median :15.0   Median : 36.00  \n Mean   :15.4   Mean   : 42.98  \n 3rd Qu.:19.0   3rd Qu.: 56.00  \n Max.   :25.0   Max.   :120.00",
    "crumbs": [
      "R Markdown files"
    ]
  },
  {
    "objectID": "content/rmarkdown.html#including-plots",
    "href": "content/rmarkdown.html#including-plots",
    "title": "R Markdown",
    "section": "Including Plots",
    "text": "Including Plots\nYou can also embed plots, for example:\n\n\n\n\n\n\n\n\n\nNote that the echo = FALSE parameter was added to the code chunk to prevent printing of the R code that generated the plot.",
    "crumbs": [
      "R Markdown files"
    ]
  },
  {
    "objectID": "content/acknowledgements.html",
    "href": "content/acknowledgements.html",
    "title": "Acknowledgments",
    "section": "",
    "text": "This repo and GitHub Action was based on the tutorial by Openscapes quarto-website-tutorial by Julia Lowndes and Stefanie Butland.",
    "crumbs": [
      "Acknowledgements"
    ]
  },
  {
    "objectID": "content/rendering.html",
    "href": "content/rendering.html",
    "title": "Rendering",
    "section": "",
    "text": "The repo includes a GitHub Action that will render (build) the website automatically when you make changes to the files. It will be pushed to the gh-pages branch.\nBut when you are developing your content, you will want to render it locally.",
    "crumbs": [
      "Rendering"
    ]
  },
  {
    "objectID": "content/rendering.html#step-1.-make-sure-you-have-a-recent-rstudio",
    "href": "content/rendering.html#step-1.-make-sure-you-have-a-recent-rstudio",
    "title": "Rendering",
    "section": "Step 1. Make sure you have a recent RStudio",
    "text": "Step 1. Make sure you have a recent RStudio\nHave you updated RStudio since about August 2022? No? Then update to a newer version of RStudio. In general, you want to keep RStudio updated and it is required to have a recent version to use Quarto.",
    "crumbs": [
      "Rendering"
    ]
  },
  {
    "objectID": "content/rendering.html#step-2.-clone-and-create-rstudio-project",
    "href": "content/rendering.html#step-2.-clone-and-create-rstudio-project",
    "title": "Rendering",
    "section": "Step 2. Clone and create RStudio project",
    "text": "Step 2. Clone and create RStudio project\nFirst, clone the repo onto your local computer. How? You can click File &gt; New Project and then select “Version Control”. Paste in the url of the repository. That will clone the repo on to your local computer. When you make changes, you will need to push those up.",
    "crumbs": [
      "Rendering"
    ]
  },
  {
    "objectID": "content/rendering.html#step-3.-render-within-rstudio",
    "href": "content/rendering.html#step-3.-render-within-rstudio",
    "title": "Rendering",
    "section": "Step 3. Render within RStudio",
    "text": "Step 3. Render within RStudio\nRStudio will recognize that this is a Quarto project by the presence of the _quarto.yml file and will see the “Build” tab. Click the “Render website” button to render to the _site folder.\nPreviewing: You can either click index.html in the _site folder and specify “preview in browser” or set up RStudio to preview to the viewer panel. To do the latter, go to Tools &gt; Global Options &gt; R Markdown. Then select “Show output preview in: Viewer panel”.",
    "crumbs": [
      "Rendering"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html",
    "href": "content/NEFSC-yellowtail.html",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Southern New England-Mid Atlantic Yellowtail Flounder\n\nRegion: NEFSC\n\nAnalyst: Chris Legault",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#the-setup",
    "href": "content/NEFSC-yellowtail.html#the-setup",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Southern New England-Mid Atlantic Yellowtail Flounder\n\nRegion: NEFSC\n\nAnalyst: Chris Legault",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#simplifications-to-the-original-assessment",
    "href": "content/NEFSC-yellowtail.html#simplifications-to-the-original-assessment",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "Simplifications to the original assessment",
    "text": "Simplifications to the original assessment\n\nEnd year 2021 to 2019 due to missing 2020 survey\n5 indices to 2\nFilled a survey missing year for one index (see below)\nVarying weight at age to constant over time\nDifferent weight at age matrices for catch, SSB, Jan-1 to same for all 3\nSSB calculated in April to Jan-1\nAggregate index in numbers to weight\nFishery 2 selectivity blocks to 1\nCatch and Index selectivity at age to logistic\nIndex timing from April to Jan-1\nVarying Index CV to constant over time\nVarying Catch ESS to constant over time\nSR unexploited scaler SSB to recruitment\n\nHow I simplified my assessment:\nTo fill the missing year of survey data, I first ran the model in ASAP with the missing data treated as missing. I then filled the missing data with the expected value of the survey, both in aggregate and for catch at age in place of the missing data.\nThe varying weights at age, index CVs, and ESS values were replaced by the time series mean in all years.\nThe catch weight at age matrix was used as the weight at age for all sources.",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#script-that-sets-up-and-runs-the-model",
    "href": "content/NEFSC-yellowtail.html#script-that-sets-up-and-runs-the-model",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "Script that sets up and runs the model",
    "text": "Script that sets up and runs the model\n\n\nCode\n# clear memory\nclear()\n\n# read the ASAP rdat files\nrdat &lt;- dget(file.path(\"data_files\", \"NEFSC_YT_SIMPLIFIED.RDAT\")) # to be used in FIMS, lots of modifications from original\norig &lt;- dget(file.path(\"data_files\", \"NEFSC_YT_ORIGINAL.RDAT\"))   # where started before modifications for use in FIMS\n\n# function to create equivalent of data_mile1, basic catch and survey data\n# need to think about how to deal with multiple fleets and indices - only use 1 of each for now\nget_asap_data &lt;- function(rdat){\n  res &lt;- data.frame(type = character(),\n                name = character(),\n                age = integer(),\n                datestart = character(),\n                dateend = character(),\n                value = double(),\n                unit = character(),\n                uncertainty = double())\n  \n  landings &lt;- data.frame(type = \"landings\",\n                     name = \"fleet1\",\n                     age = NA,\n                     datestart = paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-01-01\"),\n                     dateend = paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-12-31\"),\n                     value = as.numeric(rdat$catch.obs[1,]),\n                     unit = \"mt\",\n                     uncertainty = rdat$control.parms$catch.tot.cv[,1])\n  \n  # loop over all indices\n  for (i in 1:rdat$parms$nindices){\n    index &lt;- data.frame(type = \"index\",\n                        name = paste0(\"survey\", i),\n                        age = NA,\n                        datestart = paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-01-01\"),\n                        dateend = paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-12-31\"),\n                        value = as.numeric(rdat$index.obs[[i]]),\n                        unit = \"\",\n                        uncertainty = rdat$index.cv[[i]])\n    if (i == 1){\n      allinds &lt;- index\n    }else{\n      allinds &lt;- rbind(allinds, index)\n    }\n  }\n  \n  catchage &lt;- data.frame(type = \"age\",\n                     name = \"fleet1\",\n                     age = rep(seq(1,rdat$parms$nages), rdat$parms$nyears),\n                     datestart = rep(paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-01-01\"), each=rdat$parms$nages),\n                     dateend = rep(paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-12-31\"), each=rdat$parms$nages),\n                     value = as.numeric(t(rdat$catch.comp.mats$catch.fleet1.ob)),\n                     unit = \"\",\n                     uncertainty = rep(rdat$fleet.catch.Neff.init[1,], each=rdat$parms$nages))\n  \n  # loop over all indices\n  for (i in 1:rdat$parms$nindices){\n    indexage &lt;- data.frame(type = \"age\",\n                           name = paste0(\"survey\", i),\n                           age = rep(seq(1,rdat$parms$nages), rdat$parms$nyears),\n                           datestart = rep(paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-01-01\"), each=rdat$parms$nages),\n                           dateend = rep(paste0(seq(rdat$parms$styr, rdat$parms$endyr), \"-12-31\"), each=rdat$parms$nages),\n                           value = as.numeric(t(rdat$index.comp.mats[[i*2-1]])),\n                           unit = \"\",\n                           uncertainty = rep(rdat$index.Neff.init[i,], each=rdat$parms$nages))\n    if (i == 1){\n      allindsage &lt;- indexage\n    }else{\n      allindsage &lt;- rbind(allindsage, indexage)\n    }\n  }\n  \n  # Weight at age is in rdat$WAA.mats$WAA.catch.all but for yellowtail the data\n  # is time-invariant. Could just use the first row but the code below shows how\n  # to use values for every year/age combination.\n  weight_at_age &lt;- data.frame(\n    type = \"weight-at-age\",\n    name = \"fleet1\",\n    age = seq(rdat[[\"parms\"]][[\"nages\"]]),\n    datestart = rep(\n      paste0(\n        seq(rdat[[\"parms\"]][[\"styr\"]], rdat[[\"parms\"]][[\"endyr\"]]),\n        \"-01-01\"\n      ),\n      each = rdat[[\"parms\"]][[\"nages\"]]\n    ),\n    dateend = rep(\n      paste0(\n        seq(rdat[[\"parms\"]][[\"styr\"]], rdat[[\"parms\"]][[\"endyr\"]]),\n        \"-12-31\"\n      ),\n      each = rdat[[\"parms\"]][[\"nages\"]]\n    ),\n    value = c(t(rdat[[\"WAA.mats\"]][[\"WAA.catch.all\"]])),\n    unit = \"mt\",\n    uncertainty = NA\n  )\n\n  res &lt;- rbind(res, landings, allinds, catchage, allindsage, weight_at_age)\n  return(res)\n}\n\nmydat &lt;- get_asap_data(rdat)\n\n# define the dimensions\nnyears &lt;- rdat$parms$nyears\nyears &lt;- seq(rdat$parms$styr, rdat$parms$endyr)\nnseasons &lt;- 1 # ASAP only has one season\nnages &lt;- rdat$parms$nages\nages &lt;- 1:nages # ASAP starts at age 1\n\n\n# set up FIMS data objects\nage_frame &lt;- FIMS::FIMSFrame(mydat)\n\n# set up selectivities for fleets and survey\nfleet1 &lt;- survey1 &lt;- survey2 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\n\ndefault_parameters &lt;- age_frame |&gt;\n  create_default_parameters(\n    fleets = list(\n      fleet1 = fleet1,\n      survey1 = survey1,\n      survey2 = survey2\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet1 = list(\n        Fleet.log_Fmort.value = log(rep(rdat$initial.guesses$Fmult.year1.init[1], nyears)), # ASAP assumes Fmult devs = 0\n        Fleet.log_Fmort.estimated = TRUE,\n        # FIX: Users should not have to reset the uncertainty for a fleet when this information\n        #      is already in the data, it should be stored and pulled out automatically in\n        #      create_default_parameters(). For index data too.\n        DlnormDistribution.log_sd.value = rep(log(sqrt(log(as.numeric(mean(rdat$control.parms$catch.tot.cv[,1], na.rm=TRUE)^2) + 1))), nyears)\n      ),\n      survey1 = list(\n        Fleet.log_q.value = log(rdat$initial.guesses$q.year1.init[1]),\n        # sd = sqrt(log(cv^2 + 1)), sd is log transformed\n        DlnormDistribution.log_sd.value = rep(log(sqrt(log(as.numeric(mean(rdat$index.cv[[1]], na.rm=TRUE)^2 + 1)))), nyears)\n      ),\n      survey2 = list(\n        Fleet.log_q.value = log(rdat$initial.guesses$q.year1.init[2]),\n        DlnormDistribution.log_sd.value = rep(log(sqrt(log(as.numeric(mean(rdat$index.cv[[2]], na.rm=TRUE)^2 + 1)))), nyears)\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      # Recruitment\n      recruitment = list(\n        # ASAP can enter either R0 or SSB0, need to make sure use R0 in input file\n        BevertonHoltRecruitment.log_rzero.value = log(rdat$initial.guesses$SR.inits$SR.scaler.init),\n        BevertonHoltRecruitment.log_devs.estimated = TRUE,\n        # note: do not set steepness exactly equal to 1, use 0.99 instead in ASAP run\n        BevertonHoltRecruitment.logit_steep.value = -log(1.0 - rdat$initial.guesses$SR.inits$SR_steepness.init) + log(rdat$initial.guesses$SR.inits$SR_steepness.init - 0.2),\n        DnormDistribution.log_sd.value = mean(rdat$control.parms$recruit.cv), # typically enter same value for every year in ASAP,\n        # Unrealistically setting these from the ASAP run\n        BevertonHoltRecruitment.log_devs.value = rdat$SR.resids$logR.dev[-1]\n      ),\n      # Maturity\n      # NOTE, to match FIMS for a protogynous stock, these maturity values were obtained by fitting a logistic fcn to the age vector,\n      # mat.female*prop.female + mat.male*prop.male and then assuming an all female population \n      maturity = list(\n        LogisticMaturity.inflection_point.value =  1.8, # hardwired for now, need to figure out a better way than this\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 4, # hardwired for now, need to figure out a better way than this\n        LogisticMaturity.slope.estimated = FALSE\n      ),\n      population = list(\n        # M is vector of age1 M X nyrs then age2 M X nyrs\n        Population.log_M.value = log(as.numeric(t(rdat$M.age))),\n        Population.log_init_naa.value = log(rdat$N.age[1,]), # log(rdat$initial.guesses$NAA.year1.init)\n        # Does not really matter if you estimate these or not when\n        # distributions are fixed\n        Population.log_init_naa.estimated = FALSE\n      )\n    )\n  )\n\n# Put it all together, creating the FIMS model and making the TMB fcn\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- default_parameters |&gt;\n  initialize_fims(data = age_frame) |&gt;\n  fit_fims(optimize = FALSE)\n# Run the  model with optimization\nfit &lt;- default_parameters |&gt;\n  initialize_fims(data = age_frame) |&gt;\n  fit_fims(optimize = TRUE)\n\n# eventually change to allow multiple fishing fleets similar to multiple indices - only using 1 fishing fleet for now\n# NOTE: FIMS assumes SSB calculated at the start of the year, so need to adjust ASAP to do so as well for now, need to make timing of SSB calculation part of FIMS later\n# NOTE: for now tricking FIMS into thinking age 0 is age 1, so need to adjust A50 for maturity because FIMS calculations use ages 0-5+ instead of 1-6\n\nsdr &lt;- get_sdreport(fit)\nsdr_fixed &lt;- summary(sdr, \"fixed\")\nreport &lt;- get_report(fit)\n\n### Plotting\n\nmycols &lt;- c(\"FIMS\" = \"blue\", \"ASAP\" = \"red\", \"ASAP_orig\" = \"darkgreen\")\n\nfor (i in 1:rdat$parms$nindices){\n  index_results &lt;- data.frame(\n    survey = i,\n    year = years,\n    observed = rdat$index.obs[[i]],\n    FIMS = report$exp_index[[rdat$parms$nfleet+i]],\n    ASAP = rdat$index.pred[[i]]\n  )\n  if (i==1){\n    allinds_results &lt;- index_results\n  }else{\n    allinds_results &lt;- rbind(allinds_results, index_results)\n  }\n}\n#print(allinds_results)\n\ncomp_index &lt;- ggplot2::ggplot(allinds_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = FIMS), color = \"blue\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = ASAP), color = \"red\") +\n  ggplot2::facet_wrap(~survey, scales = \"free_y\", nrow = 2) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Index\") +\n  ggplot2::ggtitle(\"Blue=FIMS, Red=ASAP\") +\n  ggplot2::theme_bw()\n#print(comp_index)\n\ncatch_results &lt;- data.frame(\n  observed = get_data(age_frame) |&gt;\n    dplyr::filter(type == \"index\", name == \"survey1\") |&gt;\n    dplyr::pull(value),\n  FIMS = report$exp_index[[1]],\n  ASAP = as.numeric(rdat$catch.pred[1,])\n)\n#print(catch_results)\n\ncomp_catch &lt;- ggplot2::ggplot(catch_results, ggplot2::aes(x = years, y = observed)) +\n  ggplot2::geom_point() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Catch (mt)\") +\n  ggplot2::geom_line(ggplot2::aes(x = years, y = FIMS), color = \"blue\") +\n  ggplot2::geom_line(ggplot2::aes(x = years, y = ASAP), color = \"red\") +\n  ggplot2::ggtitle(\"Blue=FIMS, Red=ASAP\") +\n  ggplot2::theme_bw()\n#print(comp_catch)\n\npop_results &lt;- data.frame(\n  Year = c(years, max(years)+1, years, years, years, years, max(years)+1, years),\n  Metric = c(rep(\"SSB\", 2*nyears+1), rep(\"F_mort\", 2*nyears), rep(\"Recruitment\", 2*nyears+1)),\n  Model = c(rep(\"FIMS\", nyears+1), rep(\"ASAP\", nyears), rep(c(\"FIMS\", \"ASAP\"), each=nyears), \n             rep(\"FIMS\", nyears+1), rep(\"ASAP\", nyears)),\n  Value = c(report$ssb[[1]], rdat$SSB, report$F_mort[[1]], rdat$F.report, report$recruitment[[1]], as.numeric(rdat$N.age[,1]))\n)\n#print(pop_results)\n\n# ggplot(filter(pop_results, Year &lt;=2019), aes(x=Year, y=Value, color=Model)) +\n#   geom_line() +\n#   facet_wrap(~Metric, ncol=1, scales = \"free_y\") +\n#   theme_bw() +\n#   scale_color_manual(values = mycols)\n\norig_years &lt;- seq(orig$parms$styr, orig$parms$endyr)\norig_pop_results &lt;- data.frame(\n  Year = rep(orig_years, 3),\n  Metric = rep(c(\"SSB\", \"F_mort\", \"Recruitment\"), each = length(orig_years)),\n  Model = \"ASAP_orig\",\n  Value = c(orig$SSB, orig$F.report, as.numeric(orig$N.age[,1]))\n)\n\npop_results_3 &lt;- rbind(pop_results, orig_pop_results)\n#print(pop_results_3)\n\n# ggplot(filter(pop_results_3, Year &lt;=2019), aes(x=Year, y=Value, color=Model)) +\n#   geom_line() +\n#   facet_wrap(~Metric, ncol=1, scales = \"free_y\") +\n#   theme_bw() +\n#   scale_color_manual(values = mycols)\n\ncomp_FRSSB3 &lt;- ggplot2::ggplot(pop_results_3, ggplot2::aes(x=Year, y=Value, color=Model)) +\n  ggplot2::geom_line() +\n  ggplot2::facet_wrap(~Metric, ncol=1, scales = \"free_y\") +\n  ggplot2::theme_bw() +\n  ggplot2::scale_color_manual(values = mycols)\n#print(comp_FRSSB3)\n\nFIMS_naa_results &lt;- data.frame(\n  Year = rep(c(years, max(years)+1), each = nages),\n  Age = rep(ages, nyears+1),\n  Metric = \"NAA\",\n  Model = \"FIMS\",\n  Value = report$naa[[1]]\n)\n\nASAP_naa_results &lt;- data.frame(\n  Year = rep(years, each = nages),\n  Age = rep(ages, nyears),\n  Metric = \"NAA\",\n  Model = \"ASAP\",\n  Value = as.numeric(t(rdat$N.age))\n)\n\norig_naa_results &lt;- data.frame(\n  Year = rep(orig_years, each = nages),\n  Age = rep(ages, length(orig_years)),\n  Metric = \"NAA\",\n  Model = \"ASAP_orig\",\n  Value = as.numeric(t(orig$N.age))\n)\nnaa_results &lt;- rbind(FIMS_naa_results, ASAP_naa_results, orig_naa_results)\n#print(naa_results)\n\n# ggplot(filter(naa_results, Year &lt;= 2019), aes(x=Year, y=Value, color=Model)) +\n#   geom_line() +\n#   facet_wrap(~Age, ncol=1, scales = \"free_y\") +\n#   ylab(\"NAA\") +\n#   theme_bw() +\n#   scale_color_manual(values = mycols)\n\ncomp_naa2 &lt;- ggplot2::ggplot(\n  dplyr::filter(naa_results, Year &lt;= 2019, Model %in% c(\"ASAP\", \"FIMS\")), ggplot2::aes(x=Year, y=Value, color=Model)) +\n  ggplot2::geom_line() +\n  ggplot2::facet_wrap(~Age, ncol=1, scales = \"free_y\") +\n  ggplot2::ylab(\"NAA\") +\n  ggplot2::theme_bw() +\n  ggplot2::scale_color_manual(values = mycols)\n#print(comp_naa2)\n\n# ggplot(filter(naa_results, Year == 1973, Model %in% c(\"ASAP\", \"FIMS\")), aes(x=Age, y=Value, color=Model)) +\n#   geom_line() +\n#   ylab(\"NAA in Year 1\") +\n#   theme_bw() +\n#   scale_color_manual(values = mycols)\n\n\nsaveplots &lt;- TRUE\nif(saveplots){\n  ggplot2::ggsave(filename = \"figures/NEFSC_YT_compare_index.png\", plot = comp_index, width = 4, height = 4, units = \"in\")\n  ggplot2::ggsave(filename = \"figures/NEFSC_YT_compare_catch.png\", plot = comp_catch, width = 4, height = 4, units = \"in\")\n  ggplot2::ggsave(filename = \"figures/NEFSC_YT_compare_FRSSB3.png\", plot = comp_FRSSB3, width = 5, height = 6.5, units = \"in\")\n  ggplot2::ggsave(filename = \"figures/NEFSC_YT_compare_NAA2.png\", plot = comp_naa2, width = 5, height = 6.5, units = \"in\")\n}",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#comparison-figures",
    "href": "content/NEFSC-yellowtail.html#comparison-figures",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "Comparison figures",
    "text": "Comparison figures",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#comparison-table",
    "href": "content/NEFSC-yellowtail.html#comparison-table",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "Comparison table",
    "text": "Comparison table\nThe likelihood components from FIMS and ASAP for the same data are shown in the table below. Note that the ASAP file had to turn on the use likelihood constants option to enable this comparison (this option should not be used when recruitment deviations are estimated).\n\n\nCode\nnll_components &lt;- report[[\"nll_components\"]]\njnlltab &lt;- data.frame(\n  Component=c(\"Total\",\"Index\",\"Age Comp\", \"Rec\"),\n  FIMS = c(\n    report[[\"jnll\"]],\n    sum(nll_components[seq(2, length(nll_components), by = 2)]),\n    sum(nll_components[seq(3, length(nll_components), by = 2)]),\n    nll_components[1]\n  ),\n  ASAP = c(\n    rdat$like$lk.total,\n    (rdat$like$lk.catch.total + rdat$like$lk.index.fit.total),\n    (rdat$like$lk.catch.age.comp + rdat$like$lk.index.age.comp),\n    rdat$like$lk.Recruit.devs\n  )\n)\nprint(jnlltab)\n\n\n  Component      FIMS     ASAP\n1     Total 2540.1331 2410.844\n2     Index 1034.7834 1020.548\n3  Age Comp 1360.0191 1390.297\n4       Rec  145.3306    0.000",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "href": "content/NEFSC-yellowtail.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "What was your experience using FIMS? What could we do to improve usability?",
    "text": "What was your experience using FIMS? What could we do to improve usability?\nRelatively easy to use by following the vignette. Creating wrappers for data input would help so that each element did not need to be assigned directly.",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#list-any-issues-that-you-ran-into-or-found",
    "href": "content/NEFSC-yellowtail.html#list-any-issues-that-you-ran-into-or-found",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "List any issues that you ran into or found",
    "text": "List any issues that you ran into or found\nPlease open an issue if you found something new.\n\nSSB calculations in FIMS assume 0.5 multiplier, which differs from ASAP Issue #521.\nOutput all derived values (this is mostly done)\nFix recruitment estimation Issue #364\nHandle missing data, especially surveys Issue #502\nWeights at age that change over time\nSeparate weights at age for catch, SSB, Jan-1 population, indices, etc.\nFishery selectivity blocks or random effects\nAllow time-varying CVs and ESS (or alternative functions)\nOption for Index in numbers\nTiming of Index and SSB calculations within the year\nOne-step-ahead residuals\nReference points, projections, pushbutton retro",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/NEFSC-yellowtail.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "href": "content/NEFSC-yellowtail.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "title": "NEFSC Case Study Southern New England-Mid Atlantic Yellowtail Flounder",
    "section": "What features are most important to add based on this case study?",
    "text": "What features are most important to add based on this case study?\n\nMissing values, would allow inclusion of the other 3 indices (too many missing years to fill for this example)\n\n\n\nCode\n# Clear C++ objects from memory\nclear()",
    "crumbs": [
      "NEFSC yellowtail flounder case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html",
    "href": "content/AFSC-GOA-pollock.html",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n\n\nCode\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\n\n\nRcppParallel (NA -&gt; 5.1.10    ) [CRAN]\nnumDeriv     (NA -&gt; 2016.8-1.1) [CRAN]\nps           (NA -&gt; 1.8.1     ) [CRAN]\ndistribut... (NA -&gt; 0.5.0     ) [CRAN]\ntensorA      (NA -&gt; 0.36.2.1  ) [CRAN]\nabind        (NA -&gt; 1.4-8     ) [CRAN]\nbackports    (NA -&gt; 1.5.0     ) [CRAN]\nprocessx     (NA -&gt; 3.8.5     ) [CRAN]\ndesc         (NA -&gt; 1.4.3     ) [CRAN]\ncallr        (NA -&gt; 3.7.6     ) [CRAN]\nposterior    (NA -&gt; 1.6.0     ) [CRAN]\nmatrixStats  (NA -&gt; 1.5.0     ) [CRAN]\ncheckmate    (NA -&gt; 2.3.2     ) [CRAN]\nBH           (NA -&gt; 1.87.0-1  ) [CRAN]\nQuickJSR     (NA -&gt; 1.5.1     ) [CRAN]\npkgbuild     (NA -&gt; 1.4.6     ) [CRAN]\nloo          (NA -&gt; 2.8.0     ) [CRAN]\ngridExtra    (NA -&gt; 2.3       ) [CRAN]\ninline       (NA -&gt; 0.3.21    ) [CRAN]\nStanHeaders  (NA -&gt; 2.32.10   ) [CRAN]\nrstan        (NA -&gt; 2.32.6    ) [CRAN]\ntmbstan      (NA -&gt; 1.0.91    ) [CRAN]\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes160034a08337/kaskr-TMB_contrib_R-d275e52/TMBhelper/DESCRIPTION’ ... OK\n* preparing ‘TMBhelper’:\n* checking DESCRIPTION meta-information ... OK\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘TMBhelper_1.4.0.tar.gz’\n\n\nCode\nremotes::install_github(\"NOAA-FIMS/FIMS\")\n\n\n\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes16005df0e401/NOAA-FIMS-FIMS-eca8095/DESCRIPTION’ ... OK\n* preparing ‘FIMS’:\n* checking DESCRIPTION meta-information ... OK\n* cleaning src\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘FIMS_0.3.0.1.tar.gz’\n\n\nCode\nremotes::install_github(\"r4ss/r4ss\")\n\n\nsystemfonts (NA -&gt; 1.2.1   ) [CRAN]\nsys         (NA -&gt; 3.4.3   ) [CRAN]\naskpass     (NA -&gt; 1.2.1   ) [CRAN]\nopenssl     (NA -&gt; 2.3.2   ) [CRAN]\ncurl        (NA -&gt; 6.2.0   ) [CRAN]\nparallelly  (NA -&gt; 1.42.0  ) [CRAN]\nlistenv     (NA -&gt; 0.9.1   ) [CRAN]\nglobals     (NA -&gt; 0.16.3  ) [CRAN]\nsvglite     (NA -&gt; 2.1.3   ) [CRAN]\nrstudioapi  (NA -&gt; 0.17.1  ) [CRAN]\nxml2        (NA -&gt; 1.3.6   ) [CRAN]\nini         (NA -&gt; 0.3.1   ) [CRAN]\nhttr2       (NA -&gt; 1.1.0   ) [CRAN]\ngitcreds    (NA -&gt; 0.1.2   ) [CRAN]\nfuture      (NA -&gt; 1.34.0  ) [CRAN]\nviridis     (NA -&gt; 0.6.5   ) [CRAN]\nkableExtra  (NA -&gt; 1.4.0   ) [CRAN]\ngh          (NA -&gt; 1.4.1   ) [CRAN]\nfurrr       (NA -&gt; 0.3.1   ) [CRAN]\nforcats     (NA -&gt; 1.0.0   ) [CRAN]\ncorpcor     (NA -&gt; 1.6.10  ) [CRAN]\ncoda        (NA -&gt; 0.19-4.1) [CRAN]\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes16006bb76e42/r4ss-r4ss-b2b4418/DESCRIPTION’ ... OK\n* preparing ‘r4ss’:\n* checking DESCRIPTION meta-information ... OK\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘r4ss_1.51.0.tar.gz’\n\n\nCode\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\nggplot2::theme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Gulf of Alaska (GOA) Walleye Pollock\n\nRegion: AFSC\n\nAnalyst: Cole Monnahan",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#the-setup",
    "href": "content/AFSC-GOA-pollock.html#the-setup",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n\n\nCode\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\n\n\nRcppParallel (NA -&gt; 5.1.10    ) [CRAN]\nnumDeriv     (NA -&gt; 2016.8-1.1) [CRAN]\nps           (NA -&gt; 1.8.1     ) [CRAN]\ndistribut... (NA -&gt; 0.5.0     ) [CRAN]\ntensorA      (NA -&gt; 0.36.2.1  ) [CRAN]\nabind        (NA -&gt; 1.4-8     ) [CRAN]\nbackports    (NA -&gt; 1.5.0     ) [CRAN]\nprocessx     (NA -&gt; 3.8.5     ) [CRAN]\ndesc         (NA -&gt; 1.4.3     ) [CRAN]\ncallr        (NA -&gt; 3.7.6     ) [CRAN]\nposterior    (NA -&gt; 1.6.0     ) [CRAN]\nmatrixStats  (NA -&gt; 1.5.0     ) [CRAN]\ncheckmate    (NA -&gt; 2.3.2     ) [CRAN]\nBH           (NA -&gt; 1.87.0-1  ) [CRAN]\nQuickJSR     (NA -&gt; 1.5.1     ) [CRAN]\npkgbuild     (NA -&gt; 1.4.6     ) [CRAN]\nloo          (NA -&gt; 2.8.0     ) [CRAN]\ngridExtra    (NA -&gt; 2.3       ) [CRAN]\ninline       (NA -&gt; 0.3.21    ) [CRAN]\nStanHeaders  (NA -&gt; 2.32.10   ) [CRAN]\nrstan        (NA -&gt; 2.32.6    ) [CRAN]\ntmbstan      (NA -&gt; 1.0.91    ) [CRAN]\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes160034a08337/kaskr-TMB_contrib_R-d275e52/TMBhelper/DESCRIPTION’ ... OK\n* preparing ‘TMBhelper’:\n* checking DESCRIPTION meta-information ... OK\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘TMBhelper_1.4.0.tar.gz’\n\n\nCode\nremotes::install_github(\"NOAA-FIMS/FIMS\")\n\n\n\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes16005df0e401/NOAA-FIMS-FIMS-eca8095/DESCRIPTION’ ... OK\n* preparing ‘FIMS’:\n* checking DESCRIPTION meta-information ... OK\n* cleaning src\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘FIMS_0.3.0.1.tar.gz’\n\n\nCode\nremotes::install_github(\"r4ss/r4ss\")\n\n\nsystemfonts (NA -&gt; 1.2.1   ) [CRAN]\nsys         (NA -&gt; 3.4.3   ) [CRAN]\naskpass     (NA -&gt; 1.2.1   ) [CRAN]\nopenssl     (NA -&gt; 2.3.2   ) [CRAN]\ncurl        (NA -&gt; 6.2.0   ) [CRAN]\nparallelly  (NA -&gt; 1.42.0  ) [CRAN]\nlistenv     (NA -&gt; 0.9.1   ) [CRAN]\nglobals     (NA -&gt; 0.16.3  ) [CRAN]\nsvglite     (NA -&gt; 2.1.3   ) [CRAN]\nrstudioapi  (NA -&gt; 0.17.1  ) [CRAN]\nxml2        (NA -&gt; 1.3.6   ) [CRAN]\nini         (NA -&gt; 0.3.1   ) [CRAN]\nhttr2       (NA -&gt; 1.1.0   ) [CRAN]\ngitcreds    (NA -&gt; 0.1.2   ) [CRAN]\nfuture      (NA -&gt; 1.34.0  ) [CRAN]\nviridis     (NA -&gt; 0.6.5   ) [CRAN]\nkableExtra  (NA -&gt; 1.4.0   ) [CRAN]\ngh          (NA -&gt; 1.4.1   ) [CRAN]\nfurrr       (NA -&gt; 0.3.1   ) [CRAN]\nforcats     (NA -&gt; 1.0.0   ) [CRAN]\ncorpcor     (NA -&gt; 1.6.10  ) [CRAN]\ncoda        (NA -&gt; 0.19-4.1) [CRAN]\n\n\n\nThe downloaded binary packages are in\n    /var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T//RtmpM0vRmi/downloaded_packages\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/private/var/folders/2s/h6hvv9ps03xgz_krkkstvq_r0000gn/T/RtmpM0vRmi/remotes16006bb76e42/r4ss-r4ss-b2b4418/DESCRIPTION’ ... OK\n* preparing ‘r4ss’:\n* checking DESCRIPTION meta-information ... OK\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘r4ss_1.51.0.tar.gz’\n\n\nCode\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\nggplot2::theme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Gulf of Alaska (GOA) Walleye Pollock\n\nRegion: AFSC\n\nAnalyst: Cole Monnahan",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#simplifications-to-the-original-assessment",
    "href": "content/AFSC-GOA-pollock.html#simplifications-to-the-original-assessment",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Simplifications to the original assessment",
    "text": "Simplifications to the original assessment\nThe model presented in this case study was changed substantially from the operational version and should not be considered reflective of the pollock stock. This is intended as a demonstration and nothing more.\nTo get the opertional model to more closely match FIMS I:\n\nDroped surveys 1, 4, and 5\nRemoved ageing error\nRemoved length compositions\nRemoved bias correction in log-normal index likelihoods\nSimplified catchability of survey 3 to be constant in time (removed random walk)\nUpdated maturity to be parametric rather than empirical\nUsed constant weight at age for all sources: spawning, fishery, surveys, and biomass calculations. The same matrix was used throughout.\nChangee timing to be Jan 1 for spawning and all surveys\nRemoved prior on catchability for survey 2\nRemoved time-varying fisheries selectivity (constant double logistic)\nTook off normalization of selectivity\nRemoved age accumulation for fishery age compositions",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#script-to-prepare-data-for-building-fims-object",
    "href": "content/AFSC-GOA-pollock.html#script-to-prepare-data-for-building-fims-object",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Script to prepare data for building FIMS object",
    "text": "Script to prepare data for building FIMS object\n\n\nCode\n## define the dimensions and global variables\nyears &lt;- 1970:2023\nnyears &lt;- length(years)\nnseasons &lt;- 1\nnages &lt;- 10\nages &lt;- 1:nages\n## This will fit the models bridging to FIMS (simplifying)\n## source(\"fit_bridge_models.R\")\n## compare changes to model\npkfitfinal &lt;- readRDS(\"data_files/pkfitfinal.RDS\")\npkfit0 &lt;- readRDS(\"data_files/pkfit0.RDS\")\nparfinal &lt;- pkfitfinal$obj$env$parList()\npkinput0 &lt;- readRDS('data_files/pkinput0.RDS')\nfimsdat &lt;- pkdat0 &lt;- pkinput0$dat\npkinput &lt;- readRDS('data_files/pkinput.RDS')",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#run-fims-model-without-using-wrapper-functions",
    "href": "content/AFSC-GOA-pollock.html#run-fims-model-without-using-wrapper-functions",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Run FIMS model without using wrapper functions",
    "text": "Run FIMS model without using wrapper functions\n\n\nCode\n## set up FIMS data objects\nFIMS::clear()\nestimate_fish_selex &lt;- TRUE\nestimate_survey_selex &lt;- TRUE\nestimate_q2 &lt;- TRUE\nestimate_q3 &lt;- TRUE\nestimate_q6 &lt;- TRUE\nestimate_F &lt;- TRUE\nestimate_recdevs &lt;- TRUE\n\n# Set up a FIMS model without wrapper functions\nsource(\"R/pk_prepare_FIMS_inputs.R\")\n\n## make FIMS model\nsuccess &lt;- CreateTMBModel()\nparameters &lt;- list(p = get_fixed())\nobj &lt;- TMB::MakeADFun(data = list(), parameters, DLL = \"FIMS\", silent = TRUE)\n## report values for the two models\nrep0 &lt;- pkfitfinal$rep\nrep1 &lt;- obj$report() # FIMS initial values\n## try fitting the model\n# use nlminb() to match FIMS::fit_fims()\n# opt &lt;- TMBhelper::fit_tmb(obj, getsd=FALSE, newtonsteps=0, control=list(trace=100))\nopt &lt;- with(obj, nlminb(\n  start = par,\n  objective = fn,\n  gradient = gr,\n  control = list(\n    eval.max = 10000,\n    iter.max = 10000,\n    trace = 0\n  )\n))\nmax(abs(obj$gr())) # from Cole, can use TMBhelper::fit_tmb to get val to &lt;1e-10\nrep2 &lt;- obj$report(obj$env$last.par.best) ## FIMS after estimation",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#output-plotting",
    "href": "content/AFSC-GOA-pollock.html#output-plotting",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Output plotting",
    "text": "Output plotting\n\n\nCode\n## Output plotting\nout1 &lt;- get_long_outputs(rep1, rep0) %&gt;%\n  mutate(platform=ifelse(platform=='FIMS', 'FIMS init', 'TMB'))\nout2 &lt;- get_long_outputs(rep2, rep0) %&gt;% filter(platform=='FIMS') %&gt;%\n  mutate(platform='FIMS opt')\nout &lt;- rbind(out1,out2)\ng &lt;- ggplot(out, aes(year, value, color=platform)) + geom_line() +\n  facet_wrap('name', scales='free') + ylim(0,NA) +\n  labs(x=NULL, y=NULL)\nggsave('figures/AFSC_PK_ts_comparison.png', g, width=9, height=5, units='in')\ng &lt;- ggplot(filter(out, platform!='TMB'), aes(year, relerror, color=platform)) + geom_line() +\n  facet_wrap('name', scales='free') +\n  labs(x=NULL, y='Relative difference') + coord_cartesian(ylim=c(-.5,.5))\nggsave('figures/AFSC_PK_ts_comparison_relerror.png', g, width=9, height=5, units='in')\n\n## Quick check on age comp fits\np1 &lt;- get_acomp_fits(rep0, rep1, rep2, fleet=1, years=pkdat0$fshyrs)\ng &lt;- ggplot(p1, aes(age, paa, color=platform)) + facet_wrap('year') + geom_line()\nggsave('figures/AFSC_PK_age_comp_fits_1.png', g, width=9, height=8, units='in')\np2 &lt;- get_acomp_fits(rep0, rep1, rep2, fleet=2, years=pkdat0$srv_acyrs2)\ng &lt;- ggplot(p2, aes(age, paa, color=platform)) + facet_wrap('year') + geom_line()\nggsave('figures/AFSC_PK_age_comp_fits_2.png', g, width=9, height=8, units='in')\n## p3 &lt;- get_acomp_fits(rep0, rep1, rep2, fleet=3, years=pkdat0$srv_acyrs3)\n## g &lt;- ggplot(p3, aes(age, paa, color=platform)) + facet_wrap('year') + geom_line()\n## p6 &lt;- get_acomp_fits(rep0, rep1, rep2, fleet=4, years=pkdat0$srv_acyrs6)\n## g &lt;- ggplot(p6, aes(age, paa, color=platform)) + facet_wrap('year') + geom_line()\n\n## index fits\naddsegs &lt;- function(yrs, obs, CV){\n  getlwr &lt;- function(obs, CV) qlnorm(p=.025, meanlog=log(obs), sdlog=sqrt(log(1+CV^2)))\n  getupr &lt;- function(obs, CV) qlnorm(p=.975, meanlog=log(obs), sdlog=sqrt(log(1+CV^2)))\n  segments(yrs, y0=getlwr(obs,CV), y1=getupr(obs,CV))\n  points(yrs, obs, pch=22, bg='white')\n}\npng('figures/AFSC_PK_index_fits.png', res=300, width=6, height=7, units='in')\npar(mfrow=c(3,1), mar=c(3,3,.5,.5), mgp=c(1.5,.5,0), tck=-0.02)\nplot(years, rep0$Eindxsurv2, type='l',\n     ylim=c(0,2), lwd=5.5,\n      xlab=NA, ylab='Biomass (million t)')\nx1 &lt;- out1 %&gt;% filter(name=='Index2' & platform=='FIMS init')\nx2 &lt;- out2 %&gt;% filter(name=='Index2' & platform=='FIMS opt')\nlines(years,x1$value, col=2, lwd=1.5)\nlines(years,x2$value, col=3, lwd=1.5)\naddsegs(yrs=pkdat0$srvyrs2, obs=pkdat0$indxsurv2, CV=pkdat0$indxsurv_log_sd2)\nlegend('topright', legend=c('TMB', 'FIMS init', 'FIMS opt'), lty=1, col=1:3)\nmtext('Survey 2', line=-1.5)\nplot(years, rep0$Eindxsurv3, type='l',\n     ylim=c(0,.6), lwd=5.5,\n      xlab=NA, ylab='Biomass (million t)')\nx1 &lt;- out1 %&gt;% filter(name=='Index3' & platform=='FIMS init')\nx2 &lt;- out2 %&gt;% filter(name=='Index3' & platform=='FIMS opt')\nlines(years,x1$value, col=2, lwd=1.5)\nlines(years,x2$value, col=3, lwd=1.5)\naddsegs(yrs=pkdat0$srvyrs3, obs=pkdat0$indxsurv3, CV=pkdat0$indxsurv_log_sd3)\nmtext('Survey 3', line=-1.5)\nlegend('topright', legend=c('TMB', 'FIMS init', 'FIMS opt'), lty=1, col=1:3)\nplot(years, rep0$Eindxsurv6, type='l',\n     ylim=c(0,2.6), lwd=5.5,\n      xlab=NA, ylab='Biomass (million t)')\nx1 &lt;- out1 %&gt;% filter(name=='Index6' & platform=='FIMS init')\nx2 &lt;- out2 %&gt;% filter(name=='Index6' & platform=='FIMS opt')\nlines(years,x1$value, col=2, lwd=1.5)\nlines(years,x2$value, col=3, lwd=1.5)\naddsegs(yrs=pkdat0$srvyrs6, obs=pkdat0$indxsurv6, CV=pkdat0$indxsurv_log_sd6)\nmtext('Survey 6', line=-1.5)\nlegend('topright', legend=c('TMB', 'FIMS init', 'FIMS opt'), lty=1, col=1:3)\ndev.off()\n\n\nquartz_off_screen \n                2",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#comparison-figures-for-basic-model",
    "href": "content/AFSC-GOA-pollock.html#comparison-figures-for-basic-model",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Comparison figures for basic model",
    "text": "Comparison figures for basic model",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#extra-analyses",
    "href": "content/AFSC-GOA-pollock.html#extra-analyses",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Extra analyses",
    "text": "Extra analyses\nTwo extra analyses are demonstrated. First is a likelihood profile over lnR0, showing component contributions and testing for data conflict (a Piner plot). The second is to run the model through the ‘Stan’ software using the ‘tmbstan’ R package. This samples from the posterior, which are put back into the model to get the posterior distribution for spawning stock biomass. Given its long run time the results are saved to a file and read in for post-hoc plotting.\n\n\nCode\n## Try a likelihood profile\n# TODO: Received the following note when running the code below:\n# \"Note that `getReportCovariance=FALSE` causes an error in `TMB::sdreport` when no ADREPORTed variables are present\".\n# Flag this for Cole to verify.\ni &lt;- 68 # this will break if model is changed at all\nmap &lt;- parameters\nmap$p[i] &lt;- NA # map off R0 specified below\nmap$p &lt;- as.factor(map$p)\nxseq &lt;- as.numeric(c(opt$par[i],  seq(22,24, len=30)))\nres &lt;- list()\nfor(j in 1:length(xseq)){\n  print(j)\n  parameters$p[i] &lt;- xseq[j]\n  obj2 &lt;- MakeADFun(data = list(), parameters, DLL = \"FIMS\", silent = TRUE, map=map)\n  opt2 &lt;- TMBhelper::fit_tmb(obj2, getsd=FALSE, newtonsteps=0, control=list(trace=0))\n  out &lt;- obj2$report(obj2$env$last.par.best)\n  nll_components &lt;- out$nll_components\n  index_nll &lt;- sum(nll_components[seq(2, length(nll_components), by = 2)])\n  age_comp_nll &lt;- sum(nll_components[seq(3, length(nll_components), by = 2)])\n  res[[j]] &lt;- data.frame(\n    j = j, lnR0 = xseq[j], total = out$jnll, index = index_nll,\n    age = age_comp_nll, recruit = out$nll_components[1], maxgrad = max(abs(obj$gr()))\n  )\n}\nres &lt;- bind_rows(res) %&gt;%\n  pivot_longer( cols=c(total, index, age, recruit)) %&gt;%\n  group_by(name) %&gt;% mutate(deltaNLL=value-min(value))\ng &lt;- ggplot(res, aes(lnR0, deltaNLL, color=name)) + geom_line()\ng &lt;- g+ geom_point(data=filter(res, deltaNLL==0), size=2) +\n  labs(y='Delta NLL', color='NLL component')\nggsave('figures/AFSC_PK_like_profile_R0.png', g, width=7, height=3.5)\n\n\n\n## ## Try Bayesian\n## library(tmbstan)\n## library(shinystan)\n## ## Some paraemters wandering off to Inf so fix those (need\n## ## priors). Needs a ton of work but is proof of concept. Major\n## ## problem is parallel fails.\n## map &lt;- parameters\n## ## parameters$p[65:66]\n## map$p[65:66] &lt;- NA # map off R0 specified below\n## map$p &lt;- as.factor(map$p)\n## obj3 &lt;- MakeADFun(data = list(), parameters, DLL = \"FIMS\", silent=TRUE, map=map)\n## opt3 &lt;- TMBhelper::fit_tmb(obj3, getsd=FALSE, newtonsteps=0, control=list(trace=0))\n## ## Fails when trying to do this in parallel unfortunately\n## fit &lt;- tmbstan(obj3, chains=1, cores=1, open_progress=FALSE,\n##                init='last.par.best', control=list(max_treedepth=10))\n## launch_shinystan(fit)\n## df &lt;- as.data.frame(fit)\n## df &lt;- df[,-ncol(df)] # drop lp__\n## ## for each posterior draw, report to get SSB\n## postreps &lt;- list()\n## for(ii in 1:nrow(df)){\n##   if(ii %% 10==0) print(ii)\n##   postreps[[ii]] &lt;- obj3$rep(df[ii,])\n## }\n## ssbpost &lt;- lapply(postreps, function(x) data.frame(year=years, ssb=x$ssb[[1]][-55]))%&gt;%\n##   bind_rows %&gt;% mutate(rep=rep(1:nrow(df), each=54))\n## saveRDS(ssbpost, file='pk_SSB_posteriors.RDS')\nssbpost &lt;- readRDS('data_files/pk_pollock_SSB_posteriors.RDS')\ng &lt;- ggplot(ssbpost, aes(year, ssb/1e9, group=rep)) + geom_line(alpha=.1) +\n  ylim(0,NA) + labs(x=NULL, y='SSB (M t)', title='Posterior demo (unconverged!)')\nggsave('figures/AFSC_PK_ssb_posterior.png', g, width=7, height=4, units='in')",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#plots-for-extra-analyses",
    "href": "content/AFSC-GOA-pollock.html#plots-for-extra-analyses",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Plots for extra analyses",
    "text": "Plots for extra analyses",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#run-fims-model-using-wrapper-functions",
    "href": "content/AFSC-GOA-pollock.html#run-fims-model-using-wrapper-functions",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Run FIMS model using wrapper functions",
    "text": "Run FIMS model using wrapper functions\n\n\nCode\nFIMS::clear()\n# set up selectivities for fleets and survey\nfleet1 &lt;- survey2 &lt;- survey6 &lt;- list(\n  selectivity = list(form = \"DoubleLogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\n\nsurvey3 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\n\nfleets &lt;- list(\n  fleet1 = fleet1,\n  survey2 = survey2,\n  survey3 = survey3,\n  survey6 = survey6\n)\n\n# Create parameters list and update default values for parameters\nparameters_with_wrappers &lt;- data_4_model |&gt;\n  create_default_parameters(fleets = fleets) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet1 = list(\n        DoubleLogisticSelectivity.inflection_point_asc.value = parfinal$inf1_fsh_mean,\n        DoubleLogisticSelectivity.slope_asc.value = exp(parfinal$log_slp1_fsh_mean),\n        DoubleLogisticSelectivity.inflection_point_desc.value = parfinal$inf2_fsh_mean,\n        DoubleLogisticSelectivity.slope_desc.value = exp(parfinal$log_slp2_fsh_mean),\n        Fleet.log_Fmort.value = log(pkfitfinal$rep$F)\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      survey2 = list(\n        DoubleLogisticSelectivity.inflection_point_asc.value = parfinal$inf1_srv2,\n        DoubleLogisticSelectivity.slope_asc.value = exp(parfinal$log_slp1_srv2),\n        DoubleLogisticSelectivity.inflection_point_desc.value = parfinal$inf2_srv2,\n        DoubleLogisticSelectivity.inflection_point_desc.estimated = FALSE,\n        DoubleLogisticSelectivity.slope_desc.value = exp(parfinal$log_slp2_srv2),\n        DoubleLogisticSelectivity.slope_desc.estimated = FALSE,\n        Fleet.log_q.value = parfinal$log_q2_mean\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      survey3 = list(\n        LogisticSelectivity.inflection_point.value = parfinal$inf1_srv3,\n        LogisticSelectivity.slope.value = exp(parfinal$log_slp1_srv3),\n        Fleet.log_q.value = parfinal$log_q3_mean\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      survey6 = list(\n        DoubleLogisticSelectivity.inflection_point_asc.value = parfinal$inf1_srv6,\n        DoubleLogisticSelectivity.inflection_point_asc.estimated = FALSE,\n        DoubleLogisticSelectivity.slope_asc.value = exp(parfinal$log_slp1_srv6),\n        DoubleLogisticSelectivity.slope_asc.estimated = FALSE,\n        DoubleLogisticSelectivity.inflection_point_desc.value = parfinal$inf2_srv6,\n        DoubleLogisticSelectivity.slope_desc.value = exp(parfinal$log_slp2_srv6),\n        Fleet.log_q.value = parfinal$log_q6\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      recruitment = list(\n        BevertonHoltRecruitment.log_rzero.value = parfinal$mean_log_recruit + log(1e9),\n        BevertonHoltRecruitment.logit_steep.value = -log(1.0 - .99999) + log(.99999 - 0.2),\n        BevertonHoltRecruitment.log_devs.value = parfinal$dev_log_recruit[-1],\n        DnormDistribution.log_sd.value = parfinal$sigmaR\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      maturity = list(\n        LogisticMaturity.inflection_point.value = 4.5,\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 1.5,\n        LogisticMaturity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      population = list(\n        Population.log_M.value = log(as.numeric(t(matrix(\n          rep(pkfitfinal$rep$M, each = data_4_model@n_years),\n          nrow = data_4_model@n_years\n        )))),\n        Population.log_init_naa.value = c(log(pkfitfinal$rep$recruit[1]), log(pkfitfinal$rep$initN)) + log(1e9),\n        Population.log_init_naa.estimated = FALSE\n      )\n    )\n  )\n\n# Put it all together, creating the FIMS model and making the TMB fcn\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- parameters_with_wrappers  |&gt;\n  initialize_fims(data = data_4_model) |&gt;\n  fit_fims(optimize = FALSE)\nget_obj(test_fit)$report()$nll_components |&gt; length()\n\n\n[1] 9\n\n\nCode\nget_data(data_4_model) |&gt; dplyr::filter(name == \"fleet1\", type == \"age\") |&gt; print(n = 300)\n\n\n# A tibble: 540 × 9\n    type  name     age datestart  dateend         value unit  uncertainty  year\n    &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;date&gt;     &lt;date&gt;          &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;\n  1 age   fleet1     1 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  2 age   fleet1     2 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  3 age   fleet1     3 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  4 age   fleet1     4 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  5 age   fleet1     5 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  6 age   fleet1     6 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  7 age   fleet1     7 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  8 age   fleet1     8 1970-01-01 1970-12-31 -999       \"\"          1      1970\n  9 age   fleet1     9 1970-01-01 1970-12-31 -999       \"\"          1      1970\n 10 age   fleet1    10 1970-01-01 1970-12-31 -999       \"\"          1      1970\n 11 age   fleet1     1 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 12 age   fleet1     2 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 13 age   fleet1     3 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 14 age   fleet1     4 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 15 age   fleet1     5 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 16 age   fleet1     6 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 17 age   fleet1     7 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 18 age   fleet1     8 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 19 age   fleet1     9 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 20 age   fleet1    10 1971-01-01 1971-12-31 -999       \"\"          1      1971\n 21 age   fleet1     1 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 22 age   fleet1     2 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 23 age   fleet1     3 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 24 age   fleet1     4 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 25 age   fleet1     5 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 26 age   fleet1     6 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 27 age   fleet1     7 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 28 age   fleet1     8 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 29 age   fleet1     9 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 30 age   fleet1    10 1972-01-01 1972-12-31 -999       \"\"          1      1972\n 31 age   fleet1     1 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 32 age   fleet1     2 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 33 age   fleet1     3 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 34 age   fleet1     4 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 35 age   fleet1     5 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 36 age   fleet1     6 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 37 age   fleet1     7 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 38 age   fleet1     8 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 39 age   fleet1     9 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 40 age   fleet1    10 1973-01-01 1973-12-31 -999       \"\"          1      1973\n 41 age   fleet1     1 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 42 age   fleet1     2 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 43 age   fleet1     3 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 44 age   fleet1     4 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 45 age   fleet1     5 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 46 age   fleet1     6 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 47 age   fleet1     7 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 48 age   fleet1     8 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 49 age   fleet1     9 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 50 age   fleet1    10 1974-01-01 1974-12-31 -999       \"\"          1      1974\n 51 age   fleet1     1 1975-01-01 1975-12-31    0       \"\"          0.369  1975\n 52 age   fleet1     2 1975-01-01 1975-12-31    0.0236  \"\"          0.369  1975\n 53 age   fleet1     3 1975-01-01 1975-12-31    0.544   \"\"          0.369  1975\n 54 age   fleet1     4 1975-01-01 1975-12-31    0.169   \"\"          0.369  1975\n 55 age   fleet1     5 1975-01-01 1975-12-31    0.142   \"\"          0.369  1975\n 56 age   fleet1     6 1975-01-01 1975-12-31    0.0668  \"\"          0.369  1975\n 57 age   fleet1     7 1975-01-01 1975-12-31    0.0277  \"\"          0.369  1975\n 58 age   fleet1     8 1975-01-01 1975-12-31    0.0270  \"\"          0.369  1975\n 59 age   fleet1     9 1975-01-01 1975-12-31    0       \"\"          0.369  1975\n 60 age   fleet1    10 1975-01-01 1975-12-31    0       \"\"          0.369  1975\n 61 age   fleet1     1 1976-01-01 1976-12-31    0       \"\"          8.11   1976\n 62 age   fleet1     2 1976-01-01 1976-12-31    0.00887 \"\"          8.11   1976\n 63 age   fleet1     3 1976-01-01 1976-12-31    0.108   \"\"          8.11   1976\n 64 age   fleet1     4 1976-01-01 1976-12-31    0.577   \"\"          8.11   1976\n 65 age   fleet1     5 1976-01-01 1976-12-31    0.187   \"\"          8.11   1976\n 66 age   fleet1     6 1976-01-01 1976-12-31    0.0780  \"\"          8.11   1976\n 67 age   fleet1     7 1976-01-01 1976-12-31    0.0172  \"\"          8.11   1976\n 68 age   fleet1     8 1976-01-01 1976-12-31    0.0134  \"\"          8.11   1976\n 69 age   fleet1     9 1976-01-01 1976-12-31    0.00918 \"\"          8.11   1976\n 70 age   fleet1    10 1976-01-01 1976-12-31    0.00111 \"\"          8.11   1976\n 71 age   fleet1     1 1977-01-01 1977-12-31    0.00023 \"\"         70.8    1977\n 72 age   fleet1     2 1977-01-01 1977-12-31    0.0357  \"\"         70.8    1977\n 73 age   fleet1     3 1977-01-01 1977-12-31    0.0601  \"\"         70.8    1977\n 74 age   fleet1     4 1977-01-01 1977-12-31    0.138   \"\"         70.8    1977\n 75 age   fleet1     5 1977-01-01 1977-12-31    0.522   \"\"         70.8    1977\n 76 age   fleet1     6 1977-01-01 1977-12-31    0.151   \"\"         70.8    1977\n 77 age   fleet1     7 1977-01-01 1977-12-31    0.0566  \"\"         70.8    1977\n 78 age   fleet1     8 1977-01-01 1977-12-31    0.0147  \"\"         70.8    1977\n 79 age   fleet1     9 1977-01-01 1977-12-31    0.0130  \"\"         70.8    1977\n 80 age   fleet1    10 1977-01-01 1977-12-31    0.00921 \"\"         70.8    1977\n 81 age   fleet1     1 1978-01-01 1978-12-31    0.00186 \"\"         73.7    1978\n 82 age   fleet1     2 1978-01-01 1978-12-31    0.0659  \"\"         73.7    1978\n 83 age   fleet1     3 1978-01-01 1978-12-31    0.210   \"\"         73.7    1978\n 84 age   fleet1     4 1978-01-01 1978-12-31    0.148   \"\"         73.7    1978\n 85 age   fleet1     5 1978-01-01 1978-12-31    0.147   \"\"         73.7    1978\n 86 age   fleet1     6 1978-01-01 1978-12-31    0.285   \"\"         73.7    1978\n 87 age   fleet1     7 1978-01-01 1978-12-31    0.0823  \"\"         73.7    1978\n 88 age   fleet1     8 1978-01-01 1978-12-31    0.0350  \"\"         73.7    1978\n 89 age   fleet1     9 1978-01-01 1978-12-31    0.0130  \"\"         73.7    1978\n 90 age   fleet1    10 1978-01-01 1978-12-31    0.0120  \"\"         73.7    1978\n 91 age   fleet1     1 1979-01-01 1979-12-31    0.00049 \"\"         73.7    1979\n 92 age   fleet1     2 1979-01-01 1979-12-31    0.0179  \"\"         73.7    1979\n 93 age   fleet1     3 1979-01-01 1979-12-31    0.282   \"\"         73.7    1979\n 94 age   fleet1     4 1979-01-01 1979-12-31    0.462   \"\"         73.7    1979\n 95 age   fleet1     5 1979-01-01 1979-12-31    0.0736  \"\"         73.7    1979\n 96 age   fleet1     6 1979-01-01 1979-12-31    0.0490  \"\"         73.7    1979\n 97 age   fleet1     7 1979-01-01 1979-12-31    0.0670  \"\"         73.7    1979\n 98 age   fleet1     8 1979-01-01 1979-12-31    0.0308  \"\"         73.7    1979\n 99 age   fleet1     9 1979-01-01 1979-12-31    0.0120  \"\"         73.7    1979\n100 age   fleet1    10 1979-01-01 1979-12-31    0.00445 \"\"         73.7    1979\n101 age   fleet1     1 1980-01-01 1980-12-31    0.00271 \"\"         73.7    1980\n102 age   fleet1     2 1980-01-01 1980-12-31    0.0545  \"\"         73.7    1980\n103 age   fleet1     3 1980-01-01 1980-12-31    0.154   \"\"         73.7    1980\n104 age   fleet1     4 1980-01-01 1980-12-31    0.324   \"\"         73.7    1980\n105 age   fleet1     5 1980-01-01 1980-12-31    0.234   \"\"         73.7    1980\n106 age   fleet1     6 1980-01-01 1980-12-31    0.0771  \"\"         73.7    1980\n107 age   fleet1     7 1980-01-01 1980-12-31    0.0596  \"\"         73.7    1980\n108 age   fleet1     8 1980-01-01 1980-12-31    0.0542  \"\"         73.7    1980\n109 age   fleet1     9 1980-01-01 1980-12-31    0.0274  \"\"         73.7    1980\n110 age   fleet1    10 1980-01-01 1980-12-31    0.0131  \"\"         73.7    1980\n111 age   fleet1     1 1981-01-01 1981-12-31    0.00106 \"\"         73.7    1981\n112 age   fleet1     2 1981-01-01 1981-12-31    0.0226  \"\"         73.7    1981\n113 age   fleet1     3 1981-01-01 1981-12-31    0.166   \"\"         73.7    1981\n114 age   fleet1     4 1981-01-01 1981-12-31    0.343   \"\"         73.7    1981\n115 age   fleet1     5 1981-01-01 1981-12-31    0.276   \"\"         73.7    1981\n116 age   fleet1     6 1981-01-01 1981-12-31    0.110   \"\"         73.7    1981\n117 age   fleet1     7 1981-01-01 1981-12-31    0.0316  \"\"         73.7    1981\n118 age   fleet1     8 1981-01-01 1981-12-31    0.0274  \"\"         73.7    1981\n119 age   fleet1     9 1981-01-01 1981-12-31    0.0195  \"\"         73.7    1981\n120 age   fleet1    10 1981-01-01 1981-12-31    0.00319 \"\"         73.7    1981\n121 age   fleet1     1 1982-01-01 1982-12-31    0.00015 \"\"         73.7    1982\n122 age   fleet1     2 1982-01-01 1982-12-31    0.0348  \"\"         73.7    1982\n123 age   fleet1     3 1982-01-01 1982-12-31    0.152   \"\"         73.7    1982\n124 age   fleet1     4 1982-01-01 1982-12-31    0.338   \"\"         73.7    1982\n125 age   fleet1     5 1982-01-01 1982-12-31    0.265   \"\"         73.7    1982\n126 age   fleet1     6 1982-01-01 1982-12-31    0.157   \"\"         73.7    1982\n127 age   fleet1     7 1982-01-01 1982-12-31    0.0400  \"\"         73.7    1982\n128 age   fleet1     8 1982-01-01 1982-12-31    0.00625 \"\"         73.7    1982\n129 age   fleet1     9 1982-01-01 1982-12-31    0.00401 \"\"         73.7    1982\n130 age   fleet1    10 1982-01-01 1982-12-31    0.00295 \"\"         73.7    1982\n131 age   fleet1     1 1983-01-01 1983-12-31    0       \"\"         73.7    1983\n132 age   fleet1     2 1983-01-01 1983-12-31    0.0195  \"\"         73.7    1983\n133 age   fleet1     3 1983-01-01 1983-12-31    0.119   \"\"         73.7    1983\n134 age   fleet1     4 1983-01-01 1983-12-31    0.229   \"\"         73.7    1983\n135 age   fleet1     5 1983-01-01 1983-12-31    0.342   \"\"         73.7    1983\n136 age   fleet1     6 1983-01-01 1983-12-31    0.167   \"\"         73.7    1983\n137 age   fleet1     7 1983-01-01 1983-12-31    0.0930  \"\"         73.7    1983\n138 age   fleet1     8 1983-01-01 1983-12-31    0.0245  \"\"         73.7    1983\n139 age   fleet1     9 1983-01-01 1983-12-31    0.00478 \"\"         73.7    1983\n140 age   fleet1    10 1983-01-01 1983-12-31    0.002   \"\"         73.7    1983\n141 age   fleet1     1 1984-01-01 1984-12-31    0.00176 \"\"         73.7    1984\n142 age   fleet1     2 1984-01-01 1984-12-31    0.0131  \"\"         73.7    1984\n143 age   fleet1     3 1984-01-01 1984-12-31    0.155   \"\"         73.7    1984\n144 age   fleet1     4 1984-01-01 1984-12-31    0.166   \"\"         73.7    1984\n145 age   fleet1     5 1984-01-01 1984-12-31    0.203   \"\"         73.7    1984\n146 age   fleet1     6 1984-01-01 1984-12-31    0.302   \"\"         73.7    1984\n147 age   fleet1     7 1984-01-01 1984-12-31    0.109   \"\"         73.7    1984\n148 age   fleet1     8 1984-01-01 1984-12-31    0.0370  \"\"         73.7    1984\n149 age   fleet1     9 1984-01-01 1984-12-31    0.0123  \"\"         73.7    1984\n150 age   fleet1    10 1984-01-01 1984-12-31    0.00176 \"\"         73.7    1984\n151 age   fleet1     1 1985-01-01 1985-12-31    0.00061 \"\"         73.7    1985\n152 age   fleet1     2 1985-01-01 1985-12-31    0.0348  \"\"         73.7    1985\n153 age   fleet1     3 1985-01-01 1985-12-31    0.0223  \"\"         73.7    1985\n154 age   fleet1     4 1985-01-01 1985-12-31    0.109   \"\"         73.7    1985\n155 age   fleet1     5 1985-01-01 1985-12-31    0.118   \"\"         73.7    1985\n156 age   fleet1     6 1985-01-01 1985-12-31    0.212   \"\"         73.7    1985\n157 age   fleet1     7 1985-01-01 1985-12-31    0.352   \"\"         73.7    1985\n158 age   fleet1     8 1985-01-01 1985-12-31    0.110   \"\"         73.7    1985\n159 age   fleet1     9 1985-01-01 1985-12-31    0.0309  \"\"         73.7    1985\n160 age   fleet1    10 1985-01-01 1985-12-31    0.0105  \"\"         73.7    1985\n161 age   fleet1     1 1986-01-01 1986-12-31    0.0120  \"\"         32.1    1986\n162 age   fleet1     2 1986-01-01 1986-12-31    0.0727  \"\"         32.1    1986\n163 age   fleet1     3 1986-01-01 1986-12-31    0.176   \"\"         32.1    1986\n164 age   fleet1     4 1986-01-01 1986-12-31    0.106   \"\"         32.1    1986\n165 age   fleet1     5 1986-01-01 1986-12-31    0.234   \"\"         32.1    1986\n166 age   fleet1     6 1986-01-01 1986-12-31    0.0994  \"\"         32.1    1986\n167 age   fleet1     7 1986-01-01 1986-12-31    0.108   \"\"         32.1    1986\n168 age   fleet1     8 1986-01-01 1986-12-31    0.131   \"\"         32.1    1986\n169 age   fleet1     9 1986-01-01 1986-12-31    0.0523  \"\"         32.1    1986\n170 age   fleet1    10 1986-01-01 1986-12-31    0.0089  \"\"         32.1    1986\n171 age   fleet1     1 1987-01-01 1987-12-31    0       \"\"         10.3    1987\n172 age   fleet1     2 1987-01-01 1987-12-31    0.0593  \"\"         10.3    1987\n173 age   fleet1     3 1987-01-01 1987-12-31    0.0897  \"\"         10.3    1987\n174 age   fleet1     4 1987-01-01 1987-12-31    0.0799  \"\"         10.3    1987\n175 age   fleet1     5 1987-01-01 1987-12-31    0.0929  \"\"         10.3    1987\n176 age   fleet1     6 1987-01-01 1987-12-31    0.175   \"\"         10.3    1987\n177 age   fleet1     7 1987-01-01 1987-12-31    0.150   \"\"         10.3    1987\n178 age   fleet1     8 1987-01-01 1987-12-31    0.0985  \"\"         10.3    1987\n179 age   fleet1     9 1987-01-01 1987-12-31    0.218   \"\"         10.3    1987\n180 age   fleet1    10 1987-01-01 1987-12-31    0.0369  \"\"         10.3    1987\n181 age   fleet1     1 1988-01-01 1988-12-31    0.0102  \"\"         12.2    1988\n182 age   fleet1     2 1988-01-01 1988-12-31    0.106   \"\"         12.2    1988\n183 age   fleet1     3 1988-01-01 1988-12-31    0.151   \"\"         12.2    1988\n184 age   fleet1     4 1988-01-01 1988-12-31    0.229   \"\"         12.2    1988\n185 age   fleet1     5 1988-01-01 1988-12-31    0.192   \"\"         12.2    1988\n186 age   fleet1     6 1988-01-01 1988-12-31    0.127   \"\"         12.2    1988\n187 age   fleet1     7 1988-01-01 1988-12-31    0.0706  \"\"         12.2    1988\n188 age   fleet1     8 1988-01-01 1988-12-31    0.0324  \"\"         12.2    1988\n189 age   fleet1     9 1988-01-01 1988-12-31    0.00479 \"\"         12.2    1988\n190 age   fleet1    10 1988-01-01 1988-12-31    0.0773  \"\"         12.2    1988\n191 age   fleet1     1 1989-01-01 1989-12-31    0.0275  \"\"         27.3    1989\n192 age   fleet1     2 1989-01-01 1989-12-31    0.0124  \"\"         27.3    1989\n193 age   fleet1     3 1989-01-01 1989-12-31    0.0338  \"\"         27.3    1989\n194 age   fleet1     4 1989-01-01 1989-12-31    0.322   \"\"         27.3    1989\n195 age   fleet1     5 1989-01-01 1989-12-31    0.367   \"\"         27.3    1989\n196 age   fleet1     6 1989-01-01 1989-12-31    0.127   \"\"         27.3    1989\n197 age   fleet1     7 1989-01-01 1989-12-31    0.0487  \"\"         27.3    1989\n198 age   fleet1     8 1989-01-01 1989-12-31    0.0248  \"\"         27.3    1989\n199 age   fleet1     9 1989-01-01 1989-12-31    0.0101  \"\"         27.3    1989\n200 age   fleet1    10 1989-01-01 1989-12-31    0.0264  \"\"         27.3    1989\n201 age   fleet1     1 1990-01-01 1990-12-31    0       \"\"         40.6    1990\n202 age   fleet1     2 1990-01-01 1990-12-31    0.0138  \"\"         40.6    1990\n203 age   fleet1     3 1990-01-01 1990-12-31    0.0174  \"\"         40.6    1990\n204 age   fleet1     4 1990-01-01 1990-12-31    0.0256  \"\"         40.6    1990\n205 age   fleet1     5 1990-01-01 1990-12-31    0.149   \"\"         40.6    1990\n206 age   fleet1     6 1990-01-01 1990-12-31    0.470   \"\"         40.6    1990\n207 age   fleet1     7 1990-01-01 1990-12-31    0.168   \"\"         40.6    1990\n208 age   fleet1     8 1990-01-01 1990-12-31    0.0951  \"\"         40.6    1990\n209 age   fleet1     9 1990-01-01 1990-12-31    0.0230  \"\"         40.6    1990\n210 age   fleet1    10 1990-01-01 1990-12-31    0.0385  \"\"         40.6    1990\n211 age   fleet1     1 1991-01-01 1991-12-31    0       \"\"         60.8    1991\n212 age   fleet1     2 1991-01-01 1991-12-31    0.0123  \"\"         60.8    1991\n213 age   fleet1     3 1991-01-01 1991-12-31    0.0878  \"\"         60.8    1991\n214 age   fleet1     4 1991-01-01 1991-12-31    0.0470  \"\"         60.8    1991\n215 age   fleet1     5 1991-01-01 1991-12-31    0.0415  \"\"         60.8    1991\n216 age   fleet1     6 1991-01-01 1991-12-31    0.0800  \"\"         60.8    1991\n217 age   fleet1     7 1991-01-01 1991-12-31    0.368   \"\"         60.8    1991\n218 age   fleet1     8 1991-01-01 1991-12-31    0.0406  \"\"         60.8    1991\n219 age   fleet1     9 1991-01-01 1991-12-31    0.207   \"\"         60.8    1991\n220 age   fleet1    10 1991-01-01 1991-12-31    0.116   \"\"         60.8    1991\n221 age   fleet1     1 1992-01-01 1992-12-31    0.00104 \"\"         51.2    1992\n222 age   fleet1     2 1992-01-01 1992-12-31    0.0151  \"\"         51.2    1992\n223 age   fleet1     3 1992-01-01 1992-12-31    0.0322  \"\"         51.2    1992\n224 age   fleet1     4 1992-01-01 1992-12-31    0.205   \"\"         51.2    1992\n225 age   fleet1     5 1992-01-01 1992-12-31    0.218   \"\"         51.2    1992\n226 age   fleet1     6 1992-01-01 1992-12-31    0.115   \"\"         51.2    1992\n227 age   fleet1     7 1992-01-01 1992-12-31    0.0833  \"\"         51.2    1992\n228 age   fleet1     8 1992-01-01 1992-12-31    0.173   \"\"         51.2    1992\n229 age   fleet1     9 1992-01-01 1992-12-31    0.0529  \"\"         51.2    1992\n230 age   fleet1    10 1992-01-01 1992-12-31    0.104   \"\"         51.2    1992\n231 age   fleet1     1 1993-01-01 1993-12-31    0.00032 \"\"         53.5    1993\n232 age   fleet1     2 1993-01-01 1993-12-31    0.0196  \"\"         53.5    1993\n233 age   fleet1     3 1993-01-01 1993-12-31    0.0672  \"\"         53.5    1993\n234 age   fleet1     4 1993-01-01 1993-12-31    0.159   \"\"         53.5    1993\n235 age   fleet1     5 1993-01-01 1993-12-31    0.380   \"\"         53.5    1993\n236 age   fleet1     6 1993-01-01 1993-12-31    0.133   \"\"         53.5    1993\n237 age   fleet1     7 1993-01-01 1993-12-31    0.0573  \"\"         53.5    1993\n238 age   fleet1     8 1993-01-01 1993-12-31    0.0545  \"\"         53.5    1993\n239 age   fleet1     9 1993-01-01 1993-12-31    0.0774  \"\"         53.5    1993\n240 age   fleet1    10 1993-01-01 1993-12-31    0.0523  \"\"         53.5    1993\n241 age   fleet1     1 1994-01-01 1994-12-31    0.00059 \"\"         57.1    1994\n242 age   fleet1     2 1994-01-01 1994-12-31    0.00826 \"\"         57.1    1994\n243 age   fleet1     3 1994-01-01 1994-12-31    0.0390  \"\"         57.1    1994\n244 age   fleet1     4 1994-01-01 1994-12-31    0.0711  \"\"         57.1    1994\n245 age   fleet1     5 1994-01-01 1994-12-31    0.312   \"\"         57.1    1994\n246 age   fleet1     6 1994-01-01 1994-12-31    0.279   \"\"         57.1    1994\n247 age   fleet1     7 1994-01-01 1994-12-31    0.112   \"\"         57.1    1994\n248 age   fleet1     8 1994-01-01 1994-12-31    0.0494  \"\"         57.1    1994\n249 age   fleet1     9 1994-01-01 1994-12-31    0.0442  \"\"         57.1    1994\n250 age   fleet1    10 1994-01-01 1994-12-31    0.0836  \"\"         57.1    1994\n251 age   fleet1     1 1995-01-01 1995-12-31    0       \"\"         36.5    1995\n252 age   fleet1     2 1995-01-01 1995-12-31    0.00365 \"\"         36.5    1995\n253 age   fleet1     3 1995-01-01 1995-12-31    0.0271  \"\"         36.5    1995\n254 age   fleet1     4 1995-01-01 1995-12-31    0.0757  \"\"         36.5    1995\n255 age   fleet1     5 1995-01-01 1995-12-31    0.149   \"\"         36.5    1995\n256 age   fleet1     6 1995-01-01 1995-12-31    0.345   \"\"         36.5    1995\n257 age   fleet1     7 1995-01-01 1995-12-31    0.214   \"\"         36.5    1995\n258 age   fleet1     8 1995-01-01 1995-12-31    0.0676  \"\"         36.5    1995\n259 age   fleet1     9 1995-01-01 1995-12-31    0.0323  \"\"         36.5    1995\n260 age   fleet1    10 1995-01-01 1995-12-31    0.0860  \"\"         36.5    1995\n261 age   fleet1     1 1996-01-01 1996-12-31    0       \"\"         23.6    1996\n262 age   fleet1     2 1996-01-01 1996-12-31    0.0175  \"\"         23.6    1996\n263 age   fleet1     3 1996-01-01 1996-12-31    0.0425  \"\"         23.6    1996\n264 age   fleet1     4 1996-01-01 1996-12-31    0.0314  \"\"         23.6    1996\n265 age   fleet1     5 1996-01-01 1996-12-31    0.0893  \"\"         23.6    1996\n266 age   fleet1     6 1996-01-01 1996-12-31    0.123   \"\"         23.6    1996\n267 age   fleet1     7 1996-01-01 1996-12-31    0.238   \"\"         23.6    1996\n268 age   fleet1     8 1996-01-01 1996-12-31    0.255   \"\"         23.6    1996\n269 age   fleet1     9 1996-01-01 1996-12-31    0.0835  \"\"         23.6    1996\n270 age   fleet1    10 1996-01-01 1996-12-31    0.120   \"\"         23.6    1996\n271 age   fleet1     1 1997-01-01 1997-12-31    0       \"\"         50.9    1997\n272 age   fleet1     2 1997-01-01 1997-12-31    0.0208  \"\"         50.9    1997\n273 age   fleet1     3 1997-01-01 1997-12-31    0.0905  \"\"         50.9    1997\n274 age   fleet1     4 1997-01-01 1997-12-31    0.0513  \"\"         50.9    1997\n275 age   fleet1     5 1997-01-01 1997-12-31    0.0539  \"\"         50.9    1997\n276 age   fleet1     6 1997-01-01 1997-12-31    0.104   \"\"         50.9    1997\n277 age   fleet1     7 1997-01-01 1997-12-31    0.155   \"\"         50.9    1997\n278 age   fleet1     8 1997-01-01 1997-12-31    0.236   \"\"         50.9    1997\n279 age   fleet1     9 1997-01-01 1997-12-31    0.173   \"\"         50.9    1997\n280 age   fleet1    10 1997-01-01 1997-12-31    0.116   \"\"         50.9    1997\n281 age   fleet1     1 1998-01-01 1998-12-31    0.00421 \"\"         51.6    1998\n282 age   fleet1     2 1998-01-01 1998-12-31    0.00146 \"\"         51.6    1998\n283 age   fleet1     3 1998-01-01 1998-12-31    0.147   \"\"         51.6    1998\n284 age   fleet1     4 1998-01-01 1998-12-31    0.251   \"\"         51.6    1998\n285 age   fleet1     5 1998-01-01 1998-12-31    0.110   \"\"         51.6    1998\n286 age   fleet1     6 1998-01-01 1998-12-31    0.0650  \"\"         51.6    1998\n287 age   fleet1     7 1998-01-01 1998-12-31    0.0738  \"\"         51.6    1998\n288 age   fleet1     8 1998-01-01 1998-12-31    0.0860  \"\"         51.6    1998\n289 age   fleet1     9 1998-01-01 1998-12-31    0.125   \"\"         51.6    1998\n290 age   fleet1    10 1998-01-01 1998-12-31    0.137   \"\"         51.6    1998\n291 age   fleet1     1 1999-01-01 1999-12-31    0       \"\"         73.7    1999\n292 age   fleet1     2 1999-01-01 1999-12-31    0.00724 \"\"         73.7    1999\n293 age   fleet1     3 1999-01-01 1999-12-31    0.0253  \"\"         73.7    1999\n294 age   fleet1     4 1999-01-01 1999-12-31    0.222   \"\"         73.7    1999\n295 age   fleet1     5 1999-01-01 1999-12-31    0.333   \"\"         73.7    1999\n296 age   fleet1     6 1999-01-01 1999-12-31    0.0975  \"\"         73.7    1999\n297 age   fleet1     7 1999-01-01 1999-12-31    0.0728  \"\"         73.7    1999\n298 age   fleet1     8 1999-01-01 1999-12-31    0.0387  \"\"         73.7    1999\n299 age   fleet1     9 1999-01-01 1999-12-31    0.0600  \"\"         73.7    1999\n300 age   fleet1    10 1999-01-01 1999-12-31    0.143   \"\"         73.7    1999\n# ℹ 240 more rows\n\n\nCode\n# Run the  model with optimization\nfit &lt;- parameters_with_wrappers  |&gt;\n  initialize_fims(data = data_4_model) |&gt;\n  fit_fims(optimize = TRUE)\n\n\n✔ Starting optimization ...\nℹ Restarting optimizer 3 times to improve gradient.\nℹ Maximum gradient went from 0.00794 to 0.00021 after 3 steps.\n✔ Finished optimization\n✔ Finished sdreport\nℹ FIMS model version: 0.3.0.1\nℹ Total run time was 3.52127 seconds\nℹ Number of parameters: total=121, fixed_effects=121, and random_effects=0\nℹ Maximum gradient= 0.00021\nℹ Negative log likelihood (NLL):\n• Marginal NLL= 3248.81864\n• Total NLL= 3248.81864\nℹ Terminal SB=\n\n\nCode\n## report values for models\nrep1_with_wrappers &lt;- test_fit@report # FIMS initial values\nfit@max_gradient # from Cole, can use TMBhelper::fit_tmb to get val to &lt;1e-10\n\n\n[1] 0.0002109227\n\n\nCode\nrep2_with_wrappers &lt;- fit@report\n\n# TODO: Review differences between rep2 and rep2_with_wrappers. \n# Flag this for Cole to verify.\n# cbind(rep2$ssb[[1]], rep2_with_wrappers$ssb[[1]])\n# cbind(rep2$nll_components, rep2_with_wrappers$nll_components)",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#comparison-table",
    "href": "content/AFSC-GOA-pollock.html#comparison-table",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "Comparison table",
    "text": "Comparison table\nThe likelihood components from the TMB model do not include constants and thus are not directly comparable. To be fixed later. Relative differences between the modified TMB model and FIMS implementation are given in the figure above.",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "href": "content/AFSC-GOA-pollock.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "What was your experience using FIMS? What could we do to improve usability?",
    "text": "What was your experience using FIMS? What could we do to improve usability?\nTo do",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#list-any-issues-that-you-ran-into-or-found",
    "href": "content/AFSC-GOA-pollock.html#list-any-issues-that-you-ran-into-or-found",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "List any issues that you ran into or found",
    "text": "List any issues that you ran into or found\n\nOutput more derived quantities like selectivity, maturity, etc.\nNLL components are not separated by fleet and need to be. So age comp NLL for fleets 1 and 2 need to be separate to make, e.g., the likelihood profile plot above.\nNeed more ADREPORTed values like SSB",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/AFSC-GOA-pollock.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "href": "content/AFSC-GOA-pollock.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "title": "AFSC Case Study Gulf of Alaska Walleye Pollock",
    "section": "What features are most important to add based on this case study?",
    "text": "What features are most important to add based on this case study?\n\nMore sophisticated control over selectivity so that ages 1 and 2 can be zeroed out for a double-logistic form, overriding the selectivity curve.\n\n\n\nCode\n# Clear C++ objects from memory\nFIMS::clear()",
    "crumbs": [
      "AFSC GOA pollock case study"
    ]
  },
  {
    "objectID": "content/publishing.html",
    "href": "content/publishing.html",
    "title": "Publishing",
    "section": "",
    "text": "To get your Quarto webpage to show up with the url\nyou have a few steps."
  },
  {
    "objectID": "content/publishing.html#turn-on-github-pages-for-your-repo",
    "href": "content/publishing.html#turn-on-github-pages-for-your-repo",
    "title": "Publishing",
    "section": "Turn on GitHub Pages for your repo",
    "text": "Turn on GitHub Pages for your repo\n\nTurn on GitHub Pages under Settings &gt; Pages . You will set pages to be made from the gh-pages branch and the root directory.\nTurn on GitHub Actions under Settings &gt; Actions &gt; General\n\nThe GitHub Action will automatically recreate your website when you push to GitHub after you do the initial gh-pages set-up"
  },
  {
    "objectID": "content/publishing.html#do-your-first-publish-to-gh-pages",
    "href": "content/publishing.html#do-your-first-publish-to-gh-pages",
    "title": "Publishing",
    "section": "Do your first publish to gh-pages",
    "text": "Do your first publish to gh-pages\nThe first time you publish to gh-pages, you need to do so locally.\n\nOn your local computer, open a terminal window and cd to your repo directory. Here is what that cd command looks like for me. You command will look different because your local repo will be somewhere else on your computer.\n\ncd ~/Documents/GitHub/NOAA-quarto-simple\n\nPublish to the gh-pages. In the terminal type\n\nquarto publish gh-pages\nThis is going to render your webpage and then push the _site contents to the gh-pages branch."
  },
  {
    "objectID": "content/publishing.html#dont-like-using-gh-pages",
    "href": "content/publishing.html#dont-like-using-gh-pages",
    "title": "Publishing",
    "section": "Don’t like using gh-pages?",
    "text": "Don’t like using gh-pages?\nIn some cases, you don’t want your website on the gh-pages branch. For example, if you are creating releases and you want the website pages archived in that release, then you won’t want your website pages on the gh-pages branch.\nHere are the changes you need to make if you to avoid gh-pages branch.\n\nAt the top of _quarto.yml add the following:\n\nproject: \n  type: website\n  output-dir: docs\n\nOn GitHub under Settings &gt; Pages set pages to be made from the main branch and the docs directory.\nMake sure docs is not listed in .gitignore\nPublish the site the first time locally using quarto publish from the terminal\nChange the GitHub Action because you can’t use quarto publish gh-pages. You’ll need to push to the main branch yourself (in the GitHub Action)\n\non:\n  push:\n    branches: main\n\nname: Render and Publish\n\njobs:\n  build-deploy:\n    runs-on: ubuntu-latest\n    env:\n      GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}\n\n    steps:\n      - name: Check out repository\n        uses: actions/checkout@v2 \n        \n      - name: Set up R (needed for Rmd)\n        uses: r-lib/actions/setup-r@v2\n\n      - name: Install packages (needed for Rmd)\n        run: Rscript -e 'install.packages(c(\"rmarkdown\", \"knitr\", \"jsonlite\"))'\n\n      - name: Set up Quarto\n        uses: quarto-dev/quarto-actions/setup@v2\n        with:\n          # To install LaTeX to build PDF book \n          # tinytex: true \n          # uncomment below and fill to pin a version\n          # version: 0.9.600\n      \n      - name: Render Quarto Project\n        uses: quarto-dev/quarto-actions/render@v2\n        with:\n          to: html\n\n      - name: Set up Git\n        run: |\n          git config --local user.email \"actions@github.com\"\n          git config --local user.name \"GitHub Actions\"\n\n      - name: Commit all changes and push\n        run: |\n          git add -A && git commit -m 'Build site' || echo \"No changes to commit\"\n          git push origin || echo \"No changes to commit\""
  },
  {
    "objectID": "content/pacific-hake.html",
    "href": "content/pacific-hake.html",
    "title": "Pacific Hake",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Pacific Hake\n\nRegion: Joint Technical Committee\n\nAnalyst: Kelli F. Johnson",
    "crumbs": [
      "Pacific Hake case study"
    ]
  },
  {
    "objectID": "content/pacific-hake.html#the-setup",
    "href": "content/pacific-hake.html#the-setup",
    "title": "Pacific Hake",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Pacific Hake\n\nRegion: Joint Technical Committee\n\nAnalyst: Kelli F. Johnson",
    "crumbs": [
      "Pacific Hake case study"
    ]
  },
  {
    "objectID": "content/pacific-hake.html#simplifications-to-the-original-assessment",
    "href": "content/pacific-hake.html#simplifications-to-the-original-assessment",
    "title": "Pacific Hake",
    "section": "Simplifications to the original assessment",
    "text": "Simplifications to the original assessment\n\nWeight-at-age data\nWeight-at-age data was taken from the .ss_new file because this file contains data for all years in the model rather than just since 1975 based on the rules supplied in the input file to the Stock Synthesis model. No simplifications were made for this assessment regarding weight-at-age data because all matrices in the Stock Synthesis model are replicates of each other, e.g., weight at age for fleet two is the same as beginning and middle of the year weight at age in this model.\n\n\nMaturity\nYear-specific maturity ogives for Pacific Hake were translated to a single logistic curve. First, estimates of maturity at age for the maximum day of the year investigated were averaged across years. Subsequently, this ogive was plotted and several values for the inflection point and slope parameters of the logistic curve were used to find a logistic curve that matched the average curve as best as possible. This lead to a curve with an inflection of 2.2 and a slope of 1.8.\n\n\nCode\nmaturity_data |&gt;\n  dplyr::filter(doy == max(doy)) |&gt;\n  dplyr::group_by(age) |&gt;\n  dplyr::summarize(empirical = mean(p_mature)) |&gt;\n  dplyr::full_join(\n    execute_logistic(\n      # TODO: un-hard code these age values\n      ages,\n      hake_maturity_slope,\n      hake_maturity_inflection_point\n    ) |&gt;\n      dplyr::rename(age = x, logit = value),\n    by = \"age\"\n  ) |&gt;\n  tidyr::pivot_longer(cols = c(\"empirical\", \"logit\")) |&gt;\n  ggplot2::ggplot(ggplot2::aes(age, value, color = name)) +\n  ggplot2::geom_line(linewidth = 1.5) +\n  ggplot2::xlab(\"Age\") +\n  ggplot2::ylab(\"Probability of being mature\") +\n  ggplot2::scale_color_brewer(palette = \"Dark2\", name = \"Method\")\n\n\n\n\n\n\n\n\n\n\n\nSelectivity\nThe logistic and double logistic selectivity curves are currently the only selectivity forms that are available in FIMS. A researcher from the Southwest Fisheries Science Center is working on adding age-specific selectivity, which will be available later this calendar year.\n\n\nAge-1 index\nThe relative age-1 index was removed from the data because FIMS currently works on biomass and does not allow for inputs in numbers. This relative index could be included after an agreed upon method to translate numbers of age-1 fish to biomass is established. This could be as simple as multiplying annual numbers of fish by weight of age-1 fish from the weight-at-age estimates from the GLMM.",
    "crumbs": [
      "Pacific Hake case study"
    ]
  },
  {
    "objectID": "content/pacific-hake.html#data",
    "href": "content/pacific-hake.html#data",
    "title": "Pacific Hake",
    "section": "Data",
    "text": "Data\nAll data for a FIMS model is contained in one data frame. Here, we call this object fims_data. The creation of this data set is assisted by the R function called get_ss3_data() written by Drs. Ian G. Taylor and Megumi C. Oshima.\nBecause data-weighting is not available in FIMS, the input sample size for the survey age-composition data was multiplied by 10. Additionally, because non-parametric selectivity is not yet available in FIMS, the terminal year of data was removed from this data set.\n\n\nCode\ninputs &lt;- r4ss::SS_read(base_dir)\ninputs[[\"wtatage\"]] &lt;- r4ss::SS_readwtatage(file.path(base_dir, \"wtatage.ss_new\"))\n\nfims_data &lt;- get_ss3_data(\n  ss3_inputs = inputs,\n  fleets = seq(inputs[[\"dat\"]][[\"Nfleets\"]]),\n  ages = inputs[[\"dat\"]][[\"agebin_vector\"]]\n) |&gt;\n  dplyr::filter(\n    datestart &lt;= as.Date(paste0(inputs[[\"dat\"]][[\"endyr\"]], \"-01-01\")),\n    value != -999,\n    # TODO: allow fleet3 after I figure out how to go from numbers to mt\n    name != \"fleet3\"\n  ) |&gt;\n  dplyr::mutate(\n    uncertainty = ifelse(\n      test = type == \"age\" & name == \"fleet2\",\n      uncertainty * 10,\n      uncertainty\n    )\n  ) |&gt;\n  dplyr::filter(\n    datestart != \"2024-01-01\"\n  ) |&gt;\n  FIMS::FIMSFrame()\nn_ages_years &lt;- get_n_ages(fims_data) * get_n_years(fims_data)\n\n\n\n\nCode\n# Printing the S4 class that is returned from FIMSFrame()\nfims_data\n\n\ntbl_df of class 'FIMSFrame'\n\n\nwith the following 'types': age, landings, weight-at-age, index\n\n\n# A tibble: 6 × 10\n  type  name     age length datestart  dateend    value unit  uncertainty  year\n  &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;\n1 age   fleet1     1     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\n2 age   fleet1     2     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\n3 age   fleet1     3     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\n4 age   fleet1     4     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\n5 age   fleet1     5     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\n6 age   fleet1     6     NA 1966-01-01 1966-12-31  -999 \"\"             NA  1966\nadditional slots include the following:fleets:\n[1] 1 2\nn_years:\n[1] 58\nages:\n [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15\nn_ages:\n[1] 15\nlengths:\nnumeric(0)\nn_lengths:\n[1] 0\nstart_year:\n[1] 1966\nend_year:\n[1] 2023\n\n\nCode\n# Summary of the data types available\nFIMS::get_data(fims_data) |&gt;\n  dplyr::filter(value != -999) |&gt;\n  dplyr::group_by(type, name) |&gt;\n  dplyr::count()\n\n\n# A tibble: 5 × 3\n# Groups:   type, name [5]\n  type          name       n\n  &lt;chr&gt;         &lt;chr&gt;  &lt;int&gt;\n1 age           fleet1   735\n2 age           fleet2   225\n3 index         fleet2    15\n4 landings      fleet1    58\n5 weight-at-age fleet1   870",
    "crumbs": [
      "Pacific Hake case study"
    ]
  },
  {
    "objectID": "content/pacific-hake.html#model",
    "href": "content/pacific-hake.html#model",
    "title": "Pacific Hake",
    "section": "Model",
    "text": "Model\n\nParameterization\nCurrently, only the multinomial distribution is available for fitting composition data in FIMS. Although, a double-logistic curve was explored for the fishery, results below are for the logistic. Survey selectivity was fixed with an inflection point at 2 years and a slope of 1.\nNatural mortality can be estimated in FIMS using age- and year-specific values but all values were fixed at the median estimate from Stock Synthesis for this analysis.\n\n\nCode\nfleet1 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  # selectivity = list(form = \"DoubleLogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\nfleet2 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\nfleet3 &lt;- list(\n  selectivity = list(form = \"DoubleLogisticSelectivity\"),\n  data_distribution = c(Index = \"DlnormDistribution\")\n)\n\n# Create default parameters\ndefault_parameters &lt;- fims_data |&gt;\n  create_default_parameters(\n    fleets = list(\n      fleet1 = fleet1,\n      fleet2 = fleet2\n      # TODO: include age-1 index data\n      # fleet3 = fleet3\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      maturity = list(\n        LogisticMaturity.inflection_point.value =\n          hake_maturity_inflection_point,\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = hake_maturity_slope,\n        LogisticMaturity.slope.estimated = FALSE\n      ),\n      population = list(\n        # TODO: estimate M\n        Population.log_M.value = rep(log(0.235), length = n_ages_years)\n      ),\n      recruitment = list(\n        DnormDistribution.log_sd.value = 1.4\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet2 = list(\n        # TODO: Estimate survey selectivity\n        LogisticSelectivity.inflection_point.value = 2,\n        LogisticSelectivity.inflection_point.estimated = FALSE,\n        LogisticSelectivity.slope.value = 1,\n        LogisticSelectivity.slope.estimated = FALSE\n      )\n    )\n  )\n\n\n\nTime-varying parameters\nParameters can vary with time, though the R interface is not currently fully developed to easily allow this. Hence, the code below.\n\n\nCode\n# Code to create time-varying parameters\n\ndefault_parameters[[\"parameters\"]][[\"fleet1\"]][[\"LogisticSelectivity.inflection_point.value\"]] &lt;-\n  rep(2.49, get_n_years(fims_data))\ndefault_parameters[[\"parameters\"]][[\"fleet1\"]][[\"LogisticSelectivity.inflection_point.estimated\"]] &lt;-\n  rep(TRUE, get_n_years(fims_data))\n\n# Code for time-varying Double Logistic\n\n# default_parameters[[\"parameters\"]][[\"fleet1\"]][[\"DoubleLogisticSelectivity.inflection_point_asc.value\"]] &lt;-\n#   rep(2.49, get_n_years(fims_data))\n# default_parameters[[\"parameters\"]][[\"fleet1\"]][[\"DoubleLogisticSelectivity.inflection_point_asc.estimated\"]] &lt;-\n#   rep(TRUE, get_n_years(fims_data))\n# default_parameters[[\"parameters\"]][[\"fleet1\"]][[\"DoubleLogisticSelectivity.inflection_point_desc.value\"]] &lt;-\n#   rep(10, get_n_years(fims_data))\n# default_parameters[[\"parameters\"]][[\"fleet1\"]][[\"DoubleLogisticSelectivity.inflection_point_desc.estimated\"]] &lt;-\n#   rep(TRUE, get_n_years(fims_data))\n\n\n\n\n\nFit\n\n\nCode\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- default_parameters |&gt;\n  initialize_fims(data = fims_data) |&gt;\n  fit_fims(optimize = FALSE)\nfit &lt;- default_parameters |&gt;\n  initialize_fims(data = fims_data) |&gt;\n  fit_fims(optimize = TRUE)\n\n\n✔ Starting optimization ...\nℹ Restarting optimizer 3 times to improve gradient.\nℹ Maximum gradient went from 0.30984 to 0.06327 after 3 steps.\n✔ Finished optimization\n✔ Finished sdreport\nℹ FIMS model version: 0.3.0.1\nℹ Total run time was 4.2623 seconds\nℹ Number of parameters: total=134, fixed_effects=134, and random_effects=0\nℹ Maximum gradient= 0.06327\nℹ Negative log likelihood (NLL):\n• Marginal NLL= 425250.50284\n• Total NLL= 425250.50284\nℹ Terminal SB=\n\n\n\n\nResults\n\n\nCode\nget_data(fims_data) |&gt;\n  dplyr::filter(type == \"landings\") |&gt;\n  dplyr::mutate(\n    year = dplyr::row_number() + get_start_year(fims_data) - 1,\n    expected = get_report(fit)$exp_catch[[1]]\n  ) |&gt;\n  ggplot2::ggplot(\n    ggplot2::aes(year, value)\n  ) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line(\n    ggplot2::aes(y = expected)\n  ) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Landings (t)\")\n\n\n\n\n\n\n\n\n\n\n\nCode\nget_estimates(fit) |&gt;\n  dplyr::filter(grepl(\"SB\", name, ignore.case = TRUE)) |&gt;\n  dplyr::mutate(\n    year = (get_start_year(fims_data)- 1):get_end_year(fims_data)\n  ) |&gt;\n  ggplot2::ggplot(\n    ggplot2::aes(x = year, y = value)\n  ) +\n  ggplot2::geom_line() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Spawning biomass (t)\")\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Index\nget_estimates(fit) |&gt;\n  dplyr::filter(grepl(\"Index\", name)) |&gt;\n  dplyr::mutate(\n    year = rep(1:(dplyr::n() / 2), 2) + get_start_year(fims_data) - 1,\n    fleet = rep(c(\"Fishery estimated\", \"Estimated\"), each = dplyr::n() / 2)\n  ) |&gt;\n  dplyr::filter(\n    fleet == \"Estimated\"\n  ) |&gt;\n  ggplot2::ggplot(\n    ggplot2::aes(year, value, group = fleet, color = as.factor(fleet))\n  ) +\n  ggplot2::geom_line() +\n  ggplot2::geom_point(\n    data = inputs[[\"dat\"]][[\"CPUE\"]] |&gt;\n      dplyr::filter(index == 2) |&gt;\n      dplyr::mutate(year = year, fleet = \"Data\"),\n    ggplot2::aes(y = obs, x = year)\n  ) +\n  ggplot2::scale_color_brewer(palette = \"Dark2\", name = \"Method\") +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Index of abundance (t)\")\n\n\n\n\n\n\n\n\n\n\n\nCode\n# Fishing mortality\nget_estimates(fit) |&gt;\n  dplyr::filter(grepl(\"Fmort\", name)) |&gt;\n  dplyr::mutate(\n    year = rep(1:dplyr::n(), 1) + get_start_year(fims_data),\n    fleet = rep(1, each = dplyr::n()),\n    F = exp(value)\n  ) |&gt;\n  ggplot2::ggplot(\n    ggplot2::aes(year, F, group = fleet)\n  ) +\n  ggplot2::geom_line() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Fishing mortality\")",
    "crumbs": [
      "Pacific Hake case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html",
    "href": "content/NWFSC-petrale.html",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: West Coast Petrale Sole\n\nRegion: NWFSC\n\nAnalyst: Ian G. Taylor",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html#the-setup",
    "href": "content/NWFSC-petrale.html#the-setup",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: West Coast Petrale Sole\n\nRegion: NWFSC\n\nAnalyst: Ian G. Taylor",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html#simplifications-to-the-original-assessment",
    "href": "content/NWFSC-petrale.html#simplifications-to-the-original-assessment",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "Simplifications to the original assessment",
    "text": "Simplifications to the original assessment\nThe operational petrale sole stock assessment used Stock Synthesis (SS3) and included numerous data types and population dynamic assumptions that are not yet available in FIMS. A simplified SS3 model was also developed to provide a closer comparison but is still a work in progress. This is intended as a demonstration and nothing more.\nFor both the FIMS model and the simplified SS3 model, I made the following changes:\n\nRemove data\n\nRemove lengths\nRemove male ages\nRemove discard fractions and discard comps\n\nSimplify selectivity\n\nRemove length-based retention functions\nConvert to age-based logistic (from length-based double-normal, fixed asymptotic)\n\nRemove parameter priors (on M and h)\nUse female mean weight at age as calculated from the parametric growth curves\nVarying Index CV to constant over time\nVarying Catch ESS to constant over time",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html#script-to-prepare-data-for-building-fims-object",
    "href": "content/NWFSC-petrale.html#script-to-prepare-data-for-building-fims-object",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "Script to prepare data for building FIMS object",
    "text": "Script to prepare data for building FIMS object\n\n\nCode\n# read SS3 input files from petrale sole assessment on github\npetrale_input &lt;- r4ss::SS_read(\n  \"https://raw.githubusercontent.com/pfmc-assessments/petrale/main/models/2023.a034.001/\"\n)\npetrale_output &lt;- r4ss::SS_output(\n  \"https://raw.githubusercontent.com/pfmc-assessments/petrale/main/models/2023.a034.001\",\n  printstats = FALSE,\n  verbose = FALSE\n)\n  \n# generic names for SS3 data and control files could be useful in future generalized version of this code\nss3dat &lt;- petrale_input$dat\nss3ctl &lt;- petrale_input$ctl\n\n# define the dimensions based on the range in the data\n# for petrale, the north fleet catch begins in 1896, \n# not the start year of the model 1876 (which is when the southern fleet catch begins,\n# but for simplicity this petrale example only uses the northern catch)\n# years &lt;- seq(ss3dat$styr, ss3dat$endyr)\nyears &lt;- seq(1896, ss3dat$endyr)\nnyears &lt;- length(years)\nnseasons &lt;- 1\n# ages &lt;- 0:ss3dat$Nages # population ages in SS3, starts at age 0\nages &lt;- 1:17 # same as data bins\nnages &lt;- length(ages)\nlengths &lt;- petrale_output[[\"lbins\"]]\nnlengths &lt;- length(lengths)\n\n# source function to simplify data and convert from SS3 format\nsource(\"R/get_ss3_data.R\")\n\n# fleet 4 used conditional age-at-length data with marginal observations\n# entered as fleet == -4 (to exclude from likelihood due to redundancy)\n# using only marginals for FIMS and exclude CAAL data by filtering out\n# the fleet 4 age data\n# similarly, some early ages were excluded from fleet 1 in the original model\n# by assigning to fleet -1, these get filtered by get_ss3_data()\n\n# only include age comps with fleet = -4 or 1:\nss3dat$agecomp &lt;- ss3dat$agecomp |&gt;\n  dplyr::filter(fleet %in% c(-4, 1))\nss3dat$agecomp$fleet &lt;- abs(ss3dat$agecomp$fleet)\n\n# convert SS3 data into FIMS format using function defined in the R directory\nmydat &lt;- get_ss3_data(\n  ss3dat,\n  fleets = c(1, 4),\n  ages = ages,\n  lengths = petrale_input[[\"dat\"]][[\"lbin_vector\"]]\n) |&gt;\n  # rename fleet4 as fleet2 (fleets 2 and 3 already removed above)\n  dplyr::mutate(name = dplyr::case_when(\n    name == \"fleet1\" ~ name,\n    name == \"fleet4\" ~ \"survey1\" # change fleet4 to survey1 to match yellowtail case-study\n  )) |&gt;\n  dplyr::filter(value != -999)\n\n# Weight-at-age code copied directly from PIFSC-opakapaka.qmd\n# Get weight-at-age from SS3 report output and convert from kg to mt\nweight_at_age_data &lt;- petrale_output[[\"wtatage\"]] |&gt; \n  dplyr::filter(sex == 1 & fleet == 1 & year == 1949) |&gt; \n  dplyr::select(dplyr::matches(\"[0-9]+\")) |&gt;\n  # round(4) |&gt;\n  tidyr::pivot_longer(names_to = \"age\", cols = dplyr::everything()) |&gt;\n  dplyr::filter(age %in% ages) |&gt;\n  tidyr::expand_grid(\n    mydat |&gt; dplyr::select(datestart) |&gt; dplyr::distinct()\n  ) |&gt;\n  dplyr::left_join(\n    mydat |&gt; dplyr::select(datestart, dateend) |&gt; dplyr::distinct(),\n    by = \"datestart\"\n  ) |&gt;\n  dplyr::mutate(\n    type = \"weight-at-age\",\n    name = \"fleet1\",\n    unit = \"mt\",\n    age = as.integer(age),\n    value = value/1000\n  )\nmydat &lt;- mydat |&gt; \n  dplyr::bind_rows(weight_at_age_data)\n\n# set up FIMS data objects\nfims_frame &lt;- FIMS::FIMSFrame(mydat)\n\n\n\nPrepare Parameters using create_default_parameters()\n\n\nCode\n## lots of code below copied PIFSC-opakapaka.qmd\n# rename SS3 output to avoid modifying lines copied from opakapaka model\nrep &lt;- petrale_output\n\n# Define fleet specifications for fleet1 and survey1\nfleet1 &lt;- survey1 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\n\n# Create default parameters\ndefault_parameters &lt;- fims_frame |&gt;\n  create_default_parameters(\n    fleets = list(fleet1 = fleet1, survey1 = survey1)\n  )\n\n\n\n\nModifying parameters\n\n\nCode\nrecdevs &lt;- rep$recruitpars |&gt; # $recruitpars is a subset of $parameters with Yr as an additional column\n  dplyr::filter(Yr %in% years[-1]) |&gt; # filter out initial numbers parameters\n  dplyr::select(Yr, Value)\n\ninit_naa &lt;- rep$natage |&gt;\n  dplyr::filter(Time == min(years), Sex == 1) |&gt;  # numbers at age in FIMS start year, not SS3 model\n  dplyr::select(paste(ages)) |&gt; \n  as.numeric() # TODO: figure out if *1000 is needed\ninit_naa &lt;- exp(rep$parameters |&gt; dplyr::filter(grepl(\"R0\", Label)) |&gt; dplyr::pull(Init)) * 1000 * exp(-(ages - 1) * rep$parameters |&gt; dplyr::filter(grepl(\"NatM.*Fem\", Label)) |&gt; dplyr::pull(Value))\ninit_naa[nages] &lt;- init_naa[nages] / rep$parameters |&gt; dplyr::filter(grepl(\"NatM.*Fem\", Label)) |&gt; dplyr::pull(Value) # sum of infinite series\n\n# TODO: Move this to the R folder or FIMS\nsteepness_transform &lt;- function(h) {\n  # function to convert steepness into required parameter space\n  -log(1.0 - h) + log(h - 0.2)\n}\n\nparameters &lt;- default_parameters |&gt;\n  # SS3 model had length-based selectivity which leads to sex-specific\n  # age-based selectivity due to sexually-dimorphic growth.\n  # I didn't bother to calculate an age-based inflection point averaged over sexes\n  update_parameters(\n    modified_parameters = list(\n      fleet1 = list(\n        Fleet.log_Fmort.estimated = FALSE,\n        Fleet.log_Fmort.value = rep$exploitation |&gt; \n          dplyr::filter(Yr %in% years) |&gt; \n          dplyr::pull(North) |&gt;\n          log(), # \"North\" is the SS3 fleet name\n        LogisticSelectivity.inflection_point.value = 10, \n        LogisticSelectivity.inflection_point.estimated = TRUE,\n        LogisticSelectivity.slope.value = 2, #used age selex values\n        LogisticSelectivity.slope.estimated = TRUE\n      ),\n      survey1 = list(\n        LogisticSelectivity.inflection_point.value = 6, \n        LogisticSelectivity.inflection_point.estimated = TRUE,\n        LogisticSelectivity.slope.value = 2, \n        LogisticSelectivity.slope.estimated = TRUE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      recruitment = list(\n        BevertonHoltRecruitment.log_rzero.value = ss3ctl$SR_parms[\"SR_LN(R0)\", \"INIT\"],\n        BevertonHoltRecruitment.log_devs.value = recdevs$Value,\n        BevertonHoltRecruitment.logit_steep.value = ss3ctl$SR_parms[\"SR_BH_steep\", \"INIT\"] |&gt;\n          steepness_transform(),\n        DnormDistribution.log_sd.value = 0.5\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      # approximate age-based equivalent to length-based maturity in petrale model\n      # based on looking at model$endgrowth |&gt; dplyr::filter(Sex == 1) |&gt; dplyr::select(Age_Beg, Len_Mat)\n      maturity = list(\n        LogisticMaturity.inflection_point.value = 20.5, \n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 1.8, # arbitrary guess\n        LogisticMaturity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      population = list(\n        Population.log_init_naa.value = log(init_naa),\n        Population.log_init_naa.estimated = TRUE,\n        Population.log_M.value = rep(\n          log(rep$parameters[\"NatM_uniform_Fem_GP_1\", \"Value\"]),\n          get_n_years(fims_frame) * get_n_ages(fims_frame)\n        ),\n        Population.log_M.estimated = FALSE\n      )\n    )\n  )",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html#initialize-modules-and-fit-the-model",
    "href": "content/NWFSC-petrale.html#initialize-modules-and-fit-the-model",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "Initialize modules and fit the model",
    "text": "Initialize modules and fit the model\nWith data and parameters in place, we can now initialize modules using initialize_fims() and fit the model using fit_fims().\n\n\nCode\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- parameters |&gt;\n  initialize_fims(data = fims_frame) |&gt;\n  fit_fims(optimize = FALSE)\n\n# Run the  model with optimization\nfit &lt;- parameters |&gt;\n  initialize_fims(data = fims_frame) |&gt;\n  fit_fims(optimize = TRUE)\n\n\n✔ Starting optimization ...\nℹ Restarting optimizer 3 times to improve gradient.\nℹ Maximum gradient went from 0.09997 to 0.00394 after 3 steps.\n✔ Finished optimization\n\n\nWarning in sqrt(diag(cov)): NaNs produced\n\n\n✔ Finished sdreport\n\n\nWarning in sqrt(diag(object$cov.fixed)): NaNs produced\n\n\nℹ FIMS model version: 0.3.0.1\nℹ Total run time was 19.08937 seconds\nℹ Number of parameters: total=149, fixed_effects=149, and random_effects=0\nℹ Maximum gradient= 0.00394\nℹ Negative log likelihood (NLL):\n• Marginal NLL= 6582.60366\n• Total NLL= 6582.60366\nℹ Terminal SB=\n\n\nCode\n  # TODO: why does the final message show no SB value: \"i Terminal SB=\"\nstr(fit)\n\n\nFormal class 'FIMSFit' [package \"FIMS\"] with 10 slots\n  ..@ input               :List of 1\n  .. ..$ parameters:List of 1\n  .. .. ..$ p: num [1:149] 10 2 6 2 0 ...\n  ..@ obj                 :List of 10\n  .. ..$ par     : Named num [1:149] 10 2 6 2 0 ...\n  .. .. ..- attr(*, \"names\")= chr [1:149] \"selectivity.inflection_point.1.0\" \"selectivity.slope.1.0\" \"selectivity.inflection_point.2.0\" \"selectivity.slope.2.0\" ...\n  .. ..$ fn      :function (x = last.par[lfixed()], ...)  \n  .. ..$ gr      :function (x = last.par[lfixed()], ...)  \n  .. ..$ he      :function (x = last.par[lfixed()], atomic = usingAtomics())  \n  .. ..$ hessian : logi FALSE\n  .. ..$ method  : chr \"BFGS\"\n  .. ..$ retape  :function (set.defaults = TRUE)  \n  .. ..$ env     :&lt;environment: 0x10b0ceac0&gt; \n  .. ..$ report  :function (par = last.par)  \n  .. ..$ simulate:function (par = last.par, complete = FALSE)  \n  ..@ opt                 :List of 6\n  .. ..$ par        : Named num [1:149] 12.083 0.725 3.203 2.045 0.367 ...\n  .. .. ..- attr(*, \"names\")= chr [1:149] \"p\" \"p\" \"p\" \"p\" ...\n  .. ..$ objective  : num 6583\n  .. ..$ convergence: int 1\n  .. ..$ iterations : int 1\n  .. ..$ evaluations: Named int [1:2] 15 1\n  .. .. ..- attr(*, \"names\")= chr [1:2] \"function\" \"gradient\"\n  .. ..$ message    : chr \"false convergence (8)\"\n  ..@ max_gradient        : num 0.00394\n  ..@ report              :List of 17\n  .. ..$ ssb            :List of 1\n  .. .. ..$ : num [1:128] 9.13 8.57 8.01 7.9 8.16 ...\n  .. ..$ cnal           :List of 2\n  .. .. ..$ : num(0) \n  .. .. ..$ : num(0) \n  .. ..$ log_recruit_dev:List of 1\n  .. .. ..$ : num [1:126] 0.00726 0.02663 0.05511 0.08395 0.10094 ...\n  .. ..$ cwaa           :List of 2\n  .. .. ..$ : num [1:2159] 9.71e-07 9.63e-12 3.39e-05 4.71e-05 1.38e-04 ...\n  .. .. ..$ : num [1:2159] 2.16 7.48e-05 6.45e+02 9.15e+02 1.52e+03 ...\n  .. ..$ exp_index      :List of 2\n  .. .. ..$ : num [1:127] 0.242 0.198 0.154 0.15 0.146 ...\n  .. .. ..$ : num [1:127] 48372 48389 47874 47872 47840 ...\n  .. ..$ pcnaa          :List of 2\n  .. .. ..$ : num [1:2159] 3.28e-04 7.33e-10 1.11e-03 8.87e-04 1.76e-03 ...\n  .. .. ..$ : num [1:2159] 3.35e-03 2.61e-08 9.72e-02 7.90e-02 8.88e-02 ...\n  .. ..$ nll_components : num [1:5] 664 930 1134 419 3435\n  .. ..$ biomass        :List of 1\n  .. .. ..$ : num [1:128] 34928 34794 34689 34595 34489 ...\n  .. ..$ F_mort         :List of 2\n  .. .. ..$ : num [1:127] 1.62e-05 1.33e-05 1.04e-05 1.02e-05 9.93e-06 ...\n  .. .. ..$ : num [1:127] 1 1 1 1 1 1 1 1 1 1 ...\n  .. ..$ M              :List of 1\n  .. .. ..$ : num [1:2159] 0.142 0.142 0.142 0.142 0.142 ...\n  .. ..$ pcnal          :List of 2\n  .. .. ..$ : num(0) \n  .. .. ..$ : num(0) \n  .. ..$ recruitment    :List of 1\n  .. .. ..$ : num [1:128] 9791303 5439117 5528224 5667505 5828827 ...\n  .. ..$ cnaa           :List of 2\n  .. .. ..$ : num [1:2159] 4.81e-02 1.08e-07 1.63e-01 1.30e-01 2.58e-01 ...\n  .. .. ..$ : num [1:2159] 1.07e+05 8.36e-01 3.11e+06 2.53e+06 2.84e+06 ...\n  .. ..$ exp_catch      :List of 2\n  .. .. ..$ : num [1:127] 0.242 0.198 0.154 0.15 0.146 ...\n  .. .. ..$ : num [1:127] 0 0 0 0 0 0 0 0 0 0 ...\n  .. ..$ q              :List of 2\n  .. .. ..$ : num 1\n  .. .. ..$ : num 1.44\n  .. ..$ naa            :List of 1\n  .. .. ..$ : num [1:2176] 9.79e+06 1.06e+01 7.81e+06 3.02e+06 2.91e+06 ...\n  .. ..$ jnll           : num 6583\n  ..@ sdreport            :List of 8\n  .. ..$ value         : Named num [1:11704] 9.79e+06 1.06e+01 7.81e+06 3.02e+06 2.91e+06 ...\n  .. .. ..- attr(*, \"names\")= chr [1:11704] \"NAA\" \"NAA\" \"NAA\" \"NAA\" ...\n  .. ..$ sd            : num [1:11704] 8611459 NaN 24442808 31519765 30438897 ...\n  .. ..$ cov           : num [1:11704, 1:11704] 7.42e+13 3.34e+09 -1.64e+14 1.39e+14 -1.14e+13 ...\n  .. ..$ par.fixed     : Named num [1:149] 12.083 0.725 3.203 2.045 0.367 ...\n  .. .. ..- attr(*, \"names\")= chr [1:149] \"selectivity.inflection_point.1.0\" \"selectivity.slope.1.0\" \"selectivity.inflection_point.2.0\" \"selectivity.slope.2.0\" ...\n  .. ..$ cov.fixed     : num [1:149, 1:149] 0.004841 -0.000302 -0.000385 0.000379 -0.000781 ...\n  .. .. ..- attr(*, \"dimnames\")=List of 2\n  .. .. .. ..$ : chr [1:149] \"selectivity.inflection_point.1.0\" \"selectivity.slope.1.0\" \"selectivity.inflection_point.2.0\" \"selectivity.slope.2.0\" ...\n  .. .. .. ..$ : chr [1:149] \"selectivity.inflection_point.1.0\" \"selectivity.slope.1.0\" \"selectivity.inflection_point.2.0\" \"selectivity.slope.2.0\" ...\n  .. ..$ pdHess        : logi FALSE\n  .. ..$ gradient.fixed: num [1, 1:149] -5.40e-04 -3.94e-03 -7.85e-05 -3.67e-05 -6.34e-05 ...\n  .. ..$ env           :&lt;environment: 0x119915d40&gt; \n  .. ..- attr(*, \"class\")= chr \"sdreport\"\n  ..@ estimates           : tibble [11,853 × 3] (S3: tbl_df/tbl/data.frame)\n  .. ..$ name : chr [1:11853] \"selectivity.inflection_point.1.0\" \"selectivity.slope.1.0\" \"selectivity.inflection_point.2.0\" \"selectivity.slope.2.0\" ...\n  .. ..$ value: num [1:11853] 12.083 0.725 3.203 2.045 0.367 ...\n  .. ..$ se   : num [1:11853] 0.06958 0.00893 0.03576 0.07187 0.02158 ...\n  ..@ number_of_parameters: Named int [1:3] 149 149 0\n  .. ..- attr(*, \"names\")= chr [1:3] \"total\" \"fixed_effects\" \"random_effects\"\n  ..@ timing              : 'difftime' Named num [1:3] 1.55739402770996 17.527312040329 19.0893709659576\n  .. ..- attr(*, \"names\")= chr [1:3] \"time_optimization\" \"time_sdreport\" \"time_total\"\n  .. ..- attr(*, \"units\")= Named chr \"secs\"\n  .. .. ..- attr(*, \"names\")= chr \"time_optimization\"\n  ..@ version             :Classes 'package_version', 'numeric_version'  hidden list of 1\n  .. ..$ : int [1:4] 0 3 0 1\n\n\nCode\nclear()\n\n\n\n\nCode\nfit@report$exp_index\nfit@report$exp_catch # TODO: why is this all zeros\nfit@report$F_mort[[1]]\nfit@report$log_recruit_dev\nfit@report$ssb\nfit@report$biomass\nunique(fit@estimates$name)\nfit@input$parameters\nfit@estimates |&gt; filter(name == \"NAA\")\n# Clear memory post-run",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/NWFSC-petrale.html#plotting-results",
    "href": "content/NWFSC-petrale.html#plotting-results",
    "title": "NWFSC Case Study Petrale Sole",
    "section": "Plotting Results",
    "text": "Plotting Results\n\n\nCode\nlibrary(ggplot2)\n\n# gather index fit info\nindex_results &lt;- data.frame(\n  observed = m_index(fims_frame, \"survey1\"),\n  expected = get_report(fit)[[\"exp_index\"]][[2]]\n) |&gt;\ndplyr::mutate(year = years) |&gt;\ndplyr::filter(observed &gt; 0) # filter out -999 rows\n\n# plot index fit\nggplot2::ggplot(index_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point() +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Index (mt)\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = expected), color = \"blue\") +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\n\n\nCode\n# gather catch info \ncatch_results &lt;- data.frame(\n  year = years,\n  observed = m_landings(fims_frame, fleet = \"fleet1\"),\n  expected = get_report(fit)[[\"exp_index\"]][[1]]\n)\n\n# plot catch fit\nggplot2::ggplot(catch_results, ggplot2::aes(x = year, y = observed)) +\n  ggplot2::geom_point() + #ggplot2::aes(color = fleet)) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Catch (mt)\") +\n  ggplot2::geom_line(ggplot2::aes(x = year, y = expected)) + #, color = fleet)) +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\n\n\n\n\nCode\n# gather biomass info from FIMS and SS3\nbiomass &lt;- rep$timeseries |&gt; \n  dplyr::select(Yr, SpawnBio, Bio_all) |&gt; \n  dplyr::filter(Yr %in% years) |&gt; \n  dplyr::rename(\n    \"SS3_SpawnBio\" = \"SpawnBio\",\n    \"SS3_Bio\" = \"Bio_all\"\n  ) |&gt;\n  dplyr::mutate(\n    FIMS_SpawnBio = get_report(fit)[[\"ssb\"]][[1]][-1] , \n    FIMS_Bio = get_report(fit)[[\"biomass\"]][[1]][-1]\n  ) |&gt; ##CHECK: Is FIMS ssb reporting nyears+1 or initial year-1?\n  tidyr::pivot_longer(cols = -Yr) |&gt;\n  tidyr::separate_wider_delim(\n    cols = \"name\",\n    delim = \"_\", names = c(\"Model\", \"Type\")\n  )\n\n# plot comparison of spawning biomass and total biomass time series\nggplot2::ggplot(biomass, ggplot2::aes(x = Yr, y = value)) +\n  ggplot2::geom_line(ggplot2::aes(color = Model)) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"\") +\n  ggplot2::facet_wrap(~Type, scales = \"free_y\") +\n  ggplot2::theme_bw()\n\n\n\n\n\n\n\n\n\nCode\n# gather info on recruitment\nrecruits &lt;- rep$recruit |&gt; \n  dplyr::filter(Yr %in% years) |&gt;\n  dplyr::select(Yr, exp_recr, raw_dev) |&gt;\n  dplyr::rename(\"SS3_recruit\" = \"exp_recr\",\n                \"SS3_recdev\" = \"raw_dev\",\n                \"Year\" = \"Yr\") |&gt; \n  dplyr::mutate(FIMS_recruit = c(get_report(fit)[[\"recruitment\"]][[1]][-1]),\n                FIMS_recdev = c(NA, get_report(fit)[[\"log_recruit_dev\"]][[1]]),\n                SS3_recruit = SS3_recruit * 1000) |&gt;\n  tidyr::pivot_longer(cols = -Year) |&gt;\n  tidyr::separate_wider_delim(cols = \"name\", delim = \"_\", names = c(\"Model\", \"Type\"))             \n\n# plot recruit time series\nggplot2::ggplot(recruits, ggplot2::aes(x = Year, y = value, color = Model)) +\n  ggplot2::geom_line() + \n  ggplot2::facet_wrap(~Type, scales = \"free_y\") +\n  ggplot2::theme_bw()\n\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_line()`).",
    "crumbs": [
      "NWFSC petrale case study"
    ]
  },
  {
    "objectID": "content/case-study-template.html",
    "href": "content/case-study-template.html",
    "title": "Customize",
    "section": "",
    "text": "Each page should start with\n---\ntitle: your title\n---\nand the first header will be the 2nd level, so ##. Note, there are situations where you leave off\n---\ntitle: your title\n---\nand start the qmd file with a level header #, but if using the default title yaml (in the --- fence) is a good habit since it makes it easy for Quarto convert your qmd file to other formats (like into a presentation).",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#edit-and-add-your-pages",
    "href": "content/case-study-template.html#edit-and-add-your-pages",
    "title": "Customize",
    "section": "",
    "text": "Each page should start with\n---\ntitle: your title\n---\nand the first header will be the 2nd level, so ##. Note, there are situations where you leave off\n---\ntitle: your title\n---\nand start the qmd file with a level header #, but if using the default title yaml (in the --- fence) is a good habit since it makes it easy for Quarto convert your qmd file to other formats (like into a presentation).",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-a-chunk-of-code-describing-your-setup",
    "href": "content/case-study-template.html#add-a-chunk-of-code-describing-your-setup",
    "title": "Customize",
    "section": "Add a chunk of code describing your setup",
    "text": "Add a chunk of code describing your setup\nCase study files should include:\n\nR version\nTMB version\nFIMS commit\nName of your stock\nName of your region\nName of the analyst\n\nPlease ensure that the content/setup.qmd file is updated if the case study requires the installation of additional R packages.",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-a-bulleted-list-and-script-describing-simplifications-you-had-to-make",
    "href": "content/case-study-template.html#add-a-bulleted-list-and-script-describing-simplifications-you-had-to-make",
    "title": "Customize",
    "section": "Add a bulleted list and script describing simplifications you had to make",
    "text": "Add a bulleted list and script describing simplifications you had to make\nHow I simplified my assessment * Remove seasonality * etc.",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-your-script-that-sets-up-and-runs-the-model",
    "href": "content/case-study-template.html#add-your-script-that-sets-up-and-runs-the-model",
    "title": "Customize",
    "section": "Add your script that sets up and runs the model",
    "text": "Add your script that sets up and runs the model",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-your-comparison-figures",
    "href": "content/case-study-template.html#add-your-comparison-figures",
    "title": "Customize",
    "section": "Add your comparison figures",
    "text": "Add your comparison figures",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-comparison-tables",
    "href": "content/case-study-template.html#add-comparison-tables",
    "title": "Customize",
    "section": "Add comparison tables",
    "text": "Add comparison tables",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "href": "content/case-study-template.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "title": "Customize",
    "section": "What was your experience using FIMS? What could we do to improve usability?",
    "text": "What was your experience using FIMS? What could we do to improve usability?",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#list-any-issues-that-you-ran-into-or-found",
    "href": "content/case-study-template.html#list-any-issues-that-you-ran-into-or-found",
    "title": "Customize",
    "section": "List any issues that you ran into or found",
    "text": "List any issues that you ran into or found\nPlease open an issue if you found something new.",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "href": "content/case-study-template.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "title": "Customize",
    "section": "What features are most important to add based on this case study?",
    "text": "What features are most important to add based on this case study?",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/case-study-template.html#add-your-pages-to-the-project",
    "href": "content/case-study-template.html#add-your-pages-to-the-project",
    "title": "Customize",
    "section": "Add your pages to the project",
    "text": "Add your pages to the project\n\nAdd the files to _quarto.yml",
    "crumbs": [
      "Case study template"
    ]
  },
  {
    "objectID": "content/AFSC-BSAI-AtkaMackerel.html",
    "href": "content/AFSC-BSAI-AtkaMackerel.html",
    "title": "AFSC Case Study BSAI Atka mackerel",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: BSAI Atka mackerel\n\nRegion: AFSC\n\nAnalyst: Jim Ianelli",
    "crumbs": [
      "AFSC BSAI Atka Mackerel case study"
    ]
  },
  {
    "objectID": "content/AFSC-BSAI-AtkaMackerel.html#the-setup",
    "href": "content/AFSC-BSAI-AtkaMackerel.html#the-setup",
    "title": "AFSC Case Study BSAI Atka mackerel",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\ntheme_set(theme_bw())\n\n\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: BSAI Atka mackerel\n\nRegion: AFSC\n\nAnalyst: Jim Ianelli",
    "crumbs": [
      "AFSC BSAI Atka Mackerel case study"
    ]
  },
  {
    "objectID": "content/AFSC-BSAI-AtkaMackerel.html#simplifications-to-the-original-assessment",
    "href": "content/AFSC-BSAI-AtkaMackerel.html#simplifications-to-the-original-assessment",
    "title": "AFSC Case Study BSAI Atka mackerel",
    "section": "Simplifications to the original assessment",
    "text": "Simplifications to the original assessment\nThe model presented in this case study was changed substantially from the operational version and should not be considered reflective of the BSAI Atka mackerel stock.\nTo get the opertional model to more closely match FIMS I: * stumbled lots",
    "crumbs": [
      "AFSC BSAI Atka Mackerel case study"
    ]
  },
  {
    "objectID": "content/AFSC-BSAI-AtkaMackerel.html#script-to-prepare-data-for-building-fims-object",
    "href": "content/AFSC-BSAI-AtkaMackerel.html#script-to-prepare-data-for-building-fims-object",
    "title": "AFSC Case Study BSAI Atka mackerel",
    "section": "Script to prepare data for building FIMS object",
    "text": "Script to prepare data for building FIMS object\n\n\nCode\n## define the dimensions and global variables\n#  Opent the original AMAK file\natka_dat &lt;- readRDS(here::here(\"content\",\"data_files\",\"atka_dat.RDS\"))\natka_rep &lt;- readRDS(here::here(\"content\",\"data_files\",\"atka_rep.RDS\"))\n## define the dimensions and global variables\nyears &lt;- atka_dat$styr:atka_dat$endyr\nnyears &lt;- length(years)\nnseasons &lt;- 1\nnages &lt;- 11\nages &lt;- 1:nages\n## nfleets &lt;- 1\n## This will fit the models bridging to FIMS (simplifying)\n## source(\"fit_bridge_models.R\")\n## compare changes to model\n#pkfitfinal &lt;- readRDS(\"data_files/pkfitfinal.RDS\")\n#pkfit0 &lt;- readRDS(\"data_files/pkfit0.RDS\")\n#parfinal &lt;- pkfitfinal$obj$env$parList()\n#pkinput0 &lt;- readRDS('data_files/pkinput0.RDS')\n#fimsdat &lt;- pkdat0 &lt;- pkinput0$dat\n#pkinput &lt;- readRDS('data_files/pkinput.RDS')\n\n\nHow I simplified my assessment: * Haven’t got there yet…",
    "crumbs": [
      "AFSC BSAI Atka Mackerel case study"
    ]
  },
  {
    "objectID": "content/AFSC-BSAI-AtkaMackerel.html#script-that-sets-up-and-runs-the-model",
    "href": "content/AFSC-BSAI-AtkaMackerel.html#script-that-sets-up-and-runs-the-model",
    "title": "AFSC Case Study BSAI Atka mackerel",
    "section": "Script that sets up and runs the model",
    "text": "Script that sets up and runs the model\n\n\nCode\n# clear memory\nclear()\nestimate_fish_selex &lt;- TRUE\nestimate_survey_selex &lt;- TRUE\nestimate_q2 &lt;- TRUE\nestimate_q3 &lt;- TRUE\nestimate_q6 &lt;- TRUE\nestimate_F &lt;- TRUE\nestimate_recdevs &lt;- TRUE\n\nget_amak_data &lt;- function(rdat,rrep){\n  ## put into fims friendly form\n  res &lt;- data.frame(type = character(),\n                    name = character(),\n                    age = integer(),\n                    datestart = character(),\n                    dateend = character(),\n                    value = double(),\n                    unit = character(),\n                    uncertainty = double())\n  landings &lt;- data.frame(type = \"landings\",\n                         name = \"fleet1\",\n                         age = NA,\n                         datestart = paste0(seq(rdat$styr, rdat$endyr), \"-01-01\"),\n                         dateend = paste0(seq(rdat$styr, rdat$endyr), \"-12-31\"),\n                         value = as.numeric(rdat$catch),\n                         unit = \"t\",\n                         uncertainty = rdat$catch_cv)\n  ##  need to fill missing years with -999 so it's ignored in FIMS\n  indtmp &lt;- 0*rdat$catch-999\n  indtmp[which(years %in% rdat$yrs_ind )] &lt;- rdat$biom_ind\n  #indtmp\n  CVtmp &lt;- rep(1, length=nyears) # actually SE in log space\n  CVtmp[which(years %in% rdat$yrs_ind)] &lt;- rdat$biom_std/rdat$biom_ind\n  ## repeat with fish catch at age, using expected in missing years\n  #names(atka_rep)\n  caa &lt;- 0*rrep$N[,-1]-999\n  caa[which(years %in% rdat$yrs_ages_fsh), ] &lt;- rdat$page_fsh\n  Ncaa &lt;- rep(1, nyears)\n  Ncaa[which(years %in% rdat$yrs_ages_fsh)] &lt;- rdat$sample_ages_fsh\n  paa2 &lt;-  0*rrep$N[,-1]-999\n  paa2[which(years %in% rdat$yrs_ages_ind), ] &lt;- rdat$page_ind\n  Npaa2 &lt;- rep(1, nyears)\n  Npaa2[which(years %in% rdat$yrs_ages_ind)] &lt;- rdat$sample_ages_ind\n  index &lt;- data.frame(type = \"index\",\n                      name = \"survey\",\n                      age = NA,\n                      datestart = paste0(seq(rdat$styr, rdat$endyr), \"-01-01\"),\n                      dateend = paste0(seq(rdat$styr, rdat$endyr), \"-12-31\"),\n                      value = ifelse(indtmp&gt;0, indtmp, indtmp),\n                      unit = \"\",\n                      uncertainty = CVtmp)\n  ## these have -999 for missing data years\n  catchage &lt;- data.frame(type = \"age\",\n                         name = \"fleet1\",\n                         age = rep(seq(1,nages), nyears),\n                         datestart = rep(paste0(seq(rdat$styr, rdat$endyr), \"-01-01\"), each=nages),\n                         dateend = rep(paste0(seq(rdat$styr, rdat$endyr), \"-12-31\"), each=nages),\n                         value = as.numeric(t(caa)),\n                         unit = \"\",\n                         uncertainty = rep(Ncaa, each=nages))\n  indexage &lt;- data.frame(\n    type = \"age\",\n    name = \"survey\",\n    age = rep(seq(1, nages), nyears),\n    datestart = rep(paste0( seq(rdat$styr, rdat$endyr), \"-01-01\" ), each = nages),\n    dateend = rep(paste0( seq(rdat$styr, rdat$endyr), \"-12-31\" ), each = nages),\n    value = as.numeric(t(paa2)),\n    unit = \"\",\n    uncertainty = rep(Npaa2, each = nages)\n  )\n  ## indexage=indexage2\n  ## index=index2\n  res &lt;- rbind(res, landings, index, catchage, indexage)\n  return(res)\n}\nfimsdat&lt;-get_amak_data(atka_dat,atka_rep)\n\n\n\n\nCode\n# Needs weight-at-age data before it will work\n# age_frame &lt;- FIMS::FIMSFrame(fimsdat)",
    "crumbs": [
      "AFSC BSAI Atka Mackerel case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html",
    "href": "content/SEFSC-scamp.html",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\nggplot2::theme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: South Atlantic scamp grouper\n\nRegion: SEFSC\n\nAnalyst: Kyle Shertzer\n\nAnalyses completed on 1 July 2024",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#setup-description",
    "href": "content/SEFSC-scamp.html#setup-description",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\nggplot2::theme_set(theme_bw())\n\n\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: South Atlantic scamp grouper\n\nRegion: SEFSC\n\nAnalyst: Kyle Shertzer\n\nAnalyses completed on 1 July 2024",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#simplifications-or-modifications-to-the-original-assessment",
    "href": "content/SEFSC-scamp.html#simplifications-or-modifications-to-the-original-assessment",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "Simplifications or modifications to the original assessment",
    "text": "Simplifications or modifications to the original assessment\nThe original stock assessment (SEDAR-68OA) was conducted using the Beaufort Assessment Model (BAM). That assessment included details not yet available in FIMS, and so the following simplifications or modifications were made to the BAM configuration to allow more direct comparisons with FIMS output. These assessments and comparisons are for demonstration only.\nSimplifications or modifications:\n\nSet SSB calculations to occur on Jan. 1, rather than time of peak spawning\n\nSet abundance calculations for matching index data to occur on Jan. 1, rather than mid-year sampling\n\nDropped time blocks on fleets’ selectivities\n\nDropped all length compositions\n\nDropped estimation of the variation in size at age, as this parameter is not estimable without length comps.\n\nConverted index data and predictions to occur in weight rather than numbers\n\nConverted SSB to be female only. Because scamp are a protogynous hermaphrodite, the original assessment accounted for males implicitly by computing SSB as the sum of total (male + female) mature biomass. One way to match that accounting would be to assume that the female maturity vector equals that of both sexes combined, and then further assume that the population is 100% female. However, current FIMS (1 July 2024) does not allow deviation from a 50:50 sex ratio. Thus, for this example, FIMS and BAM use the maturity vector of both sexes combined, but apply that vector only to females and assume a 50:50 sex ratio when computing SSB.\n\nFemale maturity at age modeled as a logistic function, rather than empirical.\n\nExtended estimates of rec devs forward in time to the terminal year. Based on likelihood profiling, values from the last two years were not estimable, and thus were fixed in the original assessment.\n\nExtended estimates of rec devs backward in time to the initial year, 1969. The original assessment started estimating rec devs in 1980, when age composition data become available.\n\nDropped the fishery dependent growth curve and set mean size at age of the landings equal to the population growth curve.\n\nConverted all observed and predicted landings to weight (mt). The original assessment used units native to the data collection: commercial in pounds and recreational in numbers.\n\nReplaced Dirichlet-multinomial with standard multinomial distribution for fitting age comps.\n\nExtended age comps to include ages 1-20+, as modeled in the population. The original assessment modeled ages 1-20+ in the population, but fitted ages 1-15+ in the age compositions because of many zeros in the 16-20 age range.\n\nDropped fishery dependent indices. This was for simplicity, as modeling those indices would require mirroring a fleet’s selectivity, which is not something I currently know how to do in FIMS.",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#add-your-script-that-sets-up-and-runs-the-model",
    "href": "content/SEFSC-scamp.html#add-your-script-that-sets-up-and-runs-the-model",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "Add your script that sets up and runs the model",
    "text": "Add your script that sets up and runs the model\n\n\nCode\n###############################################\n# South Atlantic scamp grouper example assessment\n# Compare output from FIMS and a simplified version of BAM\n##############################################\n\n# clear memory\nclear()\ngrDevices::graphics.off()\n\nsca &lt;- dget(\"data_files/scamp32o.rdat\") # get scamp data and output from simplified version of BAM\n\n# Set dimensions\nstyr &lt;- dplyr::first(sca$t.series$year)\nendyr &lt;- dplyr::last(sca$t.series$year)\nyears &lt;- styr:endyr\nnyears &lt;- endyr - styr + 1 # the number of years which we have data for\nnseasons &lt;- 1 # the number of seasons in each year. FIMS currently defaults to 1\nages &lt;- sca$a.series$age # age vector.\nnages &lt;- length(ages) # the number of age groups.\n\n# Prepare data; initialize all values with -999 (missing)\n# fleet1 is commercial, fleet2 is recreational\nfleet1_ac &lt;- fleet2_ac &lt;- survey_ac &lt;- matrix(-999, nrow = nyears, ncol = nages)\n\n# Previously used log(sqrt(log(1.0 + fleet1_landings_cv^2)))\n# CV is arithmetic space is what is used to fit in BAM\n# the above code converts it to standard deviation in log space\n# create_default_DlnormDistribution takes the log of it for you\n# so we want sqrt(log(1.0 + fleet1_landings_cv^2))\n# KFJ These values might be the uncertainty in catch rather than in F, where\n# they are used for F\nfleet1_landings &lt;- sca$t.series$L.COM.ob\nfleet1_landings_cv &lt;- sca$t.series$cv.L.COM\nfleet1_landings_logSD &lt;- sqrt(log(1.0 + fleet1_landings_cv^2))\nfleet2_landings &lt;- sca$t.series$L.REC.ob\nfleet2_landings_cv &lt;- sca$t.series$cv.L.REC\nfleet2_landings_logSD &lt;- sqrt(log(1.0 + fleet2_landings_cv^2))\n\nsurvey_index &lt;- sca$t.series$U.CVT.ob |&gt;\n  tidyr::replace_na(-999)\nsurvey_index_cv &lt;- sca$t.series$cv.U.CVT\nsurvey_index_logSD &lt;- sqrt(log(1.0 + survey_index_cv^2)) |&gt;\n  tidyr::replace_na(100)\n\n# COMMENT: These multinomial entries are not whole numbers and many &lt;1. This is not\n# technically correct, but it does not seem to make a difference based on testing.\nfleet1_ac_n &lt;- sca$t.series$acomp.COM.n |&gt; \n  tidyr::replace_na(-999)\nfleet2_ac_n &lt;- sca$t.series$acomp.REC.n |&gt;\n  tidyr::replace_na(-999)\nsurvey_ac_n &lt;- sca$t.series$acomp.CVT.n |&gt;\n  tidyr::replace_na(-999)\n\nfleet1_ac[!is.na(sca$t.series$acomp.COM.n), ] &lt;- sca$comp.mats$acomp.COM.ob * fleet1_ac_n[!is.na(sca$t.series$acomp.COM.n)]\nfleet2_ac[!is.na(sca$t.series$acomp.REC.n), ] &lt;- sca$comp.mats$acomp.REC.ob * fleet2_ac_n[!is.na(sca$t.series$acomp.REC.n)]\nsurvey_ac[!is.na(sca$t.series$acomp.CVT.n), ] &lt;- sca$comp.mats$acomp.CVT.ob * survey_ac_n[!is.na(sca$t.series$acomp.CVT.n)]\n\n## put data into fims friendly form\nfleet1_landings_df &lt;- data.frame(\n  type = \"landings\",\n  name = \"fleet1\",\n  age = NA,\n  datestart = paste0(seq(styr, endyr), \"-01-01\"),\n  dateend = paste0(seq(styr, endyr), \"-12-31\"),\n  value = as.numeric(fleet1_landings),\n  unit = \"mt\",\n  uncertainty = fleet1_landings_logSD\n)\n\nfleet2_landings_df &lt;- data.frame(\n  type = \"landings\",\n  name = \"fleet2\",\n  age = NA,\n  datestart = paste0(seq(styr, endyr), \"-01-01\"),\n  dateend = paste0(seq(styr, endyr), \"-12-31\"),\n  value = as.numeric(fleet2_landings),\n  unit = \"mt\",\n  uncertainty = fleet2_landings_logSD\n)\n\nsurvey_index_df &lt;- data.frame(\n  type = \"index\",\n  name = \"survey1\",\n  age = NA,\n  datestart = paste0(seq(styr, endyr), \"-01-01\"),\n  dateend = paste0(seq(styr, endyr), \"-12-31\"),\n  value = as.numeric(survey_index),\n  unit = \"\",\n  uncertainty = survey_index_logSD\n)\n\nfleet1_ac_df &lt;- data.frame(\n  type = \"age\",\n  name = \"fleet1\",\n  age = rep(seq(1, nages), nyears),\n  datestart = rep(paste0(seq(styr, endyr), \"-01-01\"), each = nages),\n  dateend = rep(paste0(seq(styr, endyr), \"-12-31\"), each = nages),\n  value = as.numeric(t(fleet1_ac)),\n  unit = \"\",\n  uncertainty = rep(fleet1_ac_n, each = nages)\n)\n\nfleet2_ac_df &lt;- data.frame(\n  type = \"age\",\n  name = \"fleet2\",\n  age = rep(seq(1, nages), nyears),\n  datestart = rep(paste0(seq(styr, endyr), \"-01-01\"), each = nages),\n  dateend = rep(paste0(seq(styr, endyr), \"-12-31\"), each = nages),\n  value = as.numeric(t(fleet2_ac)),\n  unit = \"\",\n  uncertainty = rep(fleet2_ac_n, each = nages)\n)\n\nsurvey_ac_df &lt;- data.frame(\n  type = \"age\",\n  name = \"survey1\",\n  age = rep(seq(1, nages), nyears),\n  datestart = rep(paste0(seq(styr, endyr), \"-01-01\"), each = nages),\n  dateend = rep(paste0(seq(styr, endyr), \"-12-31\"), each = nages),\n  value = as.numeric(t(survey_ac)),\n  unit = \"\",\n  uncertainty = rep(survey_ac_n, each = nages)\n)\n\nweight_at_age &lt;- data.frame(\n  type = \"weight-at-age\",\n  name = \"fleet1\",\n  age = seq(nages),\n  datestart = rep(paste0(styr, \"-01-01\"), nages),\n  dateend = rep(paste0(styr, \"-12-31\"), nages),\n  value = sca$a.series$wgt.mt,\n  unit = \"mt\",\n  uncertainty = NA\n)\n\nlandings &lt;- rbind(fleet1_landings_df, fleet2_landings_df)\nindex &lt;- survey_index_df\nagecomps &lt;- rbind(fleet1_ac_df, fleet2_ac_df, survey_ac_df)\n\nres &lt;- rbind(landings, index, agecomps, weight_at_age)\ndata_4_model &lt;- FIMS::FIMSFrame(res)\n\n####################################################################################\n# set up selectivities for fleets and survey\nspp_fleet1_selectivity &lt;- spp_fleet2_selectivity &lt;- spp_survey1_selectivity &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\"\n  )\n)\n\ndefault_parameters &lt;- data_4_model |&gt;\n  create_default_parameters(\n    fleets = list(\n      fleet1 = spp_fleet1_selectivity,\n      fleet2 = spp_fleet2_selectivity,\n      survey1 = spp_survey1_selectivity)\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      fleet1 = list(\n        LogisticSelectivity.inflection_point.value = sca$parm.cons$selpar_A50_COM2[8],\n        LogisticSelectivity.slope.value = sca$parm.cons$selpar_slope_COM2[8],\n        Fleet.log_Fmort.value = log(sca$t.series$F.COM),\n        # COMMENT: Users should not have to reset the uncertainty for a fleet when this\n        #          information is already in the data, it should be stored and pulled out\n        #          automatically in create_default_parameters(). For index data too.\n        # COMMENT: Why are we inputting uncertainty in catch when we don't use it, will\n        #          we ever use it?\n        DlnormDistribution.log_sd.value = get_data(data_4_model) |&gt;\n          dplyr::filter(name == \"fleet1\", type == \"landings\") |&gt;\n          dplyr::pull(uncertainty) |&gt;\n          log()\n      ),\n      fleet2 = list(\n        LogisticSelectivity.inflection_point.value = sca$parm.cons$selpar_A50_REC2[8],\n        LogisticSelectivity.slope.value = sca$parm.cons$selpar_slope1_REC2[8],\n        Fleet.log_Fmort.value = log(sca$t.series$F.REC),\n        DlnormDistribution.log_sd.value = get_data(data_4_model) |&gt;\n          dplyr::filter(name == \"fleet2\", type == \"landings\") |&gt;\n          dplyr::pull(uncertainty) |&gt;\n          log()\n      ),\n      survey1 = list(\n        LogisticSelectivity.inflection_point.value = sca$parm.cons$selpar_A501_CVT[8],\n        LogisticSelectivity.slope.value = sca$parm.cons$selpar_slope1_CVT[8],\n        Fleet.log_q.value = log(sca$parms$q.CVT),\n        DlnormDistribution.log_sd.value = get_data(data_4_model) |&gt;\n          dplyr::filter(name == \"survey1\", type == \"index\") |&gt;\n          dplyr::pull(uncertainty) |&gt;\n          log()\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      # Recruitment\n      recruitment = list(\n        BevertonHoltRecruitment.log_rzero.value = sca$parm.cons$log_R0[8],\n        # Transformed 0.999 to logit where a previous version just used 0.999\n        # Wondering if we should use logit(0.75) as noted previously for scamp\n        # as the null recruitment model?\n        BevertonHoltRecruitment.logit_steep.value = -log(1.0 - 0.99) + log(0.99 - 0.2),\n        DnormDistribution.log_sd.value = sca$parm.cons$rec_sigma[8],\n        # The last value of the initial numbers at age is the first\n        # recruitment deviation\n        BevertonHoltRecruitment.log_devs.value = sca$t.series$logR.dev[-1]\n      ),\n      # Maturity\n      # NOTE, to match FIMS for a protogynous stock, these maturity values were obtained by fitting a logistic fcn to the age vector,\n      # mat.female*prop.female + mat.male*prop.male and then assuming an all female population \n      maturity = list(\n        LogisticMaturity.inflection_point.value = 2.254187,\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 1.659077,\n        LogisticMaturity.slope.estimated = FALSE\n      ),\n      population = list(\n        # M is vector of age1 M X nyrs then age2 M X nyrs\n        Population.log_M.value = log(as.numeric(matrix(\n          rep(sca$a.series$M, each = nyears),\n          nrow = nyears\n        ))),\n        Population.log_init_naa.value = log(sca$N.age[1, ]),\n        Population.log_init_naa.estimated = FALSE\n      )\n    )\n  )\n# FIX\n# $Population.log_M.estimated\n# [1] 1\n\n####################################################################################\n# Put it all together, creating the FIMS model and making the TMB fcn\n# Run the model without optimization to help ensure a viable model\ntest_fit &lt;- default_parameters |&gt;\n  initialize_fims(data = data_4_model) |&gt;\n  fit_fims(optimize = FALSE)\n\n# Run the  model with optimization\nfit &lt;- default_parameters |&gt;\n  initialize_fims(data = data_4_model) |&gt;\n  fit_fims(optimize = TRUE)\n\n# TMB reporting\nsdr &lt;- get_sdreport(fit)\nsdr_fixed &lt;- summary(sdr, \"fixed\")\nreport &lt;- get_report(fit)\n\n# print(sdr_fixed)\n\n######################################################################\n# Plot results\nlibrary(colorspace)\ncols &lt;- colorspace::sequential_hcl(5, \"Viridis\")\nout.folder &lt;- \"figures\"\ndir.create(out.folder, showWarnings = FALSE)\nplot.type &lt;- \"png\"\n\nget_parameter &lt;- function(fit, x) {\n  good &lt;- dplyr::filter(get_estimates(fit), grepl(pattern = x, name))\n  out &lt;- dplyr::pull(good, value)\n  names(out) &lt;- dplyr::pull(good, name)\n  return(out)\n}\n\nselex.bam.fleet1 &lt;- 1 / (1 + exp(-sca$parm.cons$selpar_slope_COM2[8] * (ages - sca$parm.cons$selpar_A50_COM2[8])))\nselex.fims.fleet1 &lt;- 1 / (1 + exp(-get_parameter(fit, \"slope.*\\\\.1\") * (ages - get_parameter(fit, \"inflection.*\\\\.1\"))))\nselex.bam.fleet2 &lt;- 1 / (1 + exp(-sca$parm.cons$selpar_slope1_REC2[8] * (ages - sca$parm.cons$selpar_A50_REC2[8])))\nselex.fims.fleet2 &lt;- 1 / (1 + exp(-get_parameter(fit, \"slope.*\\\\.2\") * (ages - get_parameter(fit, \"inflection.*\\\\.2\"))))\nselex.bam.survey &lt;- 1 / (1 + exp(-sca$parm.cons$selpar_slope1_CVT[8] * (ages - sca$parm.cons$selpar_A501_CVT[8])))\nselex.fims.survey &lt;- 1 / (1 + exp(-get_parameter(fit, \"slope.*\\\\.3\") * (ages - get_parameter(fit, \"inflection.*\\\\.3\"))))\n\n\nindex_results_allyr &lt;- data.frame(\n  yr = styr:endyr,\n  observed = get_data(data_4_model) |&gt;\n    dplyr::filter(type == \"index\", name == \"survey1\") |&gt;\n    dplyr::pull(value),\n  fims.expected = report$exp_index[[3]],\n  bam.expected = sca$t.series$U.CVT.pr\n)\nindex_results &lt;- index_results_allyr |&gt;\n  dplyr::filter(observed != -999.00)\nfleet1_landings_results &lt;- data.frame(\n  yr = styr:endyr,\n  observed = get_data(data_4_model) |&gt;\n    dplyr::filter(type == \"landings\", name == \"fleet1\") |&gt;\n    dplyr::pull(value),\n  fims.expected = report$exp_index[[1]],\n  bam.expected = sca$t.series$L.COM.pr\n)\nfleet2_landings_results &lt;- data.frame(\n  yr = styr:endyr,\n  observed = get_data(data_4_model) |&gt;\n    dplyr::filter(type == \"landings\", name == \"fleet2\") |&gt;\n    dplyr::pull(value),\n  fims.expected = report$exp_index[[2]],\n  bam.expected = sca$t.series$L.REC.pr\n)\n\nfleet1_F_results &lt;- data.frame(\n  yr = styr:endyr,\n  fims.F.fleet1 = report$F_mort[[1]],\n  bam.F.fleet1 = sca$t.series$F.COM\n)\nfleet2_F_results &lt;- data.frame(\n  yr = styr:endyr,\n  fims.F.fleet2 = report$F_mort[[2]],\n  bam.F.fleet2 = sca$t.series$F.REC\n)\n\n# Dropping the last (extra) year from FIMS output, assuming it is a projection yr (not an initialization yr)\nfims.naa &lt;- matrix(report$naa[[1]], ncol = nages, byrow = TRUE)\nfims.naa &lt;- fims.naa[-54, ]\npopn_results &lt;- data.frame(\n  yr = styr:endyr,\n  fims.ssb = report$ssb[[1]][1:nyears],\n  fims.recruits = report$recruitment[[1]][1:nyears] / 1000,\n  fims.biomass = report$biomass[[1]][1:nyears],\n  fims.abundance = rowSums(fims.naa) / 1000,\n  bam.ssb = sca$t.series$SSB,\n  bam.recruits = sca$t.series$recruits / 1000,\n  bam.biomass = sca$t.series$B,\n  bam.abundance = sca$t.series$N / 1000\n)\n\nyr.ind &lt;- 1:nyears\n\nyr.fleet1.ind &lt;- yr.ind[fleet1_ac_n &gt;= 0]\nyr.fleet1.ac &lt;- years[yr.fleet1.ind]\nfims.fleet1.ncaa &lt;- matrix(report$cnaa[[1]], ncol = nages, byrow = TRUE)\nfims.fleet1.ncaa &lt;- fims.fleet1.ncaa[yr.fleet1.ind, ]\nfims.fleet1.caa &lt;- fims.fleet1.ncaa / rowSums(fims.fleet1.ncaa)\nbam.fleet1.caa &lt;- sca$comp.mats$acomp.COM.pr\nobs.fleet1.caa &lt;- sca$comp.mats$acomp.COM.ob\n\nyr.fleet2.ind &lt;- yr.ind[fleet2_ac_n &gt;= 0]\nyr.fleet2.ac &lt;- years[yr.fleet2.ind]\nfims.fleet2.ncaa &lt;- matrix(report$cnaa[[2]], ncol = nages, byrow = TRUE)\nfims.fleet2.ncaa &lt;- fims.fleet2.ncaa[yr.fleet2.ind, ]\nfims.fleet2.caa &lt;- fims.fleet2.ncaa / rowSums(fims.fleet2.ncaa)\nbam.fleet2.caa &lt;- sca$comp.mats$acomp.REC.pr\nobs.fleet2.caa &lt;- sca$comp.mats$acomp.REC.ob\n\nyr.survey.ind &lt;- yr.ind[survey_ac_n &gt;= 0]\nyr.survey.ac &lt;- years[yr.survey.ind]\nfims.survey.ncaa &lt;- matrix(report$cnaa[[3]], ncol = nages, byrow = TRUE)\nfims.survey.ncaa &lt;- fims.survey.ncaa[yr.survey.ind, ]\nfims.survey.caa &lt;- fims.survey.ncaa / rowSums(fims.survey.ncaa)\nbam.survey.caa &lt;- sca$comp.mats$acomp.CVT.pr\nobs.survey.caa &lt;- sca$comp.mats$acomp.CVT.ob\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_tseries_fits.\", plot.type, sep = \"\"), width = 8, height = 10, units=\"in\", res=72)\nmat &lt;- matrix(1:3, ncol = 1)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(4.1, 4.25, 1.0, 0.5), cex = 1)\n\nplot(index_results$yr, index_results$observed,\n  ylim = c(0, max(index_results[, -1])),\n  pch = 16, col = cols[1], ylab = \"Index\", xlab = \"\"\n)\nlines(index_results$yr, index_results$bam.expected, lwd = 3, col = cols[2])\nlines(index_results$yr, index_results$fims.expected, lwd = 3, col = cols[4])\nlegend(\"topright\",\n  legend = c(\"observed\", \"BAM expected\", \"FIMS expected\"),\n  pch = c(16, -1, -1), lwd = c(-1, 3, 3), col = c(cols[1], cols[2], cols[4])\n)\n\nplot(fleet1_landings_results$yr, fleet1_landings_results$observed,\n  ylim = c(0, max(fleet1_landings_results[, -1])),\n  pch = 16, col = cols[1], ylab = \"Fleet1 landings (mt)\", xlab = \"\"\n)\nlines(fleet1_landings_results$yr, fleet1_landings_results$bam.expected, lwd = 3, col = cols[2])\nlines(fleet1_landings_results$yr, fleet1_landings_results$fims.expected, lwd = 3, col = cols[4])\n\nplot(fleet2_landings_results$yr, fleet2_landings_results$observed,\n  ylim = c(0, max(fleet2_landings_results[, -1])),\n  pch = 16, col = cols[1], ylab = \"Fleet2 landings (mt)\", xlab = \"\"\n)\nlines(fleet2_landings_results$yr, fleet2_landings_results$bam.expected, lwd = 3, col = cols[2])\nlines(fleet2_landings_results$yr, fleet2_landings_results$fims.expected, lwd = 3, col = cols[4])\n\ndev.off()\n\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_tseries_F.\", plot.type, sep = \"\"), width = 8, height = 8, units=\"in\", res=72)\nmat &lt;- matrix(1:2, ncol = 1)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(4.1, 4.25, 1.0, 0.5), cex = 1)\n\nplot(fleet1_F_results$yr, fleet1_F_results$bam.F.fleet1,\n  ylim = c(0, max(fleet1_F_results[, -1])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"Fleet 1 F\", xlab = \"\"\n)\nlines(fleet1_F_results$yr, fleet1_F_results$fims.F.fleet1, lwd = 3, col = cols[4])\nlegend(\"topleft\",\n  legend = c(\"BAM predicted\", \"FIMS predicted\"),\n  lwd = c(3, 3), col = c(cols[2], cols[4])\n)\nplot(fleet2_F_results$yr, fleet2_F_results$bam.F.fleet2,\n  ylim = c(0, max(fleet2_F_results[, -1])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"Fleet 2 F\", xlab = \"\"\n)\nlines(fleet2_F_results$yr, fleet2_F_results$fims.F.fleet2, lwd = 3, col = cols[4])\n\ndev.off()\n\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_selex.\", plot.type, sep = \"\"), width = 8, height = 10, units=\"in\", res=72)\nmat &lt;- matrix(1:3, ncol = 1)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(4.1, 4.25, 1.0, 0.5), cex = 1)\n\nplot(ages, selex.bam.fleet1, lwd = 3, col = cols[2], type = \"l\", xlab = \"\", ylab = \"Fleet1 selectivity\")\nlines(ages, selex.fims.fleet1, lwd = 3, col = cols[4])\nlegend(\"bottomright\",\n  legend = c(\"BAM predicted\", \"FIMS predicted\"),\n  lwd = c(3, 3), col = c(cols[2], cols[4])\n)\nplot(ages, selex.bam.fleet2, lwd = 3, col = cols[2], type = \"l\", xlab = \"\", ylab = \"Fleet2 selectivity\")\nlines(ages, selex.fims.fleet2, lwd = 3, col = cols[4])\nplot(ages, selex.bam.survey, lwd = 3, col = cols[2], type = \"l\", xlab = \"Age\", ylab = \"Survey selectivity\")\nlines(ages, selex.fims.survey, lwd = 3, col = cols[4])\n\ndev.off()\n\n\n\n######################################################################\n\npng(filename = paste(out.folder, \"/SEFSC_scamp_tseries_popn.\", plot.type, sep = \"\"), width = 8, height = 7, units=\"in\", res=72)\nmat &lt;- matrix(1:4, ncol = 2)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(4.1, 4.25, 1.0, 0.5), cex = 1)\n\nplot(popn_results$yr, popn_results$bam.ssb,\n  ylim = c(0, max(popn_results[, c(2, 6)])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"SSB (mt)\", xlab = \"\"\n)\nlines(popn_results$yr, popn_results$fims.ssb, lwd = 3, col = cols[4])\nlegend(\"topleft\",\n  legend = c(\"BAM predicted\", \"FIMS predicted\"),\n  lwd = c(3, 3), col = c(cols[2], cols[4])\n)\n\nplot(popn_results$yr, popn_results$bam.biomass,\n  ylim = c(0, max(popn_results[, c(4, 8)])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"Biomass (mt)\", xlab = \"\"\n)\nlines(popn_results$yr, popn_results$fims.biomass, lwd = 3, col = cols[4])\n\nplot(popn_results$yr, popn_results$bam.recruits,\n  ylim = c(0, max(popn_results[, c(3, 7)])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"Recruits (1000s)\", xlab = \"\"\n)\nlines(popn_results$yr, popn_results$fims.recruits, lwd = 3, col = cols[4])\n\nplot(popn_results$yr, popn_results$bam.abundance,\n  ylim = c(0, max(popn_results[, c(5, 9)])),\n  type = \"l\", lwd = 3, col = cols[2], ylab = \"Abundance (1000s)\", xlab = \"\"\n)\nlines(popn_results$yr, popn_results$fims.abundance, lwd = 3, col = cols[4])\n\ndev.off()\n\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_caa_fleet1.\", plot.type, sep = \"\"), width = 8, height = 11, units=\"in\", res=72)\nmat &lt;- matrix(1:18, ncol = 3)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(2.2, 2.7, 0.5, 0.5), cex = 0.75)\n\nfor (i in 1:nrow(obs.fleet1.caa))\n{\n  plot(1:nages, obs.fleet1.caa[i, ], col = cols[1], xlab = \"\", ylab = \"\", pch = 16)\n  lines(1:nages, bam.fleet1.caa[i, ], lwd = 3, col = cols[2])\n  lines(1:nages, fims.fleet1.caa[i, ], lwd = 3, col = cols[4])\n  if (i &gt; 1) legend(\"topright\", legend = yr.fleet1.ac[i], cex = 1, bty = \"n\")\n  if (i == 1) {\n    legend(\"topright\",\n      legend = c(\"Fleet1 Age Comps\", \"observed\", \"BAM expected\", \"FIMS expected\"),\n      pch = c(-1, 16, -1, -1), lwd = c(-1, -1, 3, 3), col = c(cols[1], cols[1], cols[2], cols[4]), cex = 0.7\n    )\n    legend(\"right\", legend = yr.fleet1.ac[i], cex = 1, bty = \"n\")\n  }\n}\n\ndev.off()\n\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_caa_fleet2.\", plot.type, sep = \"\"), width = 8, height = 11, units=\"in\", res=72)\n\nmat &lt;- matrix(1:28, ncol = 4)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(2.2, 2.7, 0.5, 0.5), cex = 0.75)\n\nfor (i in 1:nrow(obs.fleet2.caa))\n{\n  plot(1:nages, obs.fleet2.caa[i, ], col = cols[1], xlab = \"\", ylab = \"\", pch = 16)\n  lines(1:nages, bam.fleet2.caa[i, ], lwd = 3, col = cols[2])\n  lines(1:nages, fims.fleet2.caa[i, ], lwd = 3, col = cols[4])\n  if (i &gt; 1) legend(\"topright\", legend = yr.fleet2.ac[i], cex = 1, bty = \"n\")\n  if (i == 1) {\n    legend(\"topright\",\n      legend = c(\"Fleet2 Age Comps\", \"observed\", \"BAM expected\", \"FIMS expected\"),\n      pch = c(-1, 16, -1, -1), lwd = c(-1, -1, 3, 3), col = c(cols[1], cols[1], cols[2], cols[4]), cex = 0.5\n    )\n    legend(\"right\", legend = yr.fleet2.ac[i], cex = 1, bty = \"n\")\n  }\n}\n\ndev.off()\n\n######################################################################\npng(filename = paste(out.folder, \"/SEFSC_scamp_caa_survey.\", plot.type, sep = \"\"), width = 8, height = 11, units=\"in\", res=72)\n\nmat &lt;- matrix(1:30, ncol = 5)\nlayout(mat = mat, widths = rep.int(1, ncol(mat)), heights = rep.int(1, nrow(mat)))\npar(las = 1, mar = c(2.2, 2.7, 0.5, 0.5), cex = 0.75)\n\nfor (i in 1:nrow(obs.survey.caa))\n{\n  plot(1:nages, obs.survey.caa[i, ], col = cols[1], xlab = \"\", ylab = \"\", pch = 16)\n  lines(1:nages, bam.survey.caa[i, ], lwd = 3, col = cols[2])\n  lines(1:nages, fims.survey.caa[i, ], lwd = 3, col = cols[4])\n  if (i &gt; 1) legend(\"topright\", legend = yr.survey.ac[i], cex = 1, bty = \"n\")\n  if (i == 1) {\n    legend(\"topright\",\n      legend = c(\"Survey Age Comps\", \"observed\", \"BAM expected\", \"FIMS expected\"),\n      pch = c(-1, 16, -1, -1), lwd = c(-1, -1, 3, 3), col = c(cols[1], cols[1], cols[2], cols[4]), cex = 0.5\n    )\n    legend(\"right\", legend = yr.survey.ac[i], cex = 1, bty = \"n\")\n  }\n}\n\ndev.off()\n\nclear()",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#comparison-figures",
    "href": "content/SEFSC-scamp.html#comparison-figures",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "Comparison figures",
    "text": "Comparison figures\n\n\n\nFits-tseries\n\n\n\n\n\nFits-CAA-fleet1\n\n\n\n\n\nFits-CAA-fleet2\n\n\n\n\n\nFits-CAA-survey\n\n\n\n\n\nPredicted-selex\n\n\n\n\n\nPredicted-tseries-F\n\n\n\n\n\nPredicted-tseries-population",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "href": "content/SEFSC-scamp.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "What was your experience using FIMS? What could we do to improve usability?",
    "text": "What was your experience using FIMS? What could we do to improve usability?\n\nGreat joy when it finally worked! But, it took a lot of time to first simplify the corresponding BAM implementation and then to run FIMS successfully.\n\nData input seems complex for now. I was able to mimic previous examples, but would not likely have been successful starting from scratch. A user interface will presumably help simplify the process.\n\nClear distinction between “fleet” and “index” would be helpful. Examples of this confusion include 1) landings are defined using methods::new(Index, nyears) and spp_fleet1$SetObservedIndexData(spp_fleet1_landings$get_id()), and 2) surveys are defined using methods::new(Fleet).\n\nFor simplification of the scamp example, I dropped two fishery dependent indices. My impression is that, in FIMS, fishery dependent indices would need to be defined as their own “fleet” and then somehow mirror the selectivity of the corresponding fishing fleet, presumably using TMB’s mapping feature. I think it would be more straightforward if a fishery dependent index could be defined as an object linked to the fleet, similar to how landings and age comp data are handled.\n\nWhen a model has multiple fleets, the function FIMS::m_landings concatenates all fleets’ landings into one long vector. Thus, one must specify correct indexing values when pulling landings by fleet from that concatenation. This seems clunky and error-prone, and it would be preferable if FIMS::m_landings took fleet as an argument, similar to FIMS::m_agecomp, so that landings by fleet could be obtained by fleet reference.",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#list-any-issues-that-you-ran-into-or-found",
    "href": "content/SEFSC-scamp.html#list-any-issues-that-you-ran-into-or-found",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "List any issues that you ran into or found",
    "text": "List any issues that you ran into or found\nThe FIMS feature to assign proportion female at age is not yet functional and it is hard-coded using a 50:50 sex ratio. Many stocks in the southeast are protogynous hermphrodites, such that individuals start life as females and later convert to males. This life history creates a sex ratio that is tilted toward females for younger ages and males for older ages.",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "href": "content/SEFSC-scamp.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "What features are most important to add based on this case study?",
    "text": "What features are most important to add based on this case study?\n\nDiscards. I chose this assessment as a case study because it did not explicitly model discards, and I knew that capability was not yet available in FIMS. However, most assessments in the Southeast model dead discards.\n\nFitting to length composition data.",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SEFSC-scamp.html#acknowledgments",
    "href": "content/SEFSC-scamp.html#acknowledgments",
    "title": "FIMS Case Study of South Atlantic Scamp (SEFSC)",
    "section": "Acknowledgments",
    "text": "Acknowledgments\nThanks to Nathan Vaughan and Ian Taylor, who helped troubleshoot earlier versions of the code.",
    "crumbs": [
      "SEFSC scamp case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html",
    "href": "content/SWFSC-sardine.html",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#the-setup",
    "href": "content/SWFSC-sardine.html#the-setup",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "",
    "text": "Code\n# Names of required packages\npackages &lt;- c(\"dplyr\", \"tidyr\", \"ggplot2\", \"TMB\", \"reshape2\", \"here\", \"remotes\", \"lubridate\")\n\n# Install packages not yet installed\ninstalled_packages &lt;- packages %in% rownames(installed.packages())\nif (any(installed_packages == FALSE)) {\n  install.packages(packages[!installed_packages], repos = \"http://cran.us.r-project.org\")\n}\n\nremotes::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\nremotes::install_github(\"NOAA-FIMS/FIMS\")\nremotes::install_github(\"r4ss/r4ss\")\n\n# Load packages\ninvisible(lapply(packages, library, character.only = TRUE))\n\nlibrary(FIMS)\nlibrary(TMBhelper)\n\nR_version &lt;- version$version.string\nTMB_version &lt;- packageDescription(\"TMB\")$Version\nFIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)\n\nsource(file.path(\"R\", \"utils.R\"))\n\n\n\n\nCode\n# R_version &lt;- version$version.string\n# TMB_version &lt;- packageDescription(\"TMB\")$Version\n# FIMS_commit &lt;- substr(packageDescription(\"FIMS\")$GithubSHA1, 1, 7)",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-a-chunk-of-code-describing-your-setup",
    "href": "content/SWFSC-sardine.html#add-a-chunk-of-code-describing-your-setup",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add a chunk of code describing your setup",
    "text": "Add a chunk of code describing your setup\n\nR version: R version 4.4.2 (2024-10-31)\n\nTMB version: 1.9.16\n\nFIMS commit: eca8095\n\nStock name: Pacific sardine northern subpopulation\n\nRegion: SWFSC\n\nAnalyst: Peter Kuriyama",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-a-bulleted-list-and-script-describing-simplifications-you-had-to-make",
    "href": "content/SWFSC-sardine.html#add-a-bulleted-list-and-script-describing-simplifications-you-had-to-make",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add a bulleted list and script describing simplifications you had to make",
    "text": "Add a bulleted list and script describing simplifications you had to make\nHow I simplified my assessment * Convert two-semester time step to annual * Sum the catch values for MexCal S1 and S2 * Sum the age comps for MexCal S1 and S2 * Drop PNW fishing fleet data (catch and age comp data) * Drop spring AT survey index values * Use expected summary biomass values as AT survey CPUE * Fix Q=1 for AT survey, rather than have fixed, year-specific values * No SR_regime parameter estimated (population assumed to start a equilibrium) * Fixed M at 0.8 * Assume time-invariant logistic selectivity AT survey fleets (time-varying age-0 in benchmark assessment) * Assume time-invariant logistic selectivity MexCal fleet (time-varying in benchmark assessment) * Lorenzen age M -&gt; one M value * No ageing error in FIMS? * Assume time-invariant weight at age for the fishery and survey",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-your-script-that-sets-up-and-runs-the-model",
    "href": "content/SWFSC-sardine.html#add-your-script-that-sets-up-and-runs-the-model",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add your script that sets up and runs the model",
    "text": "Add your script that sets up and runs the model\n\n\nCode\n# options(max.print = 1000, device = 'windows')\n#\n# library(plyr)\n# library(reshape2)\n# library(tidyverse)\n# library(devtools)\n# library(patchwork)\n# library(scales)\n# withr::local_options(pkg.build_extra_flags = FALSE)\n#\n# library(TMB)\n# # devtools::install_github(\"kaskr/TMB_contrib_R/TMBhelper\")\n# library(TMBhelper)\n# library(r4ss)\n#\n# #Local version of FIMS downloaded last week\n# # devtools::load_all(\"../fims_v2/FIMS\")\n#\n#\n# # devtools::install_github(\"NOAA-FIMS/FIMS\")\n# # pak::pkg_install(\"NOAA-FIMS/FIMS\")\n#\n# library(FIMS)\n\nclear()\nrm(list = ls())\n\n#--------------------------------------------------------\n#Logistic function for later use\nlogistic &lt;- function(x, slope, inflection_point){\n  out &lt;- 1 / (1 + exp(-1 * slope * (x - inflection_point)))\n  out &lt;- data.frame(x = x, value = out)\n  return(out)\n}\n\n#--------------------------------------------------------\n#Manually enter data\n\n# setwd(\"C://Users//peter.kuriyama//SynologyDrive/Research//noaa//FIMS\")\n\n#-----Catch\ncatch &lt;- data.frame(year = 2005:2023, catch = c(29188.50, 53107.00, 69929.40,\n                                                56317.80, 33546.40, 17466.40, 39383.10, 2585.38, 5705.77, 2558.63, 7.18, 428.26,\n                                                347.11, 514.20, 619.04, 653.15, 285.89, 508.02, 152.31))\n\n# ggplot(catch, aes(x = year, y = catch)) + geom_point() +\n#   geom_line() + scale_y_continuous(label = comma)\n\n\nfimscatch &lt;- tibble::tibble(type = \"landings\", name = \"fleet1\",\n                    age = NA, datestart = paste0(catch$year, \"-01-01\"),\n                    dateend = paste0(catch$year, \"-12-31\"), value = catch$catch,\n                    unit = \"mt\", uncertainty = 0.05)\n\n#-----CPUE\ncpue &lt;- data.frame(year = 2005:2023, obs = c(649619.0, 899635.0, 956354.0, 863281.0, 652029.0,\n                                             504970.0, 395783.0, 293980.0, 182417.0, 89260.1,\n                                             46403.0, 40704.0, 44592.1, 48789.1, 53551.8,\n                                             59765.8, 68451.7, 71612.5, 68957.9))\n\n\n# ggplot(cpue, aes(x = year, y = obs)) + geom_point() + geom_line() +\n#   scale_y_continuous(label = comma)\n\nfimsindex &lt;- tibble::tibble(type = \"index\", name = \"survey1\",\n                    age = NA, datestart = paste0(cpue$year, \"-01-01\"),\n                    dateend = paste0(cpue$year, \"-12-31\"),\n                    value = cpue$obs, unit = 'mt', uncertainty = .3)\nfimsindex$unit &lt;- \"\"\n\n#-----Age compositions\nacomps &lt;- utils::read.csv(\"data_files/sardine_acomps.csv\") |&gt;\n  dplyr::mutate(value_prop = value / Nsamp) # convert age-comp data to proportions, to match fims-demo.Rmd\n\nfimsage &lt;- tibble::tibble(type = \"age\", name = acomps$name,\n                  age = acomps$age, datestart = paste0(acomps$Yr, \"-01-01\"),\n                  dateend = paste0(acomps$Yr, \"-12-31\"),\n                  value = acomps$value_prop, unit = \"proportion\", uncertainty = acomps$Nsamp)\n\n# Fill in missing name/year rows with -999s for value and \"\" for uncertainty\n  # This works the same as not doing anything, but is not necessary\n# blank_age_grid &lt;- expand.grid(name = c(\"fleet1\", \"survey1\"),\n#                               age = 0:8,\n#                               yr = 2005:2023)\n# blank_age &lt;- tibble::tibble(type = \"age\", name = blank_age_grid$name,\n#                     age = blank_age_grid$age,\n#                     datestart = paste0(blank_age_grid$yr, \"-01-01\"),\n#                     dateend = paste0(blank_age_grid$yr, \"-12-31\"),\n#                     value = -999, unit = \"proportion\", uncertainty = NA)\n# missing_ages &lt;- blank_age |&gt;\n#   mutate(name_date = paste0(name, datestart)) |&gt;\n#   filter(!(name_date %in% paste0(fimsage_init$name, fimsage_init$datestart))) |&gt;\n#   select(-name_date)\n# fimsage &lt;- rbind(fimsage, missing_ages)\n\n#fimsage$uncertainty &lt;- 50 Leave as empirical values\n\nfimscatch$value &lt;- fimscatch$value\nfimsindex$unit &lt;- \"\"\n\n#-----Weight-at-age\n  # Q: What are the differences in how SS3 and FIMS process wtatage inputs/units?\n  # A: SS3 assumes WAA is expressed in kg, and then converts to mt for biomass calculations\n      # SS3 also expresses natage in terms of 1000s/fish\n    # FIMS assumes WAA is expressed in mt, but expresses natage in fish\n    # WAA input values are supplied to SS3 in kg and FIMS in mt\n    # Model now correctly processes inputs and provides comparable NAA, WAA, and biomass outputs to SS3\nwtatage &lt;- r4ss::SS_readwtatage(\"data_files/sardine_wtatage.ss_new\") |&gt;\n  dplyr::filter(fleet %in% c(1, 2)) |&gt;\n  dplyr::mutate(fleet = ifelse(fleet == 1, \"fleet1\", \"survey1\")) |&gt;\n  tidyr::pivot_longer(cols = `0`:`10`, names_to = \"age\", values_to = \"value\") |&gt;\n  dplyr::filter(year != 2024, !(age %in% c(\"9\", \"10\"))) |&gt; # Trim ages 9 and 10 to match age-comps\n  dplyr::mutate(value = value / 1000) # WAA converted from kg to mt\nfimswaa &lt;- tibble::tibble(\n  type = \"weight-at-age\",\n  name = wtatage$fleet,\n  age = wtatage$age,\n  datestart = paste0(wtatage$year, \"-01-01\"),\n  dateend = paste0(wtatage$year, \"-12-31\"),\n  value = wtatage$value,\n  unit = \"mt\",\n  uncertainty = NA\n)\n\n#Combine everything, format\nfimsdat &lt;- rbind(fimscatch, fimsindex, fimsage, fimswaa)\nfimsdat$age &lt;- as.integer(fimsdat$age)\nfimsdat$value &lt;- as.numeric(fimsdat$value)\n\n# Convert to FIMSFrame\nfinal_fimsdat &lt;- FIMSFrame(fimsdat)\n\n# Define fleet specifications for fleet1 and survey1\nfleet1 &lt;- survey1 &lt;- list(\n  selectivity = list(form = \"LogisticSelectivity\"),\n  data_distribution = c(\n    Index = \"DlnormDistribution\",\n    AgeComp = \"DmultinomDistribution\",\n    LengthComp = \"DmultinomDistribution\"\n  )\n)\n\n# Create default recruitment, growth, and maturity parameters\ndefault_parameters &lt;- final_fimsdat |&gt;\n  create_default_parameters(\n    fleets = list(fleet1 = fleet1, survey1 = survey1)\n  )\n\n# Update parameters\n  # Control how parameters are updated\nestimate_fish_selex &lt;- FALSE\nestimate_survey_selex &lt;- FALSE\nestimate_q &lt;- FALSE #Fix at 1\nestimate_F &lt;- TRUE\nestimate_recdevs &lt;- TRUE\nestimate_init_naa &lt;- TRUE\nestimate_log_rzero &lt;- TRUE\nsteep &lt;- 0.6 # sardine steepness is fixed at 0.6\nM_value &lt;- 0.8 #.8 worked pretty well\nrzero &lt;- 17 #14.2 is log(R0) in sardine simplified model\nnyears &lt;- get_n_years(final_fimsdat)\nyears &lt;- get_start_year(final_fimsdat):get_end_year(final_fimsdat)\nnages &lt;- get_n_ages(final_fimsdat)\nages &lt;- get_ages(final_fimsdat)\ninit_naa &lt;- exp(rzero) * exp(-(ages - 1) * M_value)\ninit_naa[nages] &lt;- init_naa[nages] / M_value # sum of infinite series\n\n  # Update parameters\nparameters &lt;- default_parameters |&gt;\n  update_parameters( # update fleet1 specifications\n    modified_parameters = list(\n      fleet1 = list(\n        LogisticSelectivity.inflection_point.value = 1,\n        LogisticSelectivity.inflection_point.estimated = estimate_fish_selex,\n        LogisticSelectivity.slope.value = 5,\n        LogisticSelectivity.slope.estimated = estimate_fish_selex,\n        Fleet.log_Fmort.value = log(rep(0.2, nyears)),\n        Fleet.log_Fmort.estimated = estimate_F,\n        DlnormDistribution.log_sd.value = rep(log(sqrt(log(0.01^2 + 1))), nyears)\n      )\n    )\n  ) |&gt;\n  update_parameters( # update survey1 specifications\n    modified_parameters = list(\n      survey1 = list(\n        LogisticSelectivity.inflection_point.value = 1.2,\n        LogisticSelectivity.inflection_point.estimated = estimate_survey_selex,\n        LogisticSelectivity.slope.value = 2,\n        LogisticSelectivity.slope.estimated = estimate_survey_selex,\n        Fleet.log_q.value = 0,\n        Fleet.log_q.estimated = estimate_q,\n        DlnormDistribution.log_sd.value = rep(log(sqrt(log(0.1^2 + 1))), nyears)\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      recruitment = list(\n        BevertonHoltRecruitment.log_rzero.value = rzero,\n        BevertonHoltRecruitment.log_rzero.estimated = estimate_log_rzero,\n        BevertonHoltRecruitment.logit_steep.value = -log(1.0 - steep) + log(steep - 0.2),\n        BevertonHoltRecruitment.log_devs.value = rep(log(1), nyears-1),\n        DnormDistribution.log_sd.value = log(1.2)\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      maturity = list(\n        LogisticMaturity.inflection_point.value = 1.2,\n        LogisticMaturity.inflection_point.estimated = FALSE,\n        LogisticMaturity.slope.value = 1.5, # arbitrary guess\n        LogisticMaturity.slope.estimated = FALSE\n      )\n    )\n  ) |&gt;\n  update_parameters(\n    modified_parameters = list(\n      population = list(\n        Population.log_M.value = rep(log(M_value), nages * nyears),\n        Population.log_init_naa.value = log(init_naa),\n        Population.log_init_naa.estimated = estimate_init_naa\n      )\n    )\n  )\n\n# Fit the model\nfit &lt;- parameters |&gt;\n  initialize_fims(data = final_fimsdat) |&gt;\n  fit_fims(optimize = TRUE)\n\n\n✔ Starting optimization ...\nℹ Restarting optimizer 3 times to improve gradient.\nℹ Maximum gradient went from 0.00769 to 0.00016 after 3 steps.\n✔ Finished optimization\n✔ Finished sdreport\nℹ FIMS model version: 0.3.0.1\nℹ Total run time was 0.12696 seconds\nℹ Number of parameters: total=47, fixed_effects=47, and random_effects=0\nℹ Maximum gradient= 0.00016\nℹ Negative log likelihood (NLL):\n• Marginal NLL= 1044.96182\n• Total NLL= 1044.96182\nℹ Terminal SB=\n\n\nCode\n# Get information about the model and print a few characters to the screen\nrecruitment_log &lt;- get_log_module(\"information\")\nsubstr(recruitment_log, 1, 100)\n\n\n[1] \"[\\n{\\n\\\"timestamp\\\" : \\\"Tue Feb 11 15:41:13 2025\\\",\\n\\\"level\\\" : \\\"info\\\",\\n\\\"message\\\" : \\\"Initializing fleet 1\\\",\\n\"\n\n\nCode\n# Clear memory post-run\nclear()",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-your-comparison-figures",
    "href": "content/SWFSC-sardine.html#add-your-comparison-figures",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add your comparison figures",
    "text": "Add your comparison figures\n\n\nCode\nload(\"data_files/sardine_simplified_res.Rdata\")\n\n#------------------------------------------------------------------------\n#------SSB\n# Q: Is 'ssb' from  get_report(fit) calculated assuming 2 genders and a 50:50 ratio?\n  # If so, it might explain the discrepancy between ss3 (1 gender model) and fims (2 genders)\nssbs &lt;- ssres$timeseries |&gt;\n  dplyr::select(Yr, SpawnBio) |&gt;\n  dplyr::mutate(fims = c(0, 0, get_report(fit)[[\"ssb\"]][[1]]))\nnames(ssbs)[2] &lt;- 'ss3'\n\nssbs |&gt;\n  dplyr::filter(Yr &gt;= 2005, Yr &lt; 2024) |&gt;\n  tidyr::pivot_longer(names_to = \"variable\", cols = dplyr::matches(\"ss3|fims\")) |&gt;\n  ggplot2::ggplot(ggplot2::aes(x = Yr, y = value, group = variable, color = variable)) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line() +\n  ggplot2::ylab(\"Spawning biomass (mt)\") +\n  ggplot2::theme_bw() +\n  ggplot2::xlab(\"year\") +\n  ggplot2::theme(legend.position.inside = c(.9, .9))\n\n\n\n\n\n\n\n\n\nCode\nggplot2::ggsave(\n  \"figures/SWFSC-sardine-sb.png\",\n  width = 7.35,\n  height = 4.8\n)\n\n#------------------------------------------------------------------------\n#------Index fits\nindex &lt;- ssres$cpue |&gt;\n  dplyr::select(Yr, Obs, Exp)\nnames(index) &lt;- c(\"year\", 'obs', 'ss3')\nindex$fims &lt;- get_report(fit)[[\"exp_index\"]][[2]]\nindex |&gt;\n  tidyr::pivot_longer(names_to = \"variable\", cols = dplyr::matches(\"ss3|fims\")) |&gt;\n  ggplot2::ggplot(ggplot2::aes(x = year)) +\n  ggplot2::geom_point(ggplot2::aes(y = obs)) +\n  ggplot2::geom_line(ggplot2::aes(y = value, color = variable, group = variable)) +\n  ggplot2::theme_bw() +\n  ggplot2::theme(legend.position.inside = c(.9, .9)) +\n  ggplot2::xlab(\"Year\") +\n  ggplot2::ylab(\"Survey biomass value (mt)\")\n\n\n\n\n\n\n\n\n\nCode\nggplot2::ggsave(\"figures/SWFSC-sardine-surveyfit.png\", width = 6.8, height = 5.25)\n\n#------------------------------------------------------------------------\n#-----Calculate age-1+ biomass\n#Multiply numbers at age by weight at age and sum\nnaa &lt;- get_report(fit)[[\"naa\"]][[1]]\n\nnaa1 &lt;- tidyr::crossing(c(years, 2024), ages) |&gt;\n  dplyr::mutate(naa = naa) |&gt;\n  as.data.frame()\nnames(naa1) &lt;- c(\"year\", 'age', 'value')\nnaa1$cohort &lt;- naa1$year - naa1$age\n\n#Format Weight at age (identical WAA for each year and fleet)\nwaa &lt;- data.frame(\n  age = wtatage$age[(wtatage$year == 2005 & wtatage$fleet == \"fleet1\")],\n  waa = wtatage$value[(wtatage$year == 2005 & wtatage$fleet == \"fleet1\")]\n) |&gt;\n  dplyr::mutate(age = as.integer(age))\n\nnaa1 &lt;- naa1 |&gt;\n  dplyr::left_join(waa, by = \"age\")\n\n\nnaa1 &lt;- naa1 |&gt;\n  dplyr::mutate(weight = value * waa)\nage1plus &lt;- naa1 |&gt;\n  dplyr::filter(age != 0) |&gt;\n  dplyr::group_by(year) |&gt;\n  dplyr::summarize(summbio = sum(weight))\n\nbio1 &lt;- ssres$timeseries |&gt;\n  dplyr::filter(Seas == 1) |&gt;\n  dplyr::select(Yr, Bio_smry) |&gt;\n  dplyr::mutate(year = Yr, ss3bio = Bio_smry) |&gt;\n  dplyr::select(-Yr, -Bio_smry)\n\n\nage1plus &lt;- age1plus |&gt;\n  dplyr::left_join(bio1, by = \"year\")\n\nnames(age1plus) &lt;- c(\"year\", \"fims\", \"ss3\")\n\n#Full time series of age-1+ biomass\nage1plus |&gt;\n  reshape2::melt(id.var = \"year\") |&gt;\n  ggplot2::ggplot(ggplot2::aes(x = year, y = value, group = variable, color = variable)) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line() +\n  ggplot2::ylab(\"Age-1+ biomass (mt)\") +\n  ggplot2::theme_bw() +\n  ggplot2::theme(legend.position.inside = c(.9, .9))\n\n\n\n\n\n\n\n\n\nCode\nggplot2::ggsave(\"figures/SWFSC-sardine-age1plusbio.png\", width = 6.8, height = 5.25)\n\n#Zoomed in time series of age-1+\nage1plus |&gt;\n  reshape2::melt(id.var = \"year\") |&gt;\n  dplyr::filter(year &gt;= 2010) |&gt;\n  ggplot2::ggplot(ggplot2::aes(x = year, y = value, group = variable, color = variable)) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line() +\n  ggplot2::theme_bw() +\n  ggplot2::ylab(\"Age-1+ biomass (mt)\") +\n  ggplot2::theme(legend.position.inside = c(.9, .9))\n\n\n\n\n\n\n\n\n\nCode\nggplot2::ggsave(\n  \"figures/SWFSC-sardine-age1plusbio_zoomedin.png\",\n  width = 6.8,\n  height = 5.25\n)\n\n\n#------------------------------------------------------------------------\n#------Recruitment\n# Divide FIMS recruits by 1000 to match reporting in SS3\nrecs &lt;- ssres$timeseries |&gt;\n  dplyr::select(Yr, Recruit_0) |&gt;\n  dplyr::mutate(fims = c(0, 0, get_report(fit)[[\"recruitment\"]][[1]]) / 1000)\nnames(recs)[2] &lt;- \"ss3\"\n\nrecs |&gt;\n  dplyr::filter(Yr &gt;= 2005, Yr &lt; 2024) |&gt;\n  reshape2::melt(id.var = \"Yr\") |&gt;\n  ggplot2::ggplot(ggplot2::aes(x = Yr, y = value, group = variable, color = variable)) +\n  ggplot2::theme_bw() +\n  ggplot2::geom_point() +\n  ggplot2::geom_line() +\n  ggplot2::theme(legend.position.inside = c(.9, .9)) +\n  ggplot2::ylab(\"Recruits (x1000)\")\n\n\n\n\n\n\n\n\n\nCode\nggplot2::ggsave(\"figures/SWFSC-sardine-recruitment.png\", width = 6.8, height = 5.25)\n\n\n#------------------------------------------------------------------------\n#------Fixed selectivities\n#Are fixed but plot for comparison's sake\n##Fishery\n\nsel_fishery &lt;- logistic(ages,\n                        slope = parameters$parameters$fleet1$LogisticSelectivity.slope.value,\n                        inflection_point = parameters$parameters$fleet1$LogisticSelectivity.inflection_point.value)\n\nnames(sel_fishery) &lt;- c(\"age\", \"fims\")\n\nsel_fishery$ss3 &lt;- ssres$ageselex |&gt;\n  dplyr::filter(Yr == 2005, Factor == \"Asel\", Fleet == 1) |&gt;\n  dplyr::select(as.character(0:8)) |&gt;\n  t()\nsel_fishery &lt;- sel_fishery |&gt;\n  reshape2::melt(id.var = \"age\")\n\n\nWarning: attributes are not identical across measure variables; they will be\ndropped\n\n\nCode\nggplot2::ggplot(\n  sel_fishery,\n  ggplot2::aes(x = age, y = value, group = variable, color = variable)\n) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line()\n\n\n\n\n\n\n\n\n\nCode\n#-----------Survey\nsel_survey &lt;- logistic(ages,\n                       slope = parameters$parameters$survey1$LogisticSelectivity.slope.value,\n                       inflection_point = parameters$parameters$survey1$LogisticSelectivity.inflection_point.value)\n\nnames(sel_survey) &lt;- c(\"age\", 'fims')\n\nsel_survey$ss3 &lt;- ssres$ageselex |&gt;\n  dplyr::filter(Yr == 2005, Factor == \"Asel\", Fleet == 2) |&gt;\n  dplyr::select(as.character(0:8)) |&gt;\n  t()\nsel_survey &lt;- sel_survey |&gt;\n  reshape2::melt(id.var = \"age\")\n\n\nWarning: attributes are not identical across measure variables; they will be\ndropped\n\n\nCode\nggplot2::ggplot(\n  sel_survey,\n  ggplot2::aes(x = age, y = value, group = variable, color = variable)\n) +\n  ggplot2::geom_point() +\n  ggplot2::geom_line()",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-comparison-tables",
    "href": "content/SWFSC-sardine.html#add-comparison-tables",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add comparison tables",
    "text": "Add comparison tables",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "href": "content/SWFSC-sardine.html#what-was-your-experience-using-fims-what-could-we-do-to-improve-usability",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "What was your experience using FIMS? What could we do to improve usability?",
    "text": "What was your experience using FIMS? What could we do to improve usability?\nTools to check: * data were inputted correctly (dimension checks) * starting values and settings are reasonable * Perhaps have a model template file that will work as is, then users can modify as necessary * I had issues installing FIMS with install_github that seemed to be related to R settings\nModel: * streamline configuration of fleets and maybe make it easier to add additional fleets (perhaps clone existing ones then change specific settings) * Think about ways to modify single model settings based on say different starting values\nOutput: * include all parameter values and names (fixed and estimated, also show starting values) * Code to generate a default set of figures and tables for use in assessment documents/presentations",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#list-any-issues-that-you-ran-into-or-found",
    "href": "content/SWFSC-sardine.html#list-any-issues-that-you-ran-into-or-found",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "List any issues that you ran into or found",
    "text": "List any issues that you ran into or found\nPlease open an issue if you found something new.",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "href": "content/SWFSC-sardine.html#what-features-are-most-important-to-add-based-on-this-case-study",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "What features are most important to add based on this case study?",
    "text": "What features are most important to add based on this case study?\n\nThe ability to start the model at non-equilibrium conditions (In SS3 there is a SR_regime parameter and Initial F to match equilbirium age comps to first year of data age comps) *Does the model year start in the first year of the data input?",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  },
  {
    "objectID": "content/SWFSC-sardine.html#add-your-pages-to-the-project",
    "href": "content/SWFSC-sardine.html#add-your-pages-to-the-project",
    "title": "SWFSC Case Study Pacific sardine",
    "section": "Add your pages to the project",
    "text": "Add your pages to the project\n\nAdd the files to _quarto.yml",
    "crumbs": [
      "SWFSC sardine case study"
    ]
  }
]